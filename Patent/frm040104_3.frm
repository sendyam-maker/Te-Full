VERSION 5.00
Object = "{BDC217C8-ED16-11CD-956C-0000C04E4C0A}#1.1#0"; "TABCTL32.OCX"
Object = "{0D452EE1-E08F-101A-852E-02608C4D0BB4}#2.0#0"; "FM20.DLL"
Begin VB.Form frm040104_3 
   BorderStyle     =   1  '單線固定
   Caption         =   "內專發文 - 一般性質"
   ClientHeight    =   5760
   ClientLeft      =   36
   ClientTop       =   948
   ClientWidth     =   9312
   ControlBox      =   0   'False
   LinkTopic       =   "Form1"
   LockControls    =   -1  'True
   MaxButton       =   0   'False
   MDIChild        =   -1  'True
   MinButton       =   0   'False
   ScaleHeight     =   5760
   ScaleWidth      =   9312
   Begin TabDlg.SSTab SSTab1 
      Height          =   4575
      Left            =   30
      TabIndex        =   79
      Top             =   1170
      Width           =   9285
      _ExtentX        =   16383
      _ExtentY        =   8065
      _Version        =   393216
      TabHeight       =   420
      TabCaption(0)   =   "一般資料"
      TabPicture(0)   =   "frm040104_3.frx":0000
      Tab(0).ControlEnabled=   -1  'True
      Tab(0).Control(0)=   "lblLetter(5)"
      Tab(0).Control(0).Enabled=   0   'False
      Tab(0).Control(1)=   "lblLetter(4)"
      Tab(0).Control(1).Enabled=   0   'False
      Tab(0).Control(2)=   "Label1(9)"
      Tab(0).Control(2).Enabled=   0   'False
      Tab(0).Control(3)=   "Label3(13)"
      Tab(0).Control(3).Enabled=   0   'False
      Tab(0).Control(4)=   "Label3(11)"
      Tab(0).Control(4).Enabled=   0   'False
      Tab(0).Control(5)=   "Label3(10)"
      Tab(0).Control(5).Enabled=   0   'False
      Tab(0).Control(6)=   "Label3(9)"
      Tab(0).Control(6).Enabled=   0   'False
      Tab(0).Control(7)=   "Label1(8)"
      Tab(0).Control(7).Enabled=   0   'False
      Tab(0).Control(8)=   "Label1(7)"
      Tab(0).Control(8).Enabled=   0   'False
      Tab(0).Control(9)=   "lblLetter(0)"
      Tab(0).Control(9).Enabled=   0   'False
      Tab(0).Control(10)=   "Label1(6)"
      Tab(0).Control(10).Enabled=   0   'False
      Tab(0).Control(11)=   "Label1(5)"
      Tab(0).Control(11).Enabled=   0   'False
      Tab(0).Control(12)=   "Label1(4)"
      Tab(0).Control(12).Enabled=   0   'False
      Tab(0).Control(13)=   "Label1(3)"
      Tab(0).Control(13).Enabled=   0   'False
      Tab(0).Control(14)=   "Label3(6)"
      Tab(0).Control(14).Enabled=   0   'False
      Tab(0).Control(15)=   "Label34"
      Tab(0).Control(15).Enabled=   0   'False
      Tab(0).Control(16)=   "Label33"
      Tab(0).Control(16).Enabled=   0   'False
      Tab(0).Control(17)=   "Label32"
      Tab(0).Control(17).Enabled=   0   'False
      Tab(0).Control(18)=   "Label31"
      Tab(0).Control(18).Enabled=   0   'False
      Tab(0).Control(19)=   "Label1(2)"
      Tab(0).Control(19).Enabled=   0   'False
      Tab(0).Control(20)=   "Label16"
      Tab(0).Control(20).Enabled=   0   'False
      Tab(0).Control(21)=   "Label14"
      Tab(0).Control(21).Enabled=   0   'False
      Tab(0).Control(22)=   "Label11"
      Tab(0).Control(22).Enabled=   0   'False
      Tab(0).Control(23)=   "Label17(0)"
      Tab(0).Control(23).Enabled=   0   'False
      Tab(0).Control(24)=   "lblLetter(1)"
      Tab(0).Control(24).Enabled=   0   'False
      Tab(0).Control(25)=   "Label17(2)"
      Tab(0).Control(25).Enabled=   0   'False
      Tab(0).Control(26)=   "Label3(5)"
      Tab(0).Control(26).Enabled=   0   'False
      Tab(0).Control(27)=   "Label20(1)"
      Tab(0).Control(27).Enabled=   0   'False
      Tab(0).Control(28)=   "lblLetter(2)"
      Tab(0).Control(28).Enabled=   0   'False
      Tab(0).Control(29)=   "lblLetter(3)"
      Tab(0).Control(29).Enabled=   0   'False
      Tab(0).Control(30)=   "Label17(3)"
      Tab(0).Control(30).Enabled=   0   'False
      Tab(0).Control(31)=   "lblCP120"
      Tab(0).Control(31).Enabled=   0   'False
      Tab(0).Control(32)=   "Label3(12)"
      Tab(0).Control(32).Enabled=   0   'False
      Tab(0).Control(33)=   "Label1(15)"
      Tab(0).Control(33).Enabled=   0   'False
      Tab(0).Control(34)=   "lblCaseFees"
      Tab(0).Control(34).Enabled=   0   'False
      Tab(0).Control(35)=   "lblCaseFee"
      Tab(0).Control(35).Enabled=   0   'False
      Tab(0).Control(36)=   "Label1(16)"
      Tab(0).Control(36).Enabled=   0   'False
      Tab(0).Control(37)=   "lblCP138"
      Tab(0).Control(37).Enabled=   0   'False
      Tab(0).Control(38)=   "lblCP84"
      Tab(0).Control(38).Enabled=   0   'False
      Tab(0).Control(39)=   "Label17(1)"
      Tab(0).Control(39).Enabled=   0   'False
      Tab(0).Control(40)=   "lblCP135"
      Tab(0).Control(40).Enabled=   0   'False
      Tab(0).Control(41)=   "lblCP136"
      Tab(0).Control(41).Enabled=   0   'False
      Tab(0).Control(42)=   "lblCP137"
      Tab(0).Control(42).Enabled=   0   'False
      Tab(0).Control(43)=   "Label20(0)"
      Tab(0).Control(43).Enabled=   0   'False
      Tab(0).Control(44)=   "lblPayToday"
      Tab(0).Control(44).Enabled=   0   'False
      Tab(0).Control(45)=   "Label30"
      Tab(0).Control(45).Enabled=   0   'False
      Tab(0).Control(46)=   "lblNameAgent"
      Tab(0).Control(46).Enabled=   0   'False
      Tab(0).Control(47)=   "Text7(20)"
      Tab(0).Control(47).Enabled=   0   'False
      Tab(0).Control(48)=   "lstNameAgent"
      Tab(0).Control(48).Enabled=   0   'False
      Tab(0).Control(49)=   "Text7(12)"
      Tab(0).Control(49).Enabled=   0   'False
      Tab(0).Control(50)=   "Text7(2)"
      Tab(0).Control(50).Enabled=   0   'False
      Tab(0).Control(51)=   "Text7(11)"
      Tab(0).Control(51).Enabled=   0   'False
      Tab(0).Control(52)=   "Text7(10)"
      Tab(0).Control(52).Enabled=   0   'False
      Tab(0).Control(53)=   "Text7(9)"
      Tab(0).Control(53).Enabled=   0   'False
      Tab(0).Control(54)=   "Text7(3)"
      Tab(0).Control(54).Enabled=   0   'False
      Tab(0).Control(55)=   "Text7(0)"
      Tab(0).Control(55).Enabled=   0   'False
      Tab(0).Control(56)=   "Text7(7)"
      Tab(0).Control(56).Enabled=   0   'False
      Tab(0).Control(57)=   "Text7(5)"
      Tab(0).Control(57).Enabled=   0   'False
      Tab(0).Control(58)=   "Text7(24)"
      Tab(0).Control(58).Enabled=   0   'False
      Tab(0).Control(59)=   "Text7(23)"
      Tab(0).Control(59).Enabled=   0   'False
      Tab(0).Control(60)=   "Text7(22)"
      Tab(0).Control(60).Enabled=   0   'False
      Tab(0).Control(61)=   "Text7(21)"
      Tab(0).Control(61).Enabled=   0   'False
      Tab(0).Control(62)=   "Text7(18)"
      Tab(0).Control(62).Enabled=   0   'False
      Tab(0).Control(63)=   "Text7(17)"
      Tab(0).Control(63).Enabled=   0   'False
      Tab(0).Control(64)=   "Text7(16)"
      Tab(0).Control(64).Enabled=   0   'False
      Tab(0).Control(65)=   "Text7(15)"
      Tab(0).Control(65).Enabled=   0   'False
      Tab(0).Control(66)=   "Text7(14)"
      Tab(0).Control(66).Enabled=   0   'False
      Tab(0).Control(67)=   "Text7(8)"
      Tab(0).Control(67).Enabled=   0   'False
      Tab(0).Control(68)=   "Text7(6)"
      Tab(0).Control(68).Enabled=   0   'False
      Tab(0).Control(69)=   "Text7(4)"
      Tab(0).Control(69).Enabled=   0   'False
      Tab(0).Control(70)=   "Text7(1)"
      Tab(0).Control(70).Enabled=   0   'False
      Tab(0).Control(71)=   "Text7(25)"
      Tab(0).Control(71).Enabled=   0   'False
      Tab(0).Control(72)=   "Text7(26)"
      Tab(0).Control(72).Enabled=   0   'False
      Tab(0).Control(73)=   "Text7(13)"
      Tab(0).Control(73).Enabled=   0   'False
      Tab(0).Control(74)=   "Text7(27)"
      Tab(0).Control(74).Enabled=   0   'False
      Tab(0).Control(75)=   "Text7(28)"
      Tab(0).Control(75).Enabled=   0   'False
      Tab(0).Control(76)=   "Text7(19)"
      Tab(0).Control(76).Enabled=   0   'False
      Tab(0).Control(77)=   "lblCP71"
      Tab(0).Control(77).Enabled=   0   'False
      Tab(0).Control(78)=   "Check1"
      Tab(0).Control(78).Enabled=   0   'False
      Tab(0).Control(79)=   "txtDate"
      Tab(0).Control(79).Enabled=   0   'False
      Tab(0).Control(80)=   "Frame1"
      Tab(0).Control(80).Enabled=   0   'False
      Tab(0).Control(81)=   "txtAD(5)"
      Tab(0).Control(81).Enabled=   0   'False
      Tab(0).Control(82)=   "Combo2"
      Tab(0).Control(82).Enabled=   0   'False
      Tab(0).Control(83)=   "txtEditInf"
      Tab(0).Control(83).Enabled=   0   'False
      Tab(0).Control(84)=   "txtAD(4)"
      Tab(0).Control(84).Enabled=   0   'False
      Tab(0).Control(85)=   "txtAD(2)"
      Tab(0).Control(85).Enabled=   0   'False
      Tab(0).Control(86)=   "txtAD(3)"
      Tab(0).Control(86).Enabled=   0   'False
      Tab(0).Control(87)=   "txtAD(1)"
      Tab(0).Control(87).Enabled=   0   'False
      Tab(0).Control(88)=   "txtCP138"
      Tab(0).Control(88).Enabled=   0   'False
      Tab(0).Control(89)=   "txtCP84"
      Tab(0).Control(89).Enabled=   0   'False
      Tab(0).Control(90)=   "txtCP135"
      Tab(0).Control(90).Enabled=   0   'False
      Tab(0).Control(91)=   "txtCP136"
      Tab(0).Control(91).Enabled=   0   'False
      Tab(0).Control(92)=   "txtCP137"
      Tab(0).Control(92).Enabled=   0   'False
      Tab(0).Control(93)=   "txtCP118"
      Tab(0).Control(93).Enabled=   0   'False
      Tab(0).Control(94)=   "txtFavDt"
      Tab(0).Control(94).Enabled=   0   'False
      Tab(0).Control(95)=   "txtPayToday"
      Tab(0).Control(95).Enabled=   0   'False
      Tab(0).Control(96)=   "CmdFav"
      Tab(0).Control(96).Enabled=   0   'False
      Tab(0).Control(97)=   "txtCP71"
      Tab(0).Control(97).Enabled=   0   'False
      Tab(0).ControlCount=   98
      TabCaption(1)   =   "鑑定報告對造"
      TabPicture(1)   =   "frm040104_3.frx":001C
      Tab(1).ControlEnabled=   0   'False
      Tab(1).Control(0)=   "Label4"
      Tab(1).Control(1)=   "Label5"
      Tab(1).Control(2)=   "Label8"
      Tab(1).Control(3)=   "Label10"
      Tab(1).Control(4)=   "Label13"
      Tab(1).Control(5)=   "Label29"
      Tab(1).Control(6)=   "Label28"
      Tab(1).Control(7)=   "Text5(7)"
      Tab(1).Control(8)=   "Text5(6)"
      Tab(1).Control(9)=   "Text5(5)"
      Tab(1).Control(10)=   "Text5(10)"
      Tab(1).Control(11)=   "Text5(9)"
      Tab(1).Control(12)=   "Text5(8)"
      Tab(1).Control(13)=   "Text5(4)"
      Tab(1).ControlCount=   14
      TabCaption(2)   =   "申請人ID / 一般資料2"
      TabPicture(2)   =   "frm040104_3.frx":0038
      Tab(2).ControlEnabled=   0   'False
      Tab(2).Control(0)=   "txtCP113"
      Tab(2).Control(1)=   "Frame2"
      Tab(2).Control(2)=   "txtAppID(4)"
      Tab(2).Control(3)=   "txtAppID(3)"
      Tab(2).Control(4)=   "txtAppID(2)"
      Tab(2).Control(5)=   "txtAppID(5)"
      Tab(2).Control(6)=   "txtAppID(1)"
      Tab(2).Control(7)=   "lblCP113(18)"
      Tab(2).Control(8)=   "Label1(14)"
      Tab(2).Control(9)=   "Label1(13)"
      Tab(2).Control(10)=   "Label1(12)"
      Tab(2).Control(11)=   "Label1(11)"
      Tab(2).Control(12)=   "Label1(10)"
      Tab(2).ControlCount=   13
      Begin VB.TextBox txtCP71 
         Height          =   280
         Left            =   8208
         MaxLength       =   7
         TabIndex        =   25
         Top             =   2304
         Width           =   975
      End
      Begin VB.TextBox txtCP113 
         Height          =   270
         Left            =   -73800
         MaxLength       =   5
         TabIndex        =   131
         Top             =   2520
         Width           =   540
      End
      Begin VB.CommandButton CmdFav 
         Caption         =   "優惠期日期"
         Height          =   270
         Left            =   2500
         TabIndex        =   153
         Top             =   2820
         Width           =   1095
      End
      Begin VB.Frame Frame2 
         BorderStyle     =   0  '沒有框線
         Height          =   435
         Left            =   -74640
         TabIndex        =   151
         Top             =   1980
         Width           =   3495
         Begin VB.ComboBox Combo1 
            Height          =   300
            ItemData        =   "frm040104_3.frx":0054
            Left            =   1635
            List            =   "frm040104_3.frx":0064
            TabIndex        =   130
            Top             =   0
            Width           =   1785
         End
         Begin VB.Label Label1 
            AutoSize        =   -1  'True
            Caption         =   "台灣設計案件屬性："
            Height          =   180
            Index           =   17
            Left            =   0
            TabIndex        =   152
            Top             =   60
            Width           =   1620
         End
      End
      Begin VB.TextBox txtPayToday 
         Height          =   270
         Left            =   8100
         MaxLength       =   1
         TabIndex        =   149
         Top             =   3900
         Width           =   255
      End
      Begin VB.TextBox txtFavDt 
         Height          =   270
         Left            =   3600
         Locked          =   -1  'True
         MaxLength       =   7
         TabIndex        =   31
         Top             =   2820
         Width           =   885
      End
      Begin VB.TextBox txtCP118 
         Height          =   270
         Left            =   8055
         MaxLength       =   1
         TabIndex        =   10
         Top             =   1560
         Width           =   255
      End
      Begin VB.TextBox txtCP137 
         Height          =   285
         Left            =   6345
         TabIndex        =   8
         Top             =   1251
         Width           =   420
      End
      Begin VB.TextBox txtCP136 
         Height          =   285
         Left            =   4590
         TabIndex        =   7
         Top             =   1245
         Width           =   420
      End
      Begin VB.TextBox txtCP135 
         Height          =   285
         Left            =   3060
         TabIndex        =   6
         Top             =   1245
         Width           =   555
      End
      Begin VB.TextBox txtCP84 
         Height          =   270
         Left            =   8055
         TabIndex        =   11
         Top             =   1251
         Width           =   975
      End
      Begin VB.TextBox txtCP138 
         Height          =   285
         Left            =   6345
         TabIndex        =   9
         Top             =   1530
         Width           =   420
      End
      Begin VB.TextBox txtAD 
         Enabled         =   0   'False
         Height          =   270
         Index           =   1
         Left            =   1935
         MaxLength       =   1
         TabIndex        =   15
         Top             =   1830
         Width           =   240
      End
      Begin VB.TextBox txtAD 
         Enabled         =   0   'False
         Height          =   270
         Index           =   3
         Left            =   1935
         MaxLength       =   1
         TabIndex        =   19
         Top             =   2070
         Width           =   240
      End
      Begin VB.TextBox txtAD 
         Enabled         =   0   'False
         Height          =   270
         Index           =   2
         Left            =   6390
         MaxLength       =   1
         TabIndex        =   17
         Top             =   1830
         Width           =   240
      End
      Begin VB.TextBox txtAD 
         Enabled         =   0   'False
         Height          =   270
         Index           =   4
         Left            =   6390
         MaxLength       =   1
         TabIndex        =   21
         Top             =   2070
         Width           =   240
      End
      Begin VB.TextBox txtAppID 
         Height          =   270
         Index           =   4
         Left            =   -73605
         MaxLength       =   10
         TabIndex        =   128
         Top             =   1350
         Width           =   1200
      End
      Begin VB.TextBox txtAppID 
         Height          =   270
         Index           =   3
         Left            =   -73605
         MaxLength       =   10
         TabIndex        =   127
         Top             =   1080
         Width           =   1200
      End
      Begin VB.TextBox txtAppID 
         Height          =   270
         Index           =   2
         Left            =   -73605
         MaxLength       =   10
         TabIndex        =   126
         Top             =   810
         Width           =   1200
      End
      Begin VB.TextBox txtAppID 
         Height          =   270
         Index           =   5
         Left            =   -73605
         MaxLength       =   10
         TabIndex        =   129
         Top             =   1620
         Width           =   1200
      End
      Begin VB.TextBox txtAppID 
         Height          =   270
         Index           =   1
         Left            =   -73605
         MaxLength       =   10
         TabIndex        =   125
         Top             =   540
         Width           =   1200
      End
      Begin VB.TextBox txtEditInf 
         Height          =   270
         Left            =   3915
         MaxLength       =   1
         TabIndex        =   13
         Top             =   1560
         Width           =   255
      End
      Begin VB.ComboBox Combo2 
         Height          =   276
         Left            =   960
         TabIndex        =   36
         Top             =   3360
         Width           =   1455
      End
      Begin VB.TextBox txtAD 
         Enabled         =   0   'False
         Height          =   270
         Index           =   5
         Left            =   1935
         MaxLength       =   1
         TabIndex        =   23
         Top             =   2310
         Width           =   240
      End
      Begin VB.Frame Frame1 
         BorderStyle     =   0  '沒有框線
         Height          =   315
         Left            =   6795
         TabIndex        =   117
         Top             =   2280
         Visible         =   0   'False
         Width           =   1785
         Begin VB.OptionButton Option1 
            Caption         =   "補發"
            Height          =   195
            Index           =   0
            Left            =   165
            TabIndex        =   118
            Top             =   90
            Width           =   735
         End
         Begin VB.OptionButton Option1 
            Caption         =   "換發"
            Height          =   195
            Index           =   1
            Left            =   1005
            TabIndex        =   119
            Top             =   90
            Width           =   735
         End
      End
      Begin VB.TextBox txtDate 
         Height          =   270
         Left            =   3510
         MaxLength       =   8
         TabIndex        =   39
         Top             =   3900
         Width           =   885
      End
      Begin VB.CheckBox Check1 
         Alignment       =   1  '靠右對齊
         Caption         =   "是否順稿:"
         Height          =   225
         Left            =   2565
         TabIndex        =   38
         Top             =   3690
         Width           =   1140
      End
      Begin VB.Label lblCP71 
         Caption         =   "延緩審查日期："
         Height          =   228
         Left            =   6855
         TabIndex        =   157
         Top             =   2370
         Width           =   1260
      End
      Begin MSForms.TextBox Text5 
         Height          =   300
         Index           =   4
         Left            =   -73296
         TabIndex        =   44
         Top             =   528
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   20
         Size            =   "3016;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text5 
         Height          =   300
         Index           =   8
         Left            =   -73290
         TabIndex        =   45
         Top             =   825
         Width           =   5535
         VariousPropertyBits=   671107099
         MaxLength       =   600
         Size            =   "9763;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text5 
         Height          =   300
         Index           =   9
         Left            =   -73290
         TabIndex        =   46
         Top             =   1125
         Width           =   5535
         VariousPropertyBits=   671107099
         MaxLength       =   600
         Size            =   "9763;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text5 
         Height          =   300
         Index           =   10
         Left            =   -73290
         TabIndex        =   47
         Top             =   1425
         Width           =   5535
         VariousPropertyBits=   671107099
         MaxLength       =   600
         Size            =   "9763;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text5 
         Height          =   300
         Index           =   5
         Left            =   -73290
         TabIndex        =   48
         Top             =   1725
         Width           =   5535
         VariousPropertyBits=   671107099
         MaxLength       =   100
         Size            =   "9763;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text5 
         Height          =   300
         Index           =   6
         Left            =   -73290
         TabIndex        =   49
         Top             =   2025
         Width           =   5535
         VariousPropertyBits=   671107099
         MaxLength       =   100
         Size            =   "9763;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text5 
         Height          =   300
         Index           =   7
         Left            =   -73290
         TabIndex        =   50
         Top             =   2325
         Width           =   5535
         VariousPropertyBits=   671107099
         MaxLength       =   100
         Size            =   "9763;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   19
         Left            =   960
         TabIndex        =   5
         Top             =   1260
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   28
         Left            =   5625
         TabIndex        =   28
         Top             =   2610
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   8
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   27
         Left            =   3465
         TabIndex        =   34
         Top             =   3120
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   13
         Left            =   1665
         TabIndex        =   37
         Top             =   3690
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   26
         Left            =   7815
         TabIndex        =   134
         Top             =   3390
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   25
         Left            =   5565
         TabIndex        =   132
         Top             =   3390
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   1
         Left            =   5820
         TabIndex        =   80
         Top             =   4200
         Visible         =   0   'False
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   9
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   4
         Left            =   960
         TabIndex        =   14
         Top             =   1830
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   9
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   6
         Left            =   960
         TabIndex        =   18
         Top             =   2070
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   9
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   8
         Left            =   960
         TabIndex        =   22
         Top             =   2310
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   9
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   14
         Left            =   1320
         TabIndex        =   0
         Top             =   330
         Width           =   6330
         VariousPropertyBits=   671107099
         MaxLength       =   160
         Size            =   "11165;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   15
         Left            =   1320
         TabIndex        =   1
         Top             =   630
         Width           =   6330
         VariousPropertyBits=   671107099
         MaxLength       =   250
         Size            =   "11165;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   16
         Left            =   1320
         TabIndex        =   2
         Top             =   930
         Width           =   6330
         VariousPropertyBits=   671107099
         MaxLength       =   160
         Size            =   "11165;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   375
         Index           =   17
         Left            =   135
         TabIndex        =   42
         Top             =   4140
         Width           =   4275
         VariousPropertyBits=   -1467987941
         MaxLength       =   2000
         ScrollBars      =   2
         Size            =   "7541;661"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   375
         Index           =   18
         Left            =   4545
         TabIndex        =   43
         Top             =   4140
         Width           =   4395
         VariousPropertyBits=   -1467987941
         MaxLength       =   2000
         ScrollBars      =   2
         Size            =   "7752;661"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   21
         Left            =   1470
         TabIndex        =   12
         Top             =   1560
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   22
         Left            =   960
         TabIndex        =   26
         Top             =   2550
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   6
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   23
         Left            =   5760
         TabIndex        =   24
         Top             =   2340
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   24
         Left            =   960
         TabIndex        =   30
         Top             =   2820
         Width           =   1455
         VariousPropertyBits=   671107099
         MaxLength       =   20
         Size            =   "2566;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   5
         Left            =   5400
         TabIndex        =   16
         Top             =   1830
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   9
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   7
         Left            =   5400
         TabIndex        =   20
         Top             =   2070
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   9
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   0
         Left            =   960
         TabIndex        =   33
         Top             =   3075
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   8
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   3
         Left            =   3465
         TabIndex        =   27
         Top             =   2550
         Width           =   885
         VariousPropertyBits=   671107099
         MaxLength       =   8
         Size            =   "1561;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   9
         Left            =   5565
         TabIndex        =   40
         Top             =   3660
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   10
         Left            =   7815
         TabIndex        =   41
         Top             =   3660
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   11
         Left            =   7695
         TabIndex        =   29
         Top             =   2610
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   8
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   2
         Left            =   5400
         TabIndex        =   32
         Top             =   2865
         Width           =   975
         VariousPropertyBits=   671107099
         MaxLength       =   4
         Size            =   "1720;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   12
         Left            =   5400
         TabIndex        =   35
         Top             =   3120
         Width           =   3525
         VariousPropertyBits=   671107099
         MaxLength       =   20
         Size            =   "6218;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.ListBox lstNameAgent 
         Height          =   756
         Left            =   7716
         TabIndex        =   4
         Top             =   492
         Width           =   1500
         ScrollBars      =   2
         DisplayStyle    =   2
         Size            =   "2646;1333"
         MatchEntry      =   0
         ListStyle       =   1
         MultiSelect     =   1
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.TextBox Text7 
         Height          =   300
         Index           =   20
         Left            =   8790
         TabIndex        =   3
         TabStop         =   0   'False
         Top             =   270
         Width           =   255
         VariousPropertyBits=   671107099
         MaxLength       =   1
         Size            =   "450;529"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin VB.Label lblCP113 
         AutoSize        =   -1  'True
         Caption         =   "工作時數:"
         Height          =   180
         Index           =   18
         Left            =   -74640
         TabIndex        =   156
         Top             =   2565
         Width           =   765
      End
      Begin VB.Label lblNameAgent 
         AutoSize        =   -1  'True
         Caption         =   "出名代理人"
         Height          =   180
         Left            =   7740
         TabIndex        =   155
         Top             =   300
         Width           =   900
      End
      Begin VB.Label Label30 
         AutoSize        =   -1  'True
         Caption         =   "案件名稱(中):"
         Height          =   180
         Left            =   120
         TabIndex        =   154
         Top             =   360
         Width           =   1068
      End
      Begin VB.Label lblPayToday 
         AutoSize        =   -1  'True
         Caption         =   "電子送件是否當日扣款:         (Y/N)"
         Height          =   180
         Left            =   6165
         TabIndex        =   150
         Top             =   3930
         Width           =   2655
      End
      Begin VB.Label Label20 
         AutoSize        =   -1  'True
         Caption         =   "是否電子送件:         (Y:是)"
         Height          =   180
         Index           =   0
         Left            =   6885
         TabIndex        =   148
         Top             =   1590
         Width           =   1995
      End
      Begin VB.Label lblCP137 
         Alignment       =   1  '靠右對齊
         AutoSize        =   -1  'True
         Caption         =   "刪除未審項數:"
         Height          =   180
         Left            =   5175
         TabIndex        =   147
         Top             =   1305
         Width           =   1125
      End
      Begin VB.Label lblCP136 
         Alignment       =   1  '靠右對齊
         AutoSize        =   -1  'True
         Caption         =   "增加項數:"
         Height          =   180
         Left            =   3780
         TabIndex        =   146
         Top             =   1305
         Width           =   765
      End
      Begin VB.Label lblCP135 
         Alignment       =   1  '靠右對齊
         AutoSize        =   -1  'True
         Caption         =   "頁數:"
         Height          =   180
         Left            =   2580
         TabIndex        =   145
         Top             =   1305
         Width           =   405
      End
      Begin VB.Label Label17 
         AutoSize        =   -1  'True
         Caption         =   "預估准駁:         (1.准 2.駁)"
         Height          =   180
         Index           =   1
         Left            =   105
         TabIndex        =   144
         Top             =   1305
         Width           =   1965
      End
      Begin VB.Label lblCP84 
         AutoSize        =   -1  'True
         Caption         =   "發文規費:"
         Height          =   180
         Left            =   7230
         TabIndex        =   143
         Top             =   1305
         Width           =   765
      End
      Begin VB.Label lblCP138 
         Alignment       =   1  '靠右對齊
         AutoSize        =   -1  'True
         Caption         =   "刪除已審項數:"
         Height          =   180
         Left            =   5175
         TabIndex        =   142
         Top             =   1590
         Width           =   1125
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "順稿期限:"
         Height          =   180
         Index           =   16
         Left            =   2610
         TabIndex        =   141
         Top             =   3960
         Width           =   765
      End
      Begin VB.Label lblCaseFee 
         Appearance      =   0  '平面
         AutoSize        =   -1  'True
         Caption         =   "@"
         BeginProperty Font 
            Name            =   "Webdings"
            Size            =   12
            Charset         =   2
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         ForeColor       =   &H000000C0&
         Height          =   285
         Left            =   8685
         TabIndex        =   139
         Tag             =   "Y"
         Top             =   2550
         Width           =   255
      End
      Begin VB.Label lblCaseFees 
         BackColor       =   &H80000010&
         Height          =   255
         Left            =   8730
         TabIndex        =   140
         Top             =   2610
         Width           =   255
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "指定提申日:"
         Height          =   180
         Index           =   15
         Left            =   4545
         TabIndex        =   138
         Top             =   2625
         Width           =   945
      End
      Begin MSForms.Label Label3 
         Height          =   180
         Index           =   12
         Left            =   6750
         TabIndex        =   85
         Top             =   2115
         Width           =   2190
         VariousPropertyBits=   27
         Caption         =   "Label3"
         Size            =   "3863;317"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin VB.Label lblCP120 
         AutoSize        =   -1  'True
         Caption         =   "說明書要電子檔:       (Y:是)"
         Height          =   180
         Left            =   2115
         TabIndex        =   137
         Top             =   3150
         Width           =   2085
      End
      Begin VB.Label Label17 
         AutoSize        =   -1  'True
         Caption         =   "是否有送證明文件:        ( Y/N )"
         Height          =   180
         Index           =   3
         Left            =   135
         TabIndex        =   136
         Top             =   3690
         Width           =   2340
      End
      Begin VB.Label lblLetter 
         AutoSize        =   -1  'True
         Caption         =   "修改指示信:       (Y:Word)"
         Height          =   180
         Index           =   3
         Left            =   6840
         TabIndex        =   135
         Top             =   3435
         Width           =   1950
      End
      Begin VB.Label lblLetter 
         AutoSize        =   -1  'True
         Caption         =   "列印指示信:       (N:不印)"
         Height          =   180
         Index           =   2
         Left            =   4590
         TabIndex        =   133
         Top             =   3435
         Width           =   1905
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人5  ID"
         Height          =   180
         Index           =   14
         Left            =   -74640
         TabIndex        =   124
         Top             =   1665
         Width           =   900
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人4  ID"
         Height          =   180
         Index           =   13
         Left            =   -74640
         TabIndex        =   123
         Top             =   1395
         Width           =   900
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人3  ID"
         Height          =   180
         Index           =   12
         Left            =   -74640
         TabIndex        =   122
         Top             =   1125
         Width           =   900
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人2  ID"
         Height          =   180
         Index           =   11
         Left            =   -74640
         TabIndex        =   121
         Top             =   855
         Width           =   900
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人1  ID"
         Height          =   180
         Index           =   10
         Left            =   -74640
         TabIndex        =   120
         Top             =   585
         Width           =   900
      End
      Begin VB.Label Label20 
         AutoSize        =   -1  'True
         Caption         =   "是否郵寄申請:         (Y:郵寄)"
         Height          =   180
         Index           =   1
         Left            =   4560
         TabIndex        =   90
         Top             =   2370
         Width           =   2535
      End
      Begin MSForms.Label Label3 
         Height          =   180
         Index           =   5
         Left            =   6480
         TabIndex        =   98
         Top             =   2916
         Width           =   2424
         VariousPropertyBits=   27
         Caption         =   "Label3"
         Size            =   "4276;317"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin VB.Label Label17 
         AutoSize        =   -1  'True
         Caption         =   "主管機關:"
         Height          =   180
         Index           =   2
         Left            =   4560
         TabIndex        =   116
         Top             =   3165
         Width           =   765
      End
      Begin VB.Label lblLetter 
         AutoSize        =   -1  'True
         Caption         =   "是否修改通知函:       (Y:Word)"
         Height          =   180
         Index           =   1
         Left            =   2580
         TabIndex        =   115
         Top             =   1590
         Width           =   2310
      End
      Begin VB.Label Label28 
         AutoSize        =   -1  'True
         Caption         =   "對造號數:"
         Height          =   180
         Left            =   -74856
         TabIndex        =   114
         Top             =   588
         Width           =   768
      End
      Begin VB.Label Label29 
         AutoSize        =   -1  'True
         Caption         =   "對造案件名稱(中):"
         Height          =   180
         Left            =   -74850
         TabIndex        =   113
         Top             =   1785
         Width           =   1425
      End
      Begin VB.Label Label13 
         AutoSize        =   -1  'True
         Caption         =   "對造案件名稱(英):"
         Height          =   180
         Left            =   -74850
         TabIndex        =   112
         Top             =   2085
         Width           =   1425
      End
      Begin VB.Label Label10 
         AutoSize        =   -1  'True
         Caption         =   "對造案件名稱(日):"
         Height          =   180
         Left            =   -74850
         TabIndex        =   111
         Top             =   2385
         Width           =   1425
      End
      Begin VB.Label Label8 
         AutoSize        =   -1  'True
         Caption         =   "對造名稱(中):"
         Height          =   180
         Left            =   -74856
         TabIndex        =   110
         Top             =   885
         Width           =   1068
      End
      Begin VB.Label Label5 
         AutoSize        =   -1  'True
         Caption         =   "對造名稱(英):"
         Height          =   180
         Left            =   -74850
         TabIndex        =   109
         Top             =   1185
         Width           =   1065
      End
      Begin VB.Label Label4 
         AutoSize        =   -1  'True
         Caption         =   "對造名稱(日):"
         Height          =   180
         Left            =   -74850
         TabIndex        =   108
         Top             =   1485
         Width           =   1065
      End
      Begin VB.Label Label17 
         AutoSize        =   -1  'True
         Caption         =   "發文日:"
         Height          =   180
         Index           =   0
         Left            =   120
         TabIndex        =   107
         Top             =   3120
         Width           =   585
      End
      Begin VB.Label Label11 
         AutoSize        =   -1  'True
         Caption         =   "催審期限:"
         Height          =   180
         Left            =   6855
         TabIndex        =   106
         Top             =   2625
         Width           =   765
      End
      Begin VB.Label Label14 
         AutoSize        =   -1  'True
         Caption         =   "代理人:"
         Height          =   180
         Left            =   120
         TabIndex        =   105
         Top             =   3390
         Width           =   585
      End
      Begin VB.Label Label16 
         AutoSize        =   -1  'True
         Caption         =   "案件性質:"
         Height          =   180
         Left            =   4560
         TabIndex        =   104
         Top             =   2880
         Width           =   765
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人1"
         Height          =   180
         Index           =   2
         Left            =   120
         TabIndex        =   103
         Top             =   1875
         Width           =   630
      End
      Begin VB.Label Label31 
         AutoSize        =   -1  'True
         Caption         =   "案件名稱(英):"
         Height          =   180
         Left            =   120
         TabIndex        =   102
         Top             =   630
         Width           =   1065
      End
      Begin VB.Label Label32 
         AutoSize        =   -1  'True
         Caption         =   "案件名稱(日):"
         Height          =   180
         Left            =   120
         TabIndex        =   101
         Top             =   960
         Width           =   1065
      End
      Begin VB.Label Label33 
         AutoSize        =   -1  'True
         Caption         =   "進度備註:"
         Height          =   180
         Left            =   120
         TabIndex        =   100
         Top             =   3960
         Width           =   765
      End
      Begin VB.Label Label34 
         AutoSize        =   -1  'True
         Caption         =   "案件備註:"
         Height          =   180
         Left            =   4560
         TabIndex        =   99
         Top             =   3960
         Width           =   765
      End
      Begin MSForms.Label Label3 
         Height          =   180
         Index           =   6
         Left            =   2520
         TabIndex        =   97
         Top             =   3420
         Width           =   1860
         VariousPropertyBits=   27
         Caption         =   "Label3"
         Size            =   "3281;317"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人3"
         Height          =   180
         Index           =   3
         Left            =   120
         TabIndex        =   96
         Top             =   2115
         Width           =   630
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人5"
         Height          =   180
         Index           =   4
         Left            =   120
         TabIndex        =   95
         Top             =   2355
         Width           =   630
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人2"
         Height          =   180
         Index           =   5
         Left            =   4560
         TabIndex        =   94
         Top             =   1875
         Width           =   630
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請人4"
         Height          =   180
         Index           =   6
         Left            =   4560
         TabIndex        =   93
         Top             =   2115
         Width           =   630
      End
      Begin VB.Label lblLetter 
         AutoSize        =   -1  'True
         Caption         =   "是否列印通知函:        (N:不印)"
         Height          =   180
         Index           =   0
         Left            =   105
         TabIndex        =   92
         Top             =   1590
         Width           =   2340
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "支援時數:"
         Height          =   180
         Index           =   7
         Left            =   120
         TabIndex        =   91
         Top             =   2595
         Width           =   765
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "申請案號:"
         Height          =   180
         Index           =   8
         Left            =   120
         TabIndex        =   89
         Top             =   2865
         Width           =   765
      End
      Begin MSForms.Label Label3 
         Height          =   180
         Index           =   9
         Left            =   2265
         TabIndex        =   88
         Top             =   1875
         Width           =   2190
         VariousPropertyBits=   27
         Caption         =   "Label3"
         Size            =   "3863;317"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.Label Label3 
         Height          =   180
         Index           =   10
         Left            =   6750
         TabIndex        =   87
         Top             =   1875
         Width           =   2190
         VariousPropertyBits=   27
         Caption         =   "Label3"
         Size            =   "3863;317"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.Label Label3 
         Height          =   180
         Index           =   11
         Left            =   2265
         TabIndex        =   86
         Top             =   2115
         Width           =   2190
         VariousPropertyBits=   27
         Caption         =   "Label3"
         Size            =   "3863;317"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin MSForms.Label Label3 
         Height          =   180
         Index           =   13
         Left            =   2265
         TabIndex        =   84
         Top             =   2355
         Width           =   2190
         VariousPropertyBits=   27
         Caption         =   "Label3"
         Size            =   "3863;317"
         FontName        =   "新細明體-ExtB"
         FontHeight      =   180
         FontCharSet     =   136
         FontPitchAndFamily=   34
      End
      Begin VB.Label Label1 
         AutoSize        =   -1  'True
         Caption         =   "最終提申期限:"
         Height          =   180
         Index           =   9
         Left            =   2295
         TabIndex        =   83
         Top             =   2595
         Width           =   1125
      End
      Begin VB.Label lblLetter 
         AutoSize        =   -1  'True
         Caption         =   "列印申請書:       (N:不印)"
         Height          =   180
         Index           =   4
         Left            =   4590
         TabIndex        =   82
         Top             =   3690
         Width           =   1905
      End
      Begin VB.Label lblLetter 
         AutoSize        =   -1  'True
         Caption         =   "修改申請書:       (Y:Word)"
         Height          =   180
         Index           =   5
         Left            =   6840
         TabIndex        =   81
         Top             =   3690
         Width           =   1950
      End
   End
   Begin VB.CommandButton cmdOK 
      Caption         =   "前畫面(&U)"
      CausesValidation=   0   'False
      Height          =   375
      Index           =   1
      Left            =   8295
      TabIndex        =   58
      Top             =   0
      Width           =   990
   End
   Begin VB.CommandButton cmdOK 
      Caption         =   "確定(&O)"
      Default         =   -1  'True
      Height          =   375
      Index           =   0
      Left            =   7455
      TabIndex        =   57
      Top             =   0
      Width           =   825
   End
   Begin VB.CommandButton cmdOK 
      Caption         =   "同時發文"
      Height          =   375
      Index           =   3
      Left            =   6525
      TabIndex        =   56
      Top             =   0
      Width           =   900
   End
   Begin VB.CommandButton cmdOK 
      Caption         =   "相關卷號"
      Height          =   375
      Index           =   5
      Left            =   5535
      TabIndex        =   55
      Top             =   0
      Width           =   975
   End
   Begin VB.CommandButton cmdOK 
      Cancel          =   -1  'True
      Caption         =   "結束"
      CausesValidation=   0   'False
      Height          =   375
      Index           =   2
      Left            =   9120
      TabIndex        =   59
      Top             =   6240
      Width           =   972
   End
   Begin VB.TextBox Text4 
      BackColor       =   &H00E0E0E0&
      Enabled         =   0   'False
      Height          =   270
      Left            =   2724
      MaxLength       =   2
      TabIndex        =   66
      Top             =   639
      Width           =   375
   End
   Begin VB.TextBox Text3 
      BackColor       =   &H00E0E0E0&
      Enabled         =   0   'False
      Height          =   270
      Left            =   2484
      MaxLength       =   1
      TabIndex        =   65
      Top             =   639
      Width           =   255
   End
   Begin VB.TextBox Text2 
      BackColor       =   &H00E0E0E0&
      Enabled         =   0   'False
      Height          =   270
      Left            =   1644
      MaxLength       =   6
      TabIndex        =   64
      Top             =   639
      Width           =   855
   End
   Begin VB.TextBox Text1 
      BackColor       =   &H00E0E0E0&
      Enabled         =   0   'False
      Height          =   270
      Left            =   1164
      MaxLength       =   3
      TabIndex        =   63
      Top             =   639
      Width           =   495
   End
   Begin VB.CommandButton cmdOK 
      BackColor       =   &H008080FF&
      Caption         =   "修正/變更事項"
      Height          =   375
      Index           =   4
      Left            =   4230
      Style           =   1  '圖片外觀
      TabIndex        =   54
      Top             =   0
      Width           =   1272
   End
   Begin VB.CommandButton Command2 
      Caption         =   "補件期限"
      Height          =   375
      Index           =   2
      Left            =   3240
      TabIndex        =   53
      Top             =   0
      Width           =   975
   End
   Begin VB.CommandButton Command2 
      Caption         =   "優先權資料"
      Height          =   375
      Index           =   1
      Left            =   2115
      TabIndex        =   52
      Top             =   0
      Width           =   1095
   End
   Begin VB.CommandButton Command2 
      Caption         =   "發明人"
      Height          =   375
      Index           =   0
      Left            =   1365
      TabIndex        =   51
      Top             =   0
      Width           =   735
   End
   Begin MSForms.Label Label3 
      Height          =   210
      Index           =   8
      Left            =   4410
      TabIndex        =   78
      Top             =   930
      Width           =   1530
      VariousPropertyBits=   27
      Caption         =   "Label3"
      Size            =   "2699;370"
      FontName        =   "新細明體-ExtB"
      FontHeight      =   180
      FontCharSet     =   136
      FontPitchAndFamily=   34
   End
   Begin VB.Label Label1 
      AutoSize        =   -1  'True
      Caption         =   "申請國家"
      Height          =   180
      Index           =   1
      Left            =   3570
      TabIndex        =   77
      Top             =   930
      Width           =   720
   End
   Begin VB.Label Label7 
      AutoSize        =   -1  'True
      Caption         =   "法定期限:"
      Height          =   180
      Index           =   1
      Left            =   6090
      TabIndex        =   76
      Top             =   690
      Width           =   765
   End
   Begin MSForms.Label Label3 
      Height          =   210
      Index           =   7
      Left            =   7170
      TabIndex        =   75
      Top             =   690
      Width           =   1980
      VariousPropertyBits=   27
      Caption         =   "Label3"
      Size            =   "3492;370"
      FontName        =   "新細明體-ExtB"
      FontHeight      =   180
      FontCharSet     =   136
      FontPitchAndFamily=   34
   End
   Begin MSForms.Label Label3 
      Height          =   210
      Index           =   4
      Left            =   7170
      TabIndex        =   74
      Top             =   930
      Width           =   1980
      VariousPropertyBits=   27
      Caption         =   "Label3"
      Size            =   "3492;370"
      FontName        =   "新細明體-ExtB"
      FontHeight      =   180
      FontCharSet     =   136
      FontPitchAndFamily=   34
   End
   Begin MSForms.Label Label3 
      Height          =   210
      Index           =   3
      Left            =   7170
      TabIndex        =   73
      Top             =   450
      Width           =   1980
      VariousPropertyBits=   27
      Caption         =   "Label3"
      Size            =   "3492;370"
      FontName        =   "新細明體-ExtB"
      FontHeight      =   180
      FontCharSet     =   136
      FontPitchAndFamily=   34
   End
   Begin MSForms.Label Label3 
      Height          =   210
      Index           =   2
      Left            =   4410
      TabIndex        =   72
      Top             =   690
      Width           =   1530
      VariousPropertyBits=   27
      Caption         =   "Label3"
      Size            =   "2699;370"
      FontName        =   "新細明體-ExtB"
      FontHeight      =   180
      FontCharSet     =   136
      FontPitchAndFamily=   34
   End
   Begin MSForms.Label Label3 
      Height          =   210
      Index           =   1
      Left            =   4410
      TabIndex        =   71
      Top             =   450
      Width           =   1530
      VariousPropertyBits=   27
      Caption         =   "Label3"
      Size            =   "2699;370"
      FontName        =   "新細明體-ExtB"
      FontHeight      =   180
      FontCharSet     =   136
      FontPitchAndFamily=   34
   End
   Begin VB.Label Label12 
      AutoSize        =   -1  'True
      Caption         =   "承辦人:"
      Height          =   180
      Left            =   6090
      TabIndex        =   70
      Top             =   930
      Width           =   585
   End
   Begin VB.Label Label9 
      AutoSize        =   -1  'True
      Caption         =   "收款後辦案:"
      Height          =   180
      Left            =   6090
      TabIndex        =   69
      Top             =   450
      Width           =   945
   End
   Begin VB.Label Label7 
      AutoSize        =   -1  'True
      Caption         =   "本所期限:"
      Height          =   180
      Index           =   0
      Left            =   3570
      TabIndex        =   68
      Top             =   690
      Width           =   765
   End
   Begin VB.Label Label6 
      AutoSize        =   -1  'True
      Caption         =   "本所案號:"
      Height          =   180
      Left            =   210
      TabIndex        =   67
      Top             =   690
      Width           =   765
   End
   Begin VB.Label Label2 
      AutoSize        =   -1  'True
      Caption         =   "智權人員:"
      Height          =   180
      Index           =   0
      Left            =   3570
      TabIndex        =   62
      Top             =   450
      Width           =   765
   End
   Begin MSForms.Label Label3 
      Height          =   210
      Index           =   0
      Left            =   1170
      TabIndex        =   61
      Top             =   450
      Width           =   1950
      VariousPropertyBits=   27
      Caption         =   "Label3"
      Size            =   "3440;370"
      FontName        =   "新細明體-ExtB"
      FontHeight      =   180
      FontCharSet     =   136
      FontPitchAndFamily=   34
   End
   Begin VB.Label Label1 
      AutoSize        =   -1  'True
      Caption         =   "收文號:"
      Height          =   180
      Index           =   0
      Left            =   210
      TabIndex        =   60
      Top             =   450
      Width           =   585
   End
End
Attribute VB_Name = "frm040104_3"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'Memo by Morgan 2023/3/1 改成Form2.0 (Text5)
'Memo by Lydia 2022/05/30 (已檢查)整理frm880005改用寄信模組
'Memo by Morgan 2021/12/14 改成Form2.0 (Text7,lstNameAgent,Label3)
'Memo by Morgan 2018/5/24 指定國家相關程式沒用,已移除
'Memo By Morgan 2012/12/11 智權人員欄已修改
'Memo by Morgan2010/12/27 申請案號欄已修改
'2010/12/3 memo by sonia 員工編號欄已修改
'Memo by Morgan2010/8/10 日期欄已修改
'整理 by Morgan 2005/7/15
Option Explicit

Dim strReceiveNo As String
'Modify by Morgan 2005/7/13 改用動態陣列
'Dim pa(T_PA) As String, cp(T_CP) As String
Dim pa() As String, cp() As String

Dim intWhere As Integer
'strInventor(1):申請人
'strInventor(2):發明人
Dim strInventor(1 To 2) As String, strPriority(1 To 5) As String 'Modify by Amy 2014/04/08 +strPriority(5)
Dim strAdddeadline(1 To 3) As String
'Add By Cheng 2002/08/23
Dim m_strCust1 As String '申請人1
Dim m_strCust2 As String '申請人2
Dim m_strCust3 As String '申請人3
Dim m_strCust4 As String '申請人4
Dim m_strCust5 As String '申請人5
'Add By Cheng 2003/09/12
'Dim m_strMailCP09 As String  '2010/1/21 CANCEL BY SONIA
Dim skMail() As SeekMails     '2010/1/21 ADD BY SONIA
'Add By Cheng 2003/10/06
Dim m_blnClkChgEvnBtn As Boolean '是否按下變更事項按鈕
'Add by Morgan 2004/3/30
'實審通知日本所期限,法定期限,母案收文號
Dim m_stVar(0 To 3) As String, m_stCP09 As String
'Add by Morgan 2004/7/19
Dim m_CU15(1 To 5) As String  '申請人身分
Dim m_CU10(1 To 5) As String  '申請人國籍
Dim m_bolCheck As Boolean   '是否為存檔前檢查
'Add by Morgan 2004/7/22
Dim m_DiscType As String   '減免身分
'Add by Morgan 2005/11/7
Dim m_bolRePriDate As Boolean '優先權資料需重新輸入
'2006/5/22 ADD BY SONIA
Dim m_Close413429 As String   '自請撤回413,放棄專利權429詢問是否閉卷
Dim m_DualCase429 As Boolean '是否放棄專利權429且為大陸新型一案兩請案
Dim m_DualCase429Memo As String '閉卷進度備註
'Add by Morgan 2007/10/19
Dim m_NoPicMailSub As String '無代表圖的通知信主旨
Dim m_CP09s As String, m_CP123s As String 'Add by Morgan 2009/3/23 收文號,是否算發文室案件
Dim m_CP130 As String 'Add by Morgan 2009/4/28 發文-主管機關
Dim m_si880017 As Single '補件期限按鈕回傳狀態
Dim m_bolFMP As Boolean 'Add by Morgan 2009/11/13 是否 FMP 案
Dim m_bolFMP2 As Boolean 'Added by Lydia 2023/06/15 是否為寰華案
'Add by Morgan 2010/1/6
Dim m_bol99Case As Boolean '是否99年後申請案件
Dim m_bolChkFee As Boolean '是否需檢查規費
Dim m_bolChkPageItem As Boolean '是否要輸頁數與項數
Dim m_lngOverPageFee As Long, m_lngOverItemFee As Long '超頁費,超項費
Dim m_lngOverPageFeeDiff As Long, m_lngOverItemFeeDiff As Long '超頁費,超項費差額
Dim m_lngRecOverPageFee As Long, m_lngRecOverItemFee As Long '已收文超頁費,超項費 Add by Morgan 2011/6/29
Dim m_FeeMemo As String '規費備註
'end 2010/1/6
Dim m_bolChkItem As Boolean '是否要檢查增刪項數 Add by Morgan 2010/10/11
Dim m_st231CP09 As String '寄存證明收文號 Added by Morgan 2012/6/28
Dim m_bolCtrl231 As Boolean '是否管制寄存證明 Added by Morgan 2012/6/28
Dim m_bolUpdatePA161 As Boolean '更新以專利商標出名 Added by Morgan 2012/9/14
Dim m_DualCase429Tw As Boolean '是否放棄專利權429且為台灣新型一案兩請案 Added by Morgan 2012/9/18
Dim m_bolAutoMail As Boolean, m_Subject As String 'Added by Morgan 2012/11/8
Dim m_PA163 As String 'Added by Morgan 2012/12/27

'Added by Morgan 2013/1/10
Dim m_bolDelay As Boolean '是否有延期過
Dim m_strDelayCP09 As String '延期收文號
Dim m_bol107NewFee As Boolean '台灣再審是否用102年新規費計算
Dim m_bolFixNewFee As Boolean '台灣修正是否用102年新規費計算
Dim m_strReExamCP27 As String '台灣再審發文日(若再審延期發文日)
Dim cm(5 To 8) As String 'Add by Amy 2013/08/06 國內案案號
'Add by Amy 2014/04/22  for 若P案(台灣或大陸)有關聯案使用
Dim bolFirstInventor As Boolean '是否第一次進發明人資料
Dim DefInventor As String, OrgInventor As String '預設關聯案發明人/本案發明人
Dim str950CP43 As String 'Add By Sindy 2014/7/24 案件暫緩的相關總收文號
Dim bolAuto941Case As Boolean, strAuto941RefFileName As String 'Added by Morgan 2014/12/15 分析是否為舉發(答辯)審定的內部收文, 客戶函pdf檔名
Dim strOldFileName As String, strNewFileName As String 'Added by Morgan 2015/3/17 工程師上傳的分析函檔名
'Dim bolNoPost As Boolean 'Added by Morgan 2015/7/8 客戶通知函是否不寄發 'Removed by Morgan 2018/12/10
Dim bolPost As Boolean 'Added by Morgan 2018/9/12 是否寄發客戶函
Dim bolRegMail As Boolean 'Added by Morgan 2018/12/10 是否掛號直寄

Dim strCopies As String 'Added by Morgan 2016/8/1 指示信申請優先權證明書份數
Dim m_DualCaseNo(1 To 4) As String 'Added by Lydia 2016/09/29 發明一案兩請案的新型案本所號
Dim m_DualCase429B As Boolean 'Added by Lydia 2016/09/29 大陸案一案兩請的新型案,有內部收文放棄專利權
Dim m_990CP09 As String 'Added by Morgan 2016/11/29 副本信函收文號
Dim m_bAutoBProc As Boolean 'Added by Morgan 2019/2/22 是否內部收文管制開庭期限
Public m_bClickInventor As Boolean '自動點選發明人 Added by Morgan 2020/2/19
Dim stCP12 As String, stCP13 As String 'Add by Morgan 2010/1/6 最新收文智權人員
Dim bolSetPA165 As Boolean 'Added by Morgan 2021/2/4
'Added by Lydia 2022/05/23
Dim m_LosCP84 As String ' 法律所案源之規費
Dim m_LOS15 As String '法律所案源單號
Dim m_LOS02 As String '法律所案源類別
Dim m_LosMemo As String  'email說明
Dim bolChk414for106 As Boolean, strFirstPriDate As String 'Added by Lydia 2023/06/15 寰華案:是否為「414恢復權利-主張優先權106」、最早優先權日
Dim m_bChk939 As Boolean 'Added by Morgan 2023/8/24
Dim m_CP416forCP07 As String 'Added by Lydia 2025/02/12 實審的法限

Private Sub StartLetter(ByVal ET01 As String, ByVal ET03 As String)
 Dim strTxt(1 To 5) As String, intStep As Integer, i As Integer
 
   EndLetter ET01, strReceiveNo, ET03, strUserNum
   intStep = 1
   'Add by Morgan 2004/12/16 聯合加註編號
   'Modified by Morgan 2012/1/16 申請號改 9 碼
   If ET01 = "01" And pa(9) = "000" And Me.Text7(2).Text = "603" Then
      strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
           "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
           "','加註號','" & PUB_ChgNumber2Chinese(Val(Mid(pa(11), 11))) & "')"
        intStep = intStep + 1
   Else
   
      If Text7(3) <> "" Then
         If ET03 = "31" Then
            strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
               "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
               "','有無提申期限','本案即將公開，故最遲須於" & Left(ChangeTStringToWString(Text7(3)), 4) & _
               "年" & Mid(ChangeTStringToWString(Text7(3)), 5, 2) & "月" & Mid(ChangeTStringToWString(Text7(3)), 7, 2) & "日前提申，')"
         Else
            strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
               "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
               "','有無提申期限','故須於" & Left(ChangeTStringToWString(Text7(3)), 4) & _
               "年" & Mid(ChangeTStringToWString(Text7(3)), 5, 2) & "月" & Mid(ChangeTStringToWString(Text7(3)), 7, 2) & "日前提申，')"
         End If
         intStep = 2
      End If
      If Text7(0) <> "" Then
         strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
            "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
            "','提申期限註解','＊本案倘於" & Left(CompDate(2, 10, TransDate(Text7(0), 2)), 4) & _
            "年" & Mid(CompDate(2, 10, TransDate(Text7(0), 2)), 5, 2) & "月" & Mid(CompDate(2, 10, TransDate(Text7(0), 2)), 7, 2) & "日仍未接獲，則請儘速傳真告知本所')"
         intStep = intStep + 1
      End If
      
      strExc(0) = ""
      If strExc(0) <> "" Then
         If Right(strExc(0), 1) = "," Then strExc(0) = Left(strExc(0), Len(strExc(0)) - 1)
         strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
            "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
            "','附件內容','" & strExc(0) & "')"
         intStep = intStep + 1
      End If
      
      'Add By Cheng 2002/07/12
      If Me.Text7(12).Text <> "" Then
         strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
            "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
            "','來函主管機關','" & Me.Text7(12).Text & "')"
         intStep = intStep + 1
      End If
      'Add By Cheng 2003/01/03
      If Me.Text7(2).Text = 補換發證書 Then
          strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
             "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
             "','附件','" & IIf(Me.Option1(0).Value = True, "補發證書", "換發證書") & "')"
          intStep = intStep + 1
      End If
      'add by sonia 2019/3/21
      If Me.Text7(2).Text = "243" Then
          strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
             "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
             "','附件','" & IIf(Me.Text7(12).Text = "經濟部", "訴願", "行政") & "')"
          intStep = intStep + 1
      End If
      'end 2019/3/21
    
   End If
   
   'Added by Morgan 2017/6/20
   '大陸發明案陳述意見發文時，若show訊息"放棄專利權將一併上發文"時客戶通知函加有聲明放棄新型訊息--韻丞
   If m_DualCase429B Then
      strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
         "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
         "','一案兩請新型案','" & m_DualCaseNo(1) & "-" & m_DualCaseNo(2) & IIf(m_DualCaseNo(3) & m_DualCaseNo(4) = "000", "", "-" & m_DualCaseNo(3) & "-" & m_DualCaseNo(4)) & "')"
      intStep = intStep + 1
   End If
   'end 2017/6/20
   
   'Added by Morgan 2025/6/16
   '台灣再審/申復有同時收文修正且相關收文號相同時，不論是否為內部收文，通知函要帶出修正。--玲玲
   If pa(9) = "000" And (cp(10) = "205" Or cp(10) = "107") And cp(43) <> "" Then
      If PUB_ChkCPExist(cp(), "204", , , , , , cp(43)) Then
         strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
            "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
            "','有收文修正要印','♀')"
         intStep = intStep + 1
      End If
   End If
   'end 2025/6/16
   
   'edit by nickc 2007/02/05 不用 dll 了
   'If Not objLawDll.ExecSQL(intStep - 1, strTxt) Then
   If Not ClsLawExecSQL(intStep - 1, strTxt) Then
      MsgBox "儲存例外欄位失敗，請洽系統管理員 !", vbCritical
   End If
End Sub
'Modify by Morgan 2009/12/29 不必控制是否出定稿
Private Sub Check1_Click()
   If Check1.Value = 0 Then
      txtDate = ""
      'Text7(21) = ""
   Else
      'Text7(21) = "N"
   End If
End Sub

Private Function Process(Index As Integer) As Boolean
Dim bolChk As Boolean, strTmp As String
Dim bolMsg As Boolean '是否彈視窗
Dim strContent As String, strMailTo As String 'Add by Morgan 2012/11/8
Dim strInvNo As String, strPA01 As String, strPA02 As String, strPA03 As String, strPA04 As String 'Add By Sindy 2014/4/15
Dim rsTmp As ADODB.Recordset 'Add By Sindy 2014/6/4
Dim strPath As String, strFile As String 'Added by Morgan 2016/5/11
'Added by Lydia 2019/12/05
Dim strFilePath As String '記錄智慧局收文文號
Dim strNewCP64 As String '保留進度備註
Dim bolUp As Boolean 'Added by Lydia 2020/03/23 是否需要上傳檔案到卷宗區
Dim strAnoPA() As String, strCaseNo As String, bolIsExistsCP10 As Boolean, bolIsDualApply As Boolean, bolAnoDated As Boolean 'Add By Sindy 2022/11/14

   ' 90.07.17 modify by louis (申請人1一定要輸入)
   If IsEmptyText(Text7(4)) = True Then
      MsgBox "請輸入申請人1", vbOKOnly + vbCritical, "檢核資料"
      Exit Function
   End If
   ' 90.08.29 modify by louis (先檢查變更事項檔是否存在)
   If Text7(2) = 變更 And IsChangeEventExist(strReceiveNo) = False Then
      MsgBox "請先輸入變更事項的資料", vbOKOnly + vbCritical, "檢核資料"
      Exit Function
   End If
   'Add By Cheng 2002/03/08
   '檢查輸入資料的完整性
   If CheckDataIntegrity = False Then Exit Function
   'Add By Cheng 2002/05/22
   '重新檢查欄位有效性
   m_bolCheck = True
   If TxtValidate = False Then
      m_bolCheck = False
      Exit Function
   End If
   m_bolCheck = False
   
   'Add by Amy 2014/04/22 +P案(台灣或大陸)若關聯案發明人與畫面上發明人不同時詢問是否更新
   If DefInventor <> "" And DefInventor <> strInventor(2) Then
        If MsgBox("發明人與" & cm(5) & "-" & cm(6) & "(關聯案)不同,請確認是否要存檔??", vbYesNo + vbDefaultButton2) = vbNo Then
            Exit Function
        End If
   End If
   'end 2014/04/22
   
   'Add by Morgan 2004/3/30
   'FCP及P的國內案件,當專利種類為'發明'且案件性質為'分割'時,若無收文未取消收文之'實體審查'則顯示'此分割案尚未收文實體審查，期限為XXXXXX，請提醒智權人員 !!
   If pa(8) = "1" And Text7(2).Text = "307" And pa(9) = "000" Then
      '讀取母案申請日
      Erase m_stVar(): m_stCP09 = ""
      Dim strTmp1(0 To 4) As String, strTmp2(1 To 3) As String, i As Integer, stDivInfo(1 To 5) As String
      If GetDivInfo(stDivInfo(), pa()) = False Then
         Exit Function
      ElseIf stDivInfo(5) <> "000" Then
         MsgBox "發明分割案的母案申請國家必須為台灣！", vbCritical
         Exit Function
      Else
         strTmp1(0) = Label3(0).Caption
         For i = 1 To 4
            strTmp1(i) = stDivInfo(i)
         Next
         '讀取實體審查得法定期限
         If GetMoneyDate(4, stDivInfo(5), strTmp1, strTmp2(1), strTmp2(2), strTmp2(3)) = True Then
            If strTmp2(3) <> "" Then
               strTmp2(3) = CompDate(2, 1, strTmp2(3))
               '法定期限
               m_stVar(3) = PUB_Get416LawLimit(Text7(0), strTmp2(3))
               'Added by Morgan 2014/10/28
               If pa(9) = 台灣國家代號 And strSrvDate(1) >= 台灣案所限新規則啟用日 Then
                  m_stVar(0) = PUB_GetOurDeadline(m_stVar(3))
               Else
               'end 2014/10/28
                  '本所期限= 法定期限-4天
                  m_stVar(0) = PUB_GetWorkDay1(CompDate(2, -4, m_stVar(3)), True)
               End If 'Added by Morgan 2014/10/28
               
               '檢查有收'實體審查'否，有則抓收文號-->m_stCP09
               If PUB_Get416CP09(m_stCP09, ChangeWStringToTString(m_stVar(0)), pa()) = False Then
                  Exit Function
               End If
            Else
               MsgBox "無法讀取實體審查的法定期限！", vbCritical
               Exit Function
            End If
         Else
            MsgBox "無法讀取實體審查的法定期限！", vbCritical
            Exit Function
         End If
      End If
   End If
   
   'Add by Morgan 2005/11/8
   If Command2(1).Enabled = True Then
      If Pub_StrUserSt03 <> "M51" Then
         'Added by Lydia 2023/06/15 「414恢復權利-主張優先權106」請操作人員輸入欲恢復優先權的資料
         If bolChk414for106 = True And (strPriority(1) = "" Or m_bolRePriDate = False) Then
            MsgBox "請輸入欲恢復優先權的資料！", vbCritical
            Exit Function
         Else
         'end 2023/06/15
            'Modify by Morgan 2010/12/21 PCT進大陸不必 --99.12.2請作單
            'If strPriority(1) = "" Or m_bolRePriDate = False Then
            If pa(46) = "" And (strPriority(1) = "" Or m_bolRePriDate = False) Then
               If PUB_ChkCPExist(cp, "307") = False Then 'Added by Morgan 2017/9/25 分割案除外--品薇
                  MsgBox "本案有優先權資料,請重新輸入以便與原資料檢核！", vbCritical
                  Exit Function
               End If
            End If
         End If 'Added by Lydia 2023/06/15
      End If
   End If
   
   'Modify by Amy 2014/04/14 因應台日優先權證明文件管控
   If Text1 = "P" And (pa(9) = 台灣國家代號 Or pa(9) = 大陸國家代號) And (pa(8) = "1" Or pa(8) = "2") Then
      If ((Text7(2) = "106" Or Text7(2) = "124") And frm040104_1.strChoose = "1") Or Text7(2) = "237" Then
          If ChkFramePD09Null = True Then
              MsgBox "優先權存取碼不可為空,請至優先權資料內輸入！", vbCritical
              Command2(1).SetFocus
              Exit Function
          End If
      End If
'      If (Text7(2) = "106" Or Text7(2) = "124") And frm040104_1.strChoose = "2" And Trim(Text7(13)) = "" Then
'         MsgBox Label3(5) & "必須輸入是否有送證明文件！"
'         Text7(13).SetFocus
'         Exit Function
'      End If
   End If
   'end 2014/04/14
      
   'Moidify by Amy 2014/04/14 +if
   If frm040104_1.strChoose <> "1" Then
      'Add by Morgan 2007/12/31
      'Modified by Morgan 2012/7/2 +回復優先權主張124
      If (Text7(2) = "106" Or Text7(2) = "124") And pa(46) = "" Then
          If Text7(13) = "" Then
              'Add by Morgan 2009/8/11 分割案不必 --敏惠
              If PUB_ChkCPExist(cp, "307") = False Then
              'end 2009/8/11
                  MsgBox Label3(5) & "必須輸入是否有送證明文件！"
                  Text7(13).SetFocus
                  Exit Function
              End If
          End If
      End If
      'end 2007/12/31
   End If
      
   m_DualCase429Tw = False 'Added by Morgan 2012/9/18
   'Add by Morgan 2006/9/28
   m_DualCase429 = False
   bolMsg = True
   '2006/5/22 ADD BY SONIA 自請撤回413,放棄專利權429詢問是否要閉卷
   m_Close413429 = "N"
   'Modified by Morgan 2023/3/3 自請撤回413改核准才問/自動閉卷--郭
   'If Text7(2).Text = "413" Or Text7(2).Text = "429" Then
   If Text7(2).Text = "429" Then
   'end 2023/3/3
      'Modify by Morgan 2006/9/28 排除一案兩請
      'If MsgBox("發文案件性質為 自請撤回 或 放棄專利權,請問是否要閉卷 ？", vbCritical + vbYesNo + vbDefaultButton2) = vbYes Then
      '   m_Close413429 = "Y"
      'End If
      If pa(8) = "2" And Text7(2) = "429" Then
         strExc(0) = "SELECT CM05||CM06||CM07||CM08 C00 FROM CASEMAP WHERE CM10='3' AND CM01='" & pa(1) & "' AND CM02='" & pa(2) & "' AND CM03='" & pa(3) & "' AND CM04='" & pa(4) & "' UNION SELECT CM01||CM02||CM03||CM04 FROM CASEMAP WHERE CM10='3' AND CM05='" & pa(1) & "' AND CM06='" & pa(2) & "' AND CM07='" & pa(3) & "' AND CM08='" & pa(4) & "'"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            If pa(9) = "020" Then
               '若是一案兩請案則不再問是否閉卷
               bolMsg = False
               '申請日>=950701時自動上閉卷,否則發證才上
               'Modified by Morgan 2012/8/21 +2009/10/1以前申請案件
               'If Val(pa(10)) >= 950701 Then
               'Modified by Lydia 2016/09/29 改成模組
               'If Val(pa(10)) >= 950701 And Val(pa(10)) < 981001 Then
               '   If pa(57) = "" Then
               '      m_DualCase429Memo = ";與發明案(" & RsTemp.Fields(0) & ")為一案兩請,放棄專利權(429)發文系統自動上閉卷"
               '      m_DualCase429 = True
               '      MsgBox "與發明案(" & RsTemp.Fields(0) & ")為一案兩請，本案將自動上閉卷！", vbInformation
               '   End If
               'End If
               Call ChkDualCase429(RsTemp.Fields(0))
               
            'Added by Morgan 2012/9/18
            ElseIf pa(9) = "000" Then
               m_DualCase429Tw = True
            'end 2012/9/18
               bolMsg = False 'Added by Morgan 2013/5/31 台灣案也不要問，改發證才自動閉--玲玲請作單
            End If
         End If
      End If
      'Added by Lydia 2015/09/10 若自請撤回413的相關總收文號為新申請案時, 不必再詢問直接閉卷.
      'Removed by Morgan 2023/3/3 自請撤回413改核准才問/自動閉卷--郭
      'If Text7(2).Text = "413" Then
      '   strExc(0) = "select cp27 from caseprogress where cp09='" & cp(43) & "' and cp10 in (" & NewCasePtyList & ") "
      '   intI = 1
      '   Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      '   If intI = 1 Then
      '      bolMsg = False
      '      m_Close413429 = "Y"
      '   End If
      'End If
      'end 2023/3/3
      'end 2015/09/10
      
      If bolMsg = True Then
         'Modified by Morgan 2023/3/3 自請撤回413改核准才問/自動閉卷--郭
         'If MsgBox("發文案件性質為 自請撤回 或 放棄專利權,請問是否要閉卷 ？", vbCritical + vbYesNo + vbDefaultButton2) = vbYes Then
         If MsgBox("發文案件性質為放棄專利權,請問是否要閉卷 ？", vbCritical + vbYesNo + vbDefaultButton2) = vbYes Then
         'end 2023/3/3
            m_Close413429 = "Y"
         End If
      End If
      'End 2006/9/28
      
   End If
   '2006/5/22 END
  
   '2008/9/18 add by sonia
   'Modify by Amy 2013/08/06 +若cm5為空才顯示未輸入發明人資料是否輸入的訊息
   'If strInventor(2) = "" And InStr(NewCasePtyList, Text7(2)) > 0 Then
   If strInventor(2) = "" And InStr(NewCasePtyList, Text7(2)) > 0 And cm(5) = "" Then
      If MsgBox("未輸入發明人資料，請問是否要輸入？", vbCritical + vbYesNo + vbDefaultButton1) = vbYes Then
         Exit Function
      End If
   End If
   '2008/9/18 end
   
   'Add by Morgan 2010/1/8
   If pa(9) = "000" And strInventor(2) <> "" And InStr(NewCasePtyList, Text7(2)) > 0 Then
      strExc(0) = "select * from inventor where instr('" & strInventor(2) & "',in01||in02)>0 and in03 is null and in11='000'"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         'Modified by Morgan 2021/10/14 有客戶堅持不提供發明人，改提醒可繼續
         'MsgBox "發明人ID不齊全，系統將開啟客戶發明人資料維護畫面進行補輸！"
         If MsgBox("發明人ID不齊全，是否繼續發文？" & vbCrLf & vbCrLf & "選 [否] 系統將開啟客戶發明人資料維護畫面進行補輸！", vbExclamation + vbYesNo + vbDefaultButton2) = vbNo Then
            If PUB_CheckFormExist("frm050709") Then
               If frm050709.Data_Mission <> 0 And frm050709.Data_Mission <> 4 Then
                  MsgBox "客戶發明人資料維護畫面正在使用中，請自行操作！"
                  frm050709.ZOrder 0
                  Exit Function
               End If
            End If
            frm050709.UseDatamaintain vbKeyF4 '查詢
            frm050709.Text1(0) = "" & RsTemp("in01")
            frm050709.Text1(1) = "" & RsTemp("in02")
            frm050709.UseDatamaintain vbKeyF9 '確定
            frm050709.UseDatamaintain vbKeyF3  '修改
            Exit Function
         End If
      End If
   End If
   
   'Added by Morgan 2019/2/22
   m_bAutoBProc = False
   If Label3(0) < "C" And (Text7(2) = 準備程序 Or Text7(2) = 言詞辯論) Then
      If MsgBox("是否作內部收文管制開庭期限", vbQuestion + vbYesNo + vbDefaultButton1) = vbYes Then
         m_bAutoBProc = True
      End If
   End If
   'end 2019/2/22
   Screen.MousePointer = vbDefault
   
   m_st231CP09 = ""
   m_bolCtrl231 = False
   
   'Add by Morgan 2009/3/23 設定是否算發文室案件
   If pa(9) = "000" Then
      'Added by Morgan 2012/7/2 102新法
      If pa(1) = "P" And pa(9) = "000" And (Text7(2) = "101" Or Text7(2) = "108") Then
         strExc(0) = "select cp09,cp27 from caseprogress where cp01='" & pa(1) & "' and cp02='" & pa(2) & "' and cp03='" & pa(3) & "' and cp04='" & pa(4) & "' and cp10='231' and cp57 is null"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            m_st231CP09 = RsTemp(0)
            If IsNull(RsTemp("cp27")) Then
               m_bolCtrl231 = True
            End If
         ElseIf Text7(2) = "108" Then
            m_bolCtrl231 = True
         End If
      End If
      
      If pa(158) = "3" And Text7(2) = "101" And m_st231CP09 = "" And m_bolCtrl231 = False Then
         strExc(0) = MsgBox("本案為化學生醫案，是否產生B類寄存證明管制期限？", vbYesNoCancel + vbQuestion + vbDefaultButton3)
         If strExc(0) = vbCancel Then
            Exit Function
         ElseIf strExc(0) = vbYes Then
            m_bolCtrl231 = True
         End If
      End If
           
'Removed by Morgan 2012/7/4 不用
'      '回復優先權主張必須為未審定案件
'      If Text7(2) = "124" Then
'         If pa(16) <> "" Then
'            MsgBox "本案已審定，不可再發文" & Label3(5) & "!", vbExclamation
'            Exit Function
'         End If
'      End If

      'end 2012/7/2
      
      strNewCP64 = Text7(17).Text 'Added by Lydia 2019/12/05 保留進度備註
      
'Removed by Morgan 2021/1/28 分案已有檢查，此為過渡時期控制可取消，否則同案新收文未分案時先收文程序無法發文
'      'Add by Amy 2014/10/20 P台灣案發文控制
'      If P台灣案電子化啟用日 <= Val(strSrvDate(1)) Then
'        'Modified by Morgan 2016/6/29 不限制P--玲玲確認
'        'If pa(1) = "P" And cp(9) < "B" Then
'        If cp(9) < "B" Then
'        'end 2016/6/29
'            'A類一定要有接洽單才可發文
'            'Modify by Amy 2014/11/27 取消ChkOneDayHasCP27判斷,接洽單改檢查,因考慮可能同時發文其他案件性質情形
'            'If PUB_CheckPDF2(cp(9), 0, True, strExc(0)) = False And ChkOneDayHasCP27(pa(1), pa(2), pa(3), pa(4), cp(5) + 19110000) = False Then
'            If PUB_CheckPDF3(Text1, Text2, Text3, Text4) = False Then
'                Exit Function
'            End If
'        End If
'      End If
'      'end 2014/10/20
'end 2021/1/28

      'Add by Morgan 2011/7/29 電子送件
      If txtCP118 = "Y" Then
         m_CP123s = ""
         'Added by Morgan 2016/5/16 電子送件也要記錄主管機關
         If ModifyDispatchCp130(cp(9), m_CP09s, m_CP123s, m_CP130, Text7(0), , True) = False Then
            Exit Function
         End If
         'end 2016/5/16
         
         'add by sonia 2019/3/21 多個主管機關時比較第一個
         If m_CP130 <> "" And Text7(12) <> "" And Left(m_CP130, Len(Text7(12))) <> Text7(12) Then
            MsgBox "主管機關與發文選擇的不同，請確認！", vbInformation
            Exit Function
         End If
         'end 2019/3/21
         
         'Added by Morgan 2012/12/26
         strExc(0) = InputBox("請輸入智慧局收文文號!!")
         If strExc(0) = "" Then
            Exit Function
         Else
            'Modified by Lydia 2019/12/05
            'Text7(17) = "智慧局收文文號:" & strExc(0) & ";" & Text7(17)
            strFilePath = strExc(0)  '記錄智慧局收文文號
            strNewCP64 = "智慧局收文文號:" & strExc(0) & ";" & Text7(17) '保留進度備註
            'end 2019/12/05
         End If
         'end 2012/12/26
         
      Else
      'end 2011/7/29
      
         'Add by Morgan 2009/4/28
         If ModifyDispatchCp130(cp(9), m_CP09s, m_CP123s, m_CP130, Text7(0)) = False Then
            Exit Function
         End If
         If m_CP123s = "Y" Then
         'end 2009/4/28
            'modify by sonia 2014/6/23 加傳發文規費, P-108903
            If ModifyDispatch(cp(9), m_CP09s, m_CP123s, txtCP84, Text7(0)) = False Then
               Exit Function
            End If
         End If
         'Add by Amy 2014/10/20 P台灣案發文控制
        If P台灣案電子化啟用日 <= Val(strSrvDate(1)) Then
            'Modified by Morgan 2016/6/29 不限制P--玲玲確認
            'If pa(1) = "P" And cp(9) < "C" Then
            If cp(9) < "C" Then
            'end 2016/6/29
               'AB類申請書確認檢查,符合條件才可發文
               'Modified by Morgan 2015/3/17
               'If PUB_GetST03(cp(14)) = "P12" And Left(m_CP123s, 1) = "Y" And Text7(9) = "N" and PUB_CheckPDF2(cp(9), 1, True, strExc(0)) = False Then
               If PUB_GetST03(cp(14)) = "P12" And Left(m_CP123s, 1) = "Y" And Text7(9) = "N" Then
                  If PUB_CheckPDF2(cp(9), 1, True, strExc(0)) = False Then
               'end
                    MsgBox "無申請書PDF檔 ,不可發文!", vbInformation
                    Exit Function
                  End If 'Added by Morgan 2015/3/17
                End If
            End If
        End If
        'end 2014/10/20
         'Add by Morgan 2010/5/26
         'Modified by Morgan 2012/5/24 多個主管機關時比較第一個
         If m_CP130 <> "" And Text7(12) <> "" And Left(m_CP130, Len(Text7(12))) <> Text7(12) Then
            MsgBox "主管機關與發文選擇的不同，請確認！", vbInformation
            Exit Function
         End If
      End If 'Add by Morgan 2011/7/29
      
   'Added by Morgan 2016/6/29 非臺灣案電子化
   ElseIf 內專全面電子化啟用日 <= Val(strSrvDate(1)) And Left(Pub_StrUserSt03, 1) <> "F" Then
      'Modified by Morgan 2016/6/30 +排除FMP案
      If cp(9) < "B" And Left(cp(12), 1) <> "F" Then
      'end 2016/6/30
          If PUB_CheckPDF3(Text1, Text2, Text3, Text4) = False Then
              Exit Function
          End If
      End If
   'end 2016/6/29
   End If
   
   'Added by Lydia 2016/09/29 一案兩請大陸發明案發文陳述意見時,若新型案有內部收文放棄專利權,請系統直接出現訊息告知USER
   m_DualCase429B = False
   If pa(1) = "P" And pa(9) <> "000" And pa(8) = "1" And Text7(2) = "205" Then
      If PUB_IsDualApply(pa, m_DualCaseNo) Then
         strExc(0) = "select nvl(pa57||pa108,'N') pa57,cp09 from patent,caseprogress " & _
                     "where pa01='" & m_DualCaseNo(1) & "' and pa02='" & m_DualCaseNo(2) & "' and pa03='" & m_DualCaseNo(3) & "' and pa04='" & m_DualCaseNo(4) & "' " & _
                     "and pa01=cp01(+) and pa02=cp02(+) and pa03=cp03(+) and pa04=cp04(+) and cp10='429' and cp158=0 and cp159=0"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            'Modified by Lydia 2017/11/09 若智權同仁自行收文A類放棄專利權429,請一併上發文日
            'If RsTemp.Fields("pa57") = "N" And Mid("" & RsTemp.Fields("cp09"), 1, 1) = "B" Then
            If RsTemp.Fields("pa57") = "N" Then
               MsgBox m_DualCaseNo(1) & "-" & m_DualCaseNo(2) & IIf(m_DualCaseNo(3) & m_DualCaseNo(4) = "000", "", m_DualCaseNo(3) & "-" & m_DualCaseNo(4)) & "(新型案)放棄專利權將一併上發文日！", vbInformation
               m_DualCase429B = True
               Call ChkDualCase429(pa(1) & pa(2) & pa(3) & pa(4), False)
            End If
         End If
      End If
   End If
   'end 2016/09/29
   
   'Added by Morgan 2012/11/8
   m_bolAutoMail = False
   'Modified by Morgan 2013/10/23 考慮程序新人
   'If pa(9) = "020" And cp(10) = "416" And (cp(14) = "81002" Or cp(14) = "73017") Then
   'Modified by Morgan 2016/8/1 不必限制416,另申請優先權證明書(405)加問份數--玲玲
   'Modified by Morgan 2025/5/13 工作重分，品薇也算程序組人員
   'If pa(9) = "020" And PUB_GetST05(cp(14)) = "75" And Text7(25) = "" And Text7(26) <> "Y" Then
   If pa(9) = "020" And PUB_GetST03(cp(14)) = "P12" And Text7(25) = "" And Text7(26) <> "Y" Then
      If Text7(2).Text = "405" Then
         strCopies = ""
         Do While strCopies = ""
            CloseIme
            strCopies = InputBox("請輸入申請份數！", "申請優先權證明書指示信", "0")
            '取消
            If strCopies = "" Then
               Exit Function
            ElseIf Val(strCopies) > 0 Then
               strCopies = Val(strCopies)
            Else
               strCopies = ""
            End If
         Loop
      End If
   'end 2013/10/23
      
      'Added by Morgan 2017/3/6 436申請優先權DAS的指示信要判發--潘韻丞
      'Modified by Morgan 2025/5/19 +423申請專利權評價報告(改判斷是否自行判發)--郭
      'If cp(10) = "436" Then
      '   Text7(26) = "Y"
      strExc(2) = PUB_GetLetterJudgeNew("2", pa(1), cp(10), pa(9))
      If strExc(2) <> strUserNum Then
         Text7(26) = "Y"
      'end 2025/5/19
      'end 2017/3/6
      'Modified by Morgan 2016/5/20 指示信電子化,不直接寄送則開啟編輯畫面
      ElseIf MsgBox("是否直接發 E-Mail 給代理人??" & vbCrLf & vbCrLf & "(選否將開啟編輯畫面)", vbYesNo + vbQuestion + vbDefaultButton2) = vbYes Then
         m_bolAutoMail = True
      Else
         Text7(26) = "Y"
      End If
   End If
   'end 2012/11/8
         
   'Added by Morgan 2012/12/27
   '發明案分割發文要設定是否初審階段提分割
   If pa(1) = "P" And pa(9) = "000" And Text7(2) = "307" And pa(8) = "1" Then
      m_PA163 = PUB_GetDivCaseState(pa, DBDATE(Text7(0)))
      If m_PA163 = "" Then
         Exit Function
      End If
   End If
   'end 2012/12/27
         
   'ADD BY SONIA 2013/6/13 台灣一案兩請提醒檢查申請書
   If (Text7(2) = "101" Or Text7(2) = "102") And pa(9) = "000" Then
      strExc(0) = "select cp01||'-'||cp02 from caseprogress where (cp01,cp02,cp03,cp04) in (select cm05,cm06,cm07,cm08 from casemap where cm10='3' and cm01='" & pa(1) & "' and cm02='" & pa(2) & "' and cm03='" & pa(3) & "' and cm04='" & pa(4) & "'" & _
         " union select cm01,cm02,cm03,cm04 from casemap where cm10='3' and cm05='" & pa(1) & "' and cm06='" & pa(2) & "' and cm07='" & pa(3) & "' and cm08='" & pa(4) & "') and cp10 in ('101','102') and cp57 is null"
      intI = 1
      Set adoRecordset = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         'Modified by Morgan 2013/6/20 改使用者要確認--玲玲
         'MsgBox "本案與 " & adoRecordset(0) & " 案為一案兩請，請檢查申請書上是否已載明本案同時申請發明及新型！", vbExclamation
         If MsgBox("本案與 " & adoRecordset(0) & " 案為一案兩請，請檢查申請書上是否已載明本案同時申請發明及新型！" & vbCrLf & "是否要繼續？", vbYesNo + vbDefaultButton2 + vbQuestion) = vbNo Then
            Exit Function
         End If
      End If
   End If
   '2013/6/13 END
   
   'Add By Sindy 2014/4/15 台灣申請案
   If Text1 = "P" And pa(9) = "000" And InStr(NewCasePtyList, Text7(2)) > 0 Then
      '檢查此關聯案是否有大陸案,但未收文保密審查者
      'Modify By Sindy 2014/6/3 +and pa57 is null and nvl(pa108,0)=0 未閉卷未銷卷,且為該筆台灣案的關聯案,未收文保密審查者
      strExc(0) = "select pa01,pa02,pa03,pa04 from patent," & _
                  "(select cm05,cm06,cm07,cm08 from casemap where cm01='" & pa(1) & "' and cm02='" & pa(2) & "' and cm03='" & pa(3) & "' and cm04='" & pa(4) & "' and cm10='0'" & _
                  " union select cm01,cm02,cm03,cm04 from casemap where cm05='" & pa(1) & "' and cm06='" & pa(2) & "' and cm07='" & pa(3) & "' and cm08='" & pa(4) & "' and cm10='0') cm" & _
                  " where cm05=pa01(+) and cm06=pa02(+) and cm07=pa03(+) and cm08=pa04(+)" & _
                  " and pa09='020'" & _
                  " and not exists (select * from caseprogress where cp01=pa01 and cp02=pa02 and cp03=pa03 and cp04=pa04 and cp10='430')" & _
                  " and pa57 is null and nvl(pa108,0)=0" & _
                  " order by 1,2,3,4"
      intI = 1
      Set rsTmp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         rsTmp.MoveFirst
         strInvNo = ""
         Do While Not rsTmp.EOF
            strPA01 = rsTmp.Fields("pa01")
            strPA02 = rsTmp.Fields("pa02")
            strPA03 = rsTmp.Fields("pa03")
            strPA04 = rsTmp.Fields("pa04")
            '檢查發明人國籍是否為中國大陸
            'Modify By Sindy 2014/12/9
            If strSrvDate(1) >= 專利發明人檔啟用日 Then
               strExc(0) = "select pi06 from patentInventor,inventor where pi01='" & strPA01 & "' and pi02='" & strPA02 & "' and pi03='" & strPA03 & "' and pi04='" & strPA04 & "' and substr(pi06,1,8)=in01(+) and substr(pi06,9,2)=in02(+) and in11='020'"
            Else
            '2014/12/9 END
               'Memo by Lydia 2021/08/17 刪除舊程式碼：專利發明人在專利基本檔60~69
            End If
            intI = 1
            Set adoRecordset = ClsLawReadRstMsg(intI, strExc(0))
            If intI = 1 Then
               If adoRecordset.RecordCount > 0 Then
                  strInvNo = strInvNo & vbCrLf & strPA01 & strPA02 & "-" & strPA03 & "-" & strPA04
               End If
            End If
            rsTmp.MoveNext
         Loop
         If strInvNo <> "" Then
            MsgBox "請與智權同仁確認大陸案是否要保密審查！" & strInvNo, vbInformation
         End If
      End If
      rsTmp.Close
      Set rsTmp = Nothing
   End If
   '2014/4/15 END
   
   'Add By Sindy 2022/11/14
   If Text7(2) = "401" Then
      ReDim Preserve strAnoPA(1 To TF_PA) As String
      bolIsDualApply = PUB_IsDualApplyCom(pa, strAnoPA, strCaseNo, , , , Text7(2), bolIsExistsCP10, DBDATE(Text7(0)), bolAnoDated)
      If bolIsDualApply = True Then
         If bolIsExistsCP10 = False Then
            If MsgBox("本案為一案兩請案件，欲辦理變更申請人名稱須發明及新型兩案同時辦理！" & vbCrLf & _
                      "是否發E-Mail通知智權同仁？" & vbCrLf & vbCrLf & _
                      "按「是」發Mail通知，按「否」繼續操作。", vbYesNo + vbDefaultButton2) = vbYes Then
               '發Mail
               PUB_SendMail strUserNum, cp(13), "", _
                            pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4)) & "為一案兩請案件，欲辦理變更申請人名稱須發明及新型兩案同時辦理", _
                            "本所案號：" & pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4)) & vbCrLf & _
                            "案件名稱：" & Trim(Text7(14)) & Trim(Text7(15)) & Trim(Text7(16)) & vbCrLf & _
                            "申 請 人：" & Label3(9) & vbCrLf & _
                            "一案兩請另一案：" & strCaseNo & vbCrLf & vbCrLf & vbCrLf & _
                            "請再補收文！"
               Exit Function
            End If
         End If
      End If
   End If
   '2022/11/14 END
   
    'Added by Lydia 2019/12/05 檢查是否有電子送件的檔案
    bolUp = False 'Added by Lydia 2020/03/23
    If txtCP118.Text = "Y" And strFilePath <> "" And pa(9) = "000" Then
        strExc(1) = cp(82)
        If Val(cp(82)) > 0 Then
            If MsgBox("重新發文是否上傳檔案到卷宗區？", vbInformation + vbYesNo + vbDefaultButton1) = vbYes Then
                 strExc(1) = ""
            End If
        End If
        If Val(strExc(1)) = 0 Then
           'Modified by Lydia 2020/03/23 改成先判斷是否上傳檔案; ex.P-124220發明申請 因為上傳檔案在FormSave前,所以沒抓到出名代理,造成無POA檔仍設電子檔案齊備CP121=Y
           'If Pub_AutoEsetToCppByP(True, pa(1), pa(2), pa(3), pa(4), pa(8), Label3(0).Caption, Text7(2).Text, strFilePath, Text7(0).Text) = False Then
           If Pub_AutoEsetToCppByP(True, pa(1), pa(2), pa(3), pa(4), pa(8), "", Text7(2).Text, strFilePath, Text7(0).Text) = False Then
                 Exit Function
           End If
           bolUp = True 'Added by Lydia 2020/03/23
        End If
    End If
   If pa(9) = "000" Then 'Added by Morgan 2020/1/17
      Text7(17).Text = strNewCP64 '檢查完畢，更新備註欄位
   End If
   'end 2019/12/05
   
   Screen.MousePointer = vbHourglass
   
   If FormSave = False Then
      MsgBox "存檔失敗，請洽系統管理員 !", vbCritical
      Exit Function
   End If
   
   'Move by Lydia 2020/07/07 移到最下方
   
   Process = True
   
   'Add by Morgan 2008/2/20 檢查代理人Email(需考慮可能為FF案件)
   PUB_CheckEMail Combo2
   If pa(1) = "P" Then
      PUB_CheckEMail pa(75), pa(144)
      If pa(145) <> "" Then
         PUB_CheckEMail pa(75), pa(145)
      End If
   Else
      PUB_CheckEMail pa(26), pa(76)
      If pa(77) <> "" Then
         PUB_CheckEMail pa(77), pa(77)
      End If
   End If
   'end 2008/2/20
   
   'Added by Lydia 2022/05/23 PT案(傳入收文號)取得法律案源之發文規費，並且有輸入發文規費才做檢查
   If txtCP84.Enabled = True And pa(9) = "000" And m_LosCP84 <> "0" Then
      If Val(Trim(txtCP84.Text)) <> 0 And Val(m_LosCP84) <> Val(Trim(txtCP84.Text)) Then
          PUB_ChkOfficialFee cp(9), Me.txtCP84.Text, IIf(txtCP118 = "Y", "A", ""), m_LosMemo
      End If
   Else
   'end 2022/05/23
      '2012/7/19 add by sonia
      '台灣案發文規費與收文規費不符時,mail給智權人員
      'Modified by Morgan 2013/1/9 規費超收時也要通知(Ex.102新法發明再審規費改7000+超頁超項費(舊法固定為8000)
      'If txtCP84.Enabled = True And pa(9) = "000" And Val(Me.txtCP84.Text) <> Val(cp(17)) Then
      'Modified by Morgan 2023/8/24 + Or m_bChk939
      If pa(9) = "000" And (Val(Me.txtCP84.Text) < Val(cp(17)) Or (txtCP84.Enabled = True And Val(Me.txtCP84.Text) <> Val(cp(17))) Or m_bChk939) Then
         '2013/7/2 modify by sonia 改用共用module,並加電子送件自動扣款參數
         PUB_ChkOfficialFee cp(9), Me.txtCP84.Text, IIf(txtCP118 = "Y", "A", ""), , m_bChk939
      End If
      '2012/7/19 end
   End If 'Added by Lydia 2022/05/23
   
   'Add By Cheng 2003/09/12
   '發E-Mail給承辦人
   '2010/1/21 MODIFY BY SONIA
   'If m_strMailCP09 <> "" Then
   '   MailToPromoter m_strMailCP09
   'End If
   BatchMail
   '2010/1/21 END
   
   'Add by Morgan 2006/4/18 提早公開發文時，若有國外案未發文則發Mail通知工程師儘速處理送件
   If cp(10) = "417" Then
      strSql = "SELECT CM01,CM02,CM03,CM04,CP09,CP14" & _
         " FROM CASEMAP,PATENT,CASEPROGRESS" & _
         " WHERE " & ChgCaseMap(pa(1) & pa(2) & pa(3) & pa(4), 0, 1) & " AND CM10='0'" & _
         " AND PA01(+)=CM01 AND PA02(+)=CM02 AND PA03(+)=CM03 AND PA04(+)=CM04 AND PA57 IS NULL" & _
         " AND CP01(+)=PA01 AND CP02(+)=PA02 AND CP03(+)=PA03 AND CP04(+)=PA04 AND CP27 IS NULL AND CP31='Y' AND CP57 IS NULL"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strSql)  'edit by nickc 2007/02/05 不用 dll 了  objLawDll.ReadRstMsg(intI, strSQL)
      If intI = 1 Then
         With RsTemp
         Do While Not .EOF
            If IsNull(.Fields("CP14")) Then
               MsgBox "本案有國外案 " & .Fields("CM01") & "-" & .Fields("CM02") & .Fields("CM03") & .Fields("CM04") & " 未分案，無工程師可通知！", vbCritical
            Else
               PUB_SendMail strUserNum, .Fields("CP14"), .Fields("CP09"), "國內案 " & pa(1) & "-" & pa(2) & pa(3) & pa(4) & "【提早公開】已發文，國外案 " & .Fields("CM01") & "-" & .Fields("CM02") & .Fields("CM03") & .Fields("CM04") & " 請儘速處理送件！", " "
            End If
            .MoveNext
         Loop
         End With
      End If
   End If
   '2006/4/18 end
   
'Remove by Morgan 2011/6/22 不必再通知--郭(繪圖人員或程序會補)
'   'Add by Morgan 2007/10/22 若無代表圖則發Mail通知郭雅娟
'Modified by Morgan 2012/4/20 又改回要寄通知但對象為繪圖人員(無繪圖則工程師)--郭
   If m_NoPicMailSub <> "" Then
      'PUB_SendMail strUserNum, "79075", "", m_NoPicMailSub, " "
      If cp(29) <> "" Then
         strExc(1) = cp(29)
      Else
         strExc(1) = cp(14)
      End If
      PUB_SendMail strUserNum, strExc(1), "", m_NoPicMailSub, " "
   End If
'end 2011/6/22

   'Add by Morgan 2007/6/14
   If pa(9) = "000" Then
      PUB_ReAsignInform pa(1), pa(2), pa(3), pa(4), strReceiveNo
   End If
   
   'Added by Lydia 2020/03/23 bolUp是否可以上傳檔案,前面已判斷
   'Move by Lydia 2020/04/07 從中間移下來
   'Move by Lydia 2021/06/25 從最下面移到「尚有一案兩請" & strCaseNo & "尚未發文！」; 因為衍生設計案(ex.P-127439, P-127438) 會在列印通知函跳到A0:
   'Move by Lydia 2025/06/13 再次往上移，遇到列印通知函跳到A0:　(ex.P-135809-1)
   If bolUp = True Then
      If Pub_AutoEsetToCppByP(False, pa(1), pa(2), pa(3), pa(4), pa(8), Label3(0).Caption, Text7(2).Text, strFilePath, Text7(0).Text) = False Then
           'Exit Function 'Remove by Lydia 2021/06/25 還要列印通知函
      End If
   End If
   'end 2020/03/23
   
   '是否列印指示信
   If Text7(25) <> "N" Then
      strTmp = "30"
'Remove by Morgan 2006/7/10
'            'Add by Morgan 2006/6/21
'            '申請香港檢索報告已提申之回覆代理人
'            If pA(9) = "013" And Text7(2).Text = "902" Then
'               If GetCP10(cp(43)) = "421" Then
'                  strTmp = "40"
'               End If
'            End If
'            'end 2006/6/21
      
      '是否修改指示信內容
      If Text7(26) = "Y" Then
         bolChk = True
      Else
         bolChk = False
      End If
            
      'Added by Morgan 2012/11/8
      'Modified by Morgan 2016/5/19
      '指示信電子化
      'If m_bolAutoMail Then
      '   strMailTo = PUB_GetCFAgentEMail(strReceiveNo)
      '   NowPrint strReceiveNo, "02", strTmp, False, strUserNum, 0, , True, strContent, 1, , , , , True
      '   m_Subject = "請代為提出實體審查申請" & IIf(cp(45) <> "", " Y/R:" & cp(45) & ";", "") & " O/R:" & cp(1) & "-" & cp(2) & IIf(cp(3) & cp(4) = "000", "", "-" & cp(3) & "-" & cp(4))
      '   PUB_SendMail strUserNum, strMailTo, "", m_Subject, strContent, , , , , , , "patent"
      'Else
      '   'Add by Amy 2014/07/25 +優先權存取碼指示信
      '   StartLetter1 "02", strTmp
      '   NowPrint strReceiveNo, "02", strTmp, bolChk, strUserNum, 0
      '   '直接列印指示信
      '   If bolChk = False Then PUB_PrintLetter strReceiveNo
      'End If
      StartLetter1 "02", strTmp
      If m_bolAutoMail Then
         strPath = "": strFile = ""
         '指示信轉pdf檔
         If PUB_PrintDocAsPdf(strReceiveNo, "02", strTmp, strReceiveNo, strPath, strFile) Then
            'FMP案紙本還是要印
            'Removed by Morgan 2016/5/20 不印指示信,只印寄件備份就好--玲玲
            'If m_bolFMP Then
            '   PUB_PrintPDF strPath & "\" & strFile
            'End If
            'end 2016/5/20
            
            '上傳卷宗區
            If PUB_UploadOrderLetter(strPath & "\" & strFile, strReceiveNo) Then
               'EMail
               PUB_SendOrderLetterP strReceiveNo, m_Subject, True
            End If
         End If
      Else
         If Left(Pub_StrUserSt03, 1) = "F" Then
            NowPrint strReceiveNo, "02", strTmp, bolChk, strUserNum
         Else
            NowPrint strReceiveNo, "02", strTmp, bolChk, strUserNum, , , , , , , , , , , , , strReceiveNo
            If bolChk Then
               frm1105_1.m_RecNo = strReceiveNo
               frm1105_1.m_PdfName = PUB_CaseNo2FileName(cp(1), cp(2), cp(3), cp(4)) & "." & cp(10) & ".DATA.PDF"
               frm1105_1.m_Subject = m_Subject
               frm1105_1.Show
            End If
         End If
      End If
      'end 2016/5/19
         
   End If
   
   '是否列印申請書
   If Text7(9) <> "N" Then '申請書
      '是否修改申請書內容
      If Text7(10) = "Y" Then
         bolChk = True
      Else
         bolChk = False
      End If
      'Modify By Cheng 2002/06/19
      '若案件性質為"加註專用權延長"(608)
      If Me.Text7(2).Text = "608" Then
         strTmp = "00"
         '列印申請書
         'Modify by Amy 2014/08/26 +傳個信函進度收文號
         'NowPrint strReceiveNo, "01", strTmp, bolChk, strUserNum, 0
         NowPrint strReceiveNo, "01", strTmp, bolChk, strUserNum, 0, , , , , , , , , , , , strReceiveNo
      '若案件性質為"加註追加"(602)或"加註聯合"(603)
      ElseIf Me.Text7(2).Text = "602" Or Me.Text7(2).Text = "603" Then
         strTmp = "00"
         '列印申請書
         StartLetter "01", strTmp
         'Modify by Amy 2014/08/26 +傳個信函進度收文號
         'NowPrint strReceiveNo, "01", strTmp, bolChk, strUserNum, 0
         NowPrint strReceiveNo, "01", strTmp, bolChk, strUserNum, 0, , , , , , , , , , , , strReceiveNo
      End If
      'Add by Amy 2014/08/26 申請書修改改開1105_1 for P台灣案電子化
      If P台灣案電子化啟用日 <= Val(strSrvDate(1)) Then
         If bolChk = True Then
             frm1105_1.m_RecNo = strReceiveNo
             'Modify By Sindy 2022/5/11 流水號要足6碼
             frm1105_1.m_PdfName = Text1 & Text2 & IIf(Text3 & Text4 = "000", "", "-" & Text3 & "-" & Text4) & "." & cp(10) & ".DATA.PDF"
             frm1105_1.Show
         End If
      End If
      'end 2014/08/26
   End If
   
   '是否列印通知函
   If Text7(21) <> "N" Then '通知函
      If Me.txtEditInf.Text = "Y" Then
         bolChk = True
      Else
         bolChk = False
      End If
      'Modify by Morgan 2009/1/9 申請國非台灣的都預設台->大定稿,案件已有提及申請國,代理人便不再特別指名國家以便與PCT案共用.
      'strTmp = "00"
      If pa(9) = "000" Then
         strTmp = "00"
      Else
         strTmp = "01"
      End If
      
      Select Case Text7(2)
         Case 發明申請, 新型申請, 設計申請, 記錄請求_標準專利, 短期專利申請
            If pa(9) = "020" Then '大陸
               strTmp = "02"
            ElseIf pa(9) = "013" Then '香港
               strTmp = "03"
            '台灣若有申請案號時和申請案號輸入的通知函是一樣的
            ElseIf pa(9) = 台灣國家代號 And Text7(24) <> "" Then
               EndLetter "03", strReceiveNo, "01", strUserNum
               strExc(1) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
                  "VALUES ('03','" & strReceiveNo & "','01','" & strUserNum & "','有無實審',NULL)"
               strExc(2) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
                  "VALUES ('03','" & strReceiveNo & "','01','" & strUserNum & "','實審通知書',NULL)"
               'edit by nickc 2007/02/05 不用 dll 了
               'If Not objLawDll.ExecSQL(1, strExc) Then
               If Not ClsLawExecSQL(1, strExc) Then
                  MsgBox "儲存例外欄位失敗，請洽系統管理員 !", vbCritical
                  Exit Function
               End If
               'Modify by Amy 2014/08/26 +傳個信函進度收文號
               'NowPrint strReceiveNo, "03", "01", bolChk, strUserNum, 0
               NowPrint strReceiveNo, "03", "01", bolChk, strUserNum, 0, , , , , , , , , , , , strReceiveNo
               GoTo A0
            'Add By Cheng 2003/03/1/8
            '申請國家為台灣, 無申請案號, 用郵寄申請時
            ElseIf pa(9) = 台灣國家代號 And Me.Text7(24).Text = "" And Me.Text7(23).Text = "Y" Then
               strTmp = "06"
            End If
         '92.6.10 ADD BY SONIA
         'Modified by Morgan 2012/12/19 +衍生設計
         Case 追加申請, 聯合申請, 衍生設計
            If pa(9) = "000" Then '台灣
               'Modify by Amy 2014/08/26 +傳個信函進度收文號
               'NowPrint strReceiveNo, "03", "01", bolChk, strUserNum, 0
               If PUB_CheckCuNation(pa(26), Text1, Text2, Text3, Text4) = "1" Then
                  NowPrint strReceiveNo, "03", "65", bolChk, strUserNum, 0, , , , , , , , , , , , strReceiveNo
               Else
                  NowPrint strReceiveNo, "03", "01", bolChk, strUserNum, 0, , , , , , , , , , , , strReceiveNo
               End If
               GoTo A0
            End If
         '92.6.10 END
         Case PCT申請 'PCT
            strTmp = "02"
         'Add By Cheng 2002/12/29
         '再審申請
         Case "107"
            If pa(9) = 台灣國家代號 Then '台灣
               strTmp = "04"
               'Added by Morgan 2021/3/23
               If PUB_CheckCuNation(pa(26), Text1, Text2, Text3, Text4) = "1" Then  '大-->台
                  strTmp = "09"
               End If
               'end 2021/3/21
            ElseIf pa(9) = "020" Or pa(9) = "013" Then  '大陸 香港
               strTmp = "01"
            End If
         
         '申復 add by toni  20080904 for 大對台定稿
         Case "205"
            If pa(9) = 台灣國家代號 Then '台灣
               If PUB_CheckCuNation(pa(26), Text1, Text2, Text3, Text4) = "1" Then  '大-->台
                  strTmp = "09"
               End If
            End If
            
         '2008/12/12 ADD BY SONIA 實體審查 for 大對台定稿
         Case "416"
            If pa(9) = 台灣國家代號 Then '台灣
               If PUB_CheckCuNation(pa(26), Text1, Text2, Text3, Text4) = "1" Then  '大-->台
                  strTmp = "09"
               End If
            End If
            
         'add by sonia 2019/3/21 +243補書狀
         Case "243"
            If pa(9) = 台灣國家代號 Then '台灣
               strTmp = "00"
            End If
         'end 2019/3/21
         
         Case Else
            If pa(9) = 台灣國家代號 Then '台灣
               strTmp = "00"
               
               'Added by Morgan 2012/9/18 台灣新型一案兩請放棄專利權
               'Modified by Morgan 2014/12/4 改為 "00" (要與大陸不同 Ex. P-98683)
               'If m_DualCase429Tw Then strTmp = "01"
               
               '2010/5/18 add by sonia
               If PUB_CheckCuNation(pa(26), Text1, Text2, Text3, Text4) = "1" Then  '大-->台
                  strTmp = "09"
                  
                  'Added by Morgan 2012/9/18 台灣新型一案兩請放棄專利權(大-->台)
                  If m_DualCase429Tw Then strTmp = "02"
                  
               End If
               '2010/5/18 end
               
               'Added by Morgan 2021/10/18 寶齡富錦 Y55435 案件
               '變更
               If ChangeCustomerS(pa(75)) = "Y55435" And Text7(2) = "401" Then
                  strTmp = "98"
               End If
               'end 2021/10/18
                            
            ElseIf pa(9) = "020" Or pa(9) = "013" Then  '大陸 香港
               strTmp = "01"
               
               
            End If
      End Select
      StartLetter "02", strTmp
      'Modify by Amy 2014/08/26 +傳個信函進度收文號
      'Add by Morgan 2009/12/16
      If m_bolFMP Then
         'NowPrint strReceiveNo, "02", strTmp, bolChk, strUserNum, 0, , , , 1
         NowPrint strReceiveNo, "02", strTmp, bolChk, strUserNum, 0, , , , 1, , , , , , , , strReceiveNo
      Else
      'end 2009/12/16
         'NowPrint strReceiveNo, "02", strTmp, bolChk, strUserNum, 0
         NowPrint strReceiveNo, "02", strTmp, bolChk, strUserNum, 0, , , , , , , , , , , , strReceiveNo
      End If
      'end 2014/08/26
   End If

   'Add By Sindy 2022/11/14
   If bolIsDualApply = True And bolIsExistsCP10 = True And bolAnoDated = False Then
      MsgBox "尚有一案兩請" & strCaseNo & "尚未發文！", vbExclamation + vbOKOnly
   End If
   '2022/11/14 END
   
   'Added by Lydia 2023/06/15 寰華案:「414恢復權利-主張優先權106」更新實審期限
   If bolChk414for106 = True And Left(strFirstPriDate, 1) = "Y" Then
      '請彈跳提醒視窗：已更新實體審查期限為:
      strSql = "select '1' as ord1, cp06 from caseprogress WHERE CP01='" & pa(1) & "' AND CP02='" & pa(2) & "' AND CP03='" & pa(3) & "' AND CP04='" & pa(4) & "' and cp10='416' and cp158=0 " & _
               "union select '2' as ord1, np08 from nextprogress WHERE np02='" & pa(1) & "' AND np03='" & pa(2) & "' AND np04='" & pa(3) & "' AND np05='" & pa(4) & "' and np07='416' and np06 is null " & _
               "order by ord1"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strSql)
      If intI = 1 Then
         MsgBox "已更新實體審查期限為: " & ChangeWStringToTDateString("" & RsTemp.Fields("cp06")), vbExclamation + vbOKOnly
      End If
   End If
   'end 2023/06/15
   
   'Added by Lydia 2024/03/06 外專機械設計組人員異動調整程式：內專協辦工程師完成送件之後，需通知外專工程師進行請款
   'Move by Lydia 2024/03/12 改使用Outlook草稿，從FormSave移出
   'Mark by Lydia 2024/04/09 FMP案不用通知--- Phoebe
   'If m_bolFMP = True And cp(1) = "P" And Mid(Text7(1), 4, 1) = "9" Then
   '   Call Pub_SetEngMail(cp(9))
   'End If
   'end 2024/03/06
   'end 2024/04/09
   
A0:

End Function

Private Sub cmdOK_Click(Index As Integer)
   ' 設定滑鼠游標為等待狀態
   Screen.MousePointer = vbHourglass
   Select Case Index
      Case 0, 3 '確定 '同時發文
         'Modify by Morgan 2010/2/10 改呼叫函數方式以便鎖定按鍵
         cmdOK(Index).Enabled = False
         If Not Process(Index) Then
            cmdOK(Index).Enabled = True
         Else
            If Index = 3 Then '同時發文
               'Add By Sindy 2013/5/20
               If frm040104_1.bolIsEMPFlow = True Then
                  frm090202_4.QueryData
               End If
               '2013/5/20 End
               frm040104_1.Show
               frm040104_1.ReQuery
            Else
               '若有未發文資料顯示警告
               If PUB_GetCPunIssueDatas("" & Me.Text1.Text & "-" & Me.Text2.Text & "-" & IIf(Len("" & Me.Text3.Text) <= 0, "0", Me.Text3.Text) & "-" & IIf(Len("" & Me.Text4.Text) <= 0, "00", Me.Text4.Text)) Then
                  'Add By Sindy 2013/5/20
                  If frm040104_1.bolIsEMPFlow = True Then
                     frm090202_4.QueryData
                  End If
                  '2013/5/20 End
                  frm040104_1.Show
                  frm040104_1.Command1_Click
               Else
                  'Add By Sindy 2013/5/20
                  If frm040104_1.bolIsEMPFlow = True Then
                     Unload frm040104_1
                     frm090202_4.Show
                     frm090202_4.QueryData
                  Else
                  '2013/5/20 End
                     frm040104_1.Show
                     ' 90.07.11 modify by louis (回第一個畫面清除)
                     frm040104_1.Clear
                  End If
               End If
            End If
            Unload Me
         End If
         
      Case 1
         'Add by Amy 2014/04/22 +P案(台灣或大陸)若為關聯基礎案,若發明人與關聯案發明人不同時詢問是否更新
         If DefInventor <> "" And DefInventor <> OrgInventor Then
            If MsgBox("是否更新關聯案的發明人資料至本案??", vbYesNo + vbDefaultButton2) = vbYes Then
                '更新發明人資訊
                CopyInventor cm(5) & cm(6) & cm(7) & cm(8), cp(1) & cp(2) & cp(3) & cp(4)
            End If
         End If
         'end 2014/04/22
         'Add By Sindy 2013/5/20
         If frm040104_1.bolIsEMPFlow = True Then
            Unload frm040104_1
            frm090202_4.Show
            frm090202_4.QueryData
         Else
         '2013/5/20 End
            frm040104_1.strChoose = "" 'Add by Amy 2014/04/08
            frm040104_1.Show
         End If
         Unload Me
         
      Case 2
         'Add By Sindy 2013/5/20
         If frm040104_1.bolIsEMPFlow = True Then
            Unload frm040104_1
            frm090202_4.Show
            frm090202_4.QueryData
         Else
         '2013/5/20 End
            Unload frm040104_1
         End If
         Unload Me
         
      Case 4
         Me.Hide
         Set frm06010303_1.oParent = Me 'Add by Morgan 2011/10/5
         frm06010303_1.LoadMe strReceiveNo, pa(1), pa(2), pa(3), pa(4), 43
         frm06010303_1.Text41 = "N"
         frm06010303_1.Caption = "內專發文-變更事項"
         m_blnClkChgEvnBtn = True
        
      Case 5
         Where1103ComeFrom Me, pa(1), pa(2), pa(3), pa(4)
   End Select
   ' 設定滑鼠游標為預設
   Screen.MousePointer = vbDefault
End Sub

Private Function FormSave() As Boolean
   Dim strTxt(1 To 25) As String, intStep As Integer
   Dim i As Integer, strTmp As String, varTmp As Variant
   Dim nIndex As Integer
   'Add By Cheng 2002/06/27
   Dim StrSQLa As String
   Dim rsA As New ADODB.Recordset
   Dim StrSqlB As String
   Dim rsB As New ADODB.Recordset
   Dim strPromoteDate As String '承辦期限
   Dim ii As Integer
   Dim lngEff As Long
   Dim strAddSQL As String '更新申請人地址語法
   Dim bolLstInnerCase As Boolean '是否最後一個國內案
   Dim Ncp() As String 'Add by Morgan 2007/1/18 新增進度
   Dim strCN(1 To 4) As String 'Add by Morgan 2007/10/23 國內案號
   Dim stCustNo As String
   Dim strRecNo As String
   Dim arrPriority1, arrPriority2, arrPriority3
   Dim st307Msg As String '分割案提醒訊息
   Dim st936CP09 As String
   Dim stDate(3) As String 'Added by Morgan 2012/6/28
   Dim stCP118 As String, stCP152 As String 'Added by Morgan 2013/5/14
   Dim bSetEP17 As Boolean 'Added by Morgan 2013/11/20
   Dim strEP15 As String 'Add By Sindy 2016/7/7
   Dim strEP18 As String 'Add By Sindy 2016/7/7
   Dim strCU11 As String ' Add by Amy 2022/05/18
   Dim strTo As String 'Add by Amy 2024/05/15
   Dim bAutoB204 As Boolean 'Added by Morgan 2025/6/16 是否自動內部收文修正
   Dim stNP23 As String 'Added by Lydia 2025/10/29
      
   'Added by Morgan 2025/6/16
   bAutoB204 = False
   'Modified by Morgan 2025/6/23 寰華案除外--敏莉
   If m_bolFMP2 = False And (cp(10) = "205" Or cp(10) = "107") Then
      If PUB_ChkCPExist(cp(), "204", , , , , , cp(43)) = False Then
         strExc(1) = GetCaseTypeName("P", "204", IIf(pa(9) = "020", "1", "0"))
         If MsgBox("是否內部收文「修正」？", vbYesNo + vbQuestion + vbDefaultButton1) = vbYes Then
            bAutoB204 = True
         End If
      End If
   End If
   'end 2025/6/16
   
'Remove by Morgan 2009/6/1
'下一程序的流水號統一改用DB的Function抓(GETNP22)否則會重複
'Dim intMax As Long

'Add By Cheng 2002/11/06
On Error GoTo ErrorHandler

cnnConnection.BeginTrans
   
   'Added by Morgan 2013/6/7 自 lstNameAgent_Validate 移來,否則若觸發 Form_Activate 事件會跑 ReadPatent 導致 cp(110) 被清除
   cp(110) = ""
   If lstNameAgent.Visible = True Then
      For ii = 0 To lstNameAgent.ListCount - 1
         If lstNameAgent.Selected(ii) = True Then
            'modify by sonia 2016/10/7 員工編號已可非數字需做轉換
            'cp(110) = cp(110) & "," & lstNameAgent.ItemData(ii)
            'Modified by Morgan 2021/12/14f Forms2.0 改用模組
            'cp(110) = cp(110) & "," & PUB_Num2Id(lstNameAgent.ItemData(ii))
            cp(110) = cp(110) & "," & PUB_GetItemData(lstNameAgent.Tag, ii)
         End If
      Next
      If Left(cp(110), 1) = "," Then cp(110) = Mid(cp(110), 2)
   End If
   'end 2013/6/7

   'Modify by Morgan 2004/7/29
   '因下面程式會補客戶碼而觸發重讀減免身分故移到最先做
   'Add by Morgan 2004/7/22
   '設定客戶減免身分
   If pa(9) = "000" Then
      For ii = 1 To 5
         If txtAD(ii).Enabled = True Then
            stCustNo = ChangeCustomerL(Text7(3 + ii))
            '身分有變更才要做
            If txtAD(ii).Tag <> txtAD(ii).Text Then
               '不可減免
               If txtAD(ii).Text = "N" Then
                  strSql = PUB_GetADSQL(stCustNo, pa(9), "N")
               '自然人,學校
               ElseIf (txtAD(ii).Text = "1" Or txtAD(ii).Text = "2") Then
                  strSql = PUB_GetADSQL(stCustNo, pa(9), "Y", txtAD(ii).Text)
               '公司
               Else
                  '原來沒有減免資料或不可減免
                  If txtAD(ii).Tag = "" Or txtAD(ii).Tag = "N" Then
                     strSql = PUB_GetADSQL(stCustNo, pa(9), "Y", txtAD(ii).Text, pa(1), pa(2), pa(3), pa(4))
                  '修改減免身分別
                  Else
                     strSql = PUB_GetADSQL(stCustNo, pa(9), "Y", txtAD(ii).Text)
                  End If
               End If
               cnnConnection.Execute strSql, intI
            End If
         End If
      Next
   End If
   
   'Add by Morgan 2005/11/18
   '申請人1變更時要更新收據資料
   strAddSQL = ""
   'Mark by Amy 2018/10/30 改申請人show地址修改頁面,故此不使用
'   For ii = 0 To 4
'      Text7(4 + ii).Text = ChangeCustomerL(Text7(4 + ii).Text)
'      '專利才有申請人地址
'      If pa(1) = "P" Then
'         If Text7(4 + ii).Text <> ChangeCustomerL(pa(26 + ii)) Then
'            If Text7(4 + ii).Text <> "" Then
'               'edit by nickc 2007/02/02 不用 dll 了
'               'Call objPublicData.GetCustomerNameAndAddress(Text7(4 + ii).Text, strExc(0), strExc(1), strExc(2), strExc(3))
'               Call ClsPDGetCustomerNameAndAddress(Text7(4 + ii).Text, strExc(0), strExc(1), strExc(2), strExc(3))
'               strAddSQL = strAddSQL & ",PA" & Format(31 + ii) & "=" & CNULL(ChgSQL(Trim(strExc(1))))
'               strAddSQL = strAddSQL & ",PA" & Format(36 + ii) & "=" & CNULL(ChgSQL(Trim(strExc(2))))
'               strAddSQL = strAddSQL & ",PA" & Format(41 + ii) & "=" & CNULL(ChgSQL(Trim(strExc(3))))
'            Else
'               strAddSQL = strAddSQL & ",PA" & Format(31 + ii) & "=NULL"
'               strAddSQL = strAddSQL & ",PA" & Format(36 + ii) & "=NULL"
'               strAddSQL = strAddSQL & ",PA" & Format(41 + ii) & "=NULL"
'            End If
'         End If
'      End If
'   Next
   'end 2018/10/30
   If pa(1) = "P" Then
      strExc(0) = ChangeCustomerL(pa(26))
   Else
      strExc(0) = ChangeCustomerL(pa(8))
   End If
   'Modified by Morgan 2021/2/22
   'If Text7(4) <> strExc(0) Then
   If ChangeCustomerL(Text7(4)) <> strExc(0) Then
   'end 2021/2/22
      '有開收據,更新acc0k0
      If cp(60) <> "" Then
         strExc(1) = pa(1)
         strExc(2) = pa(2)
         strExc(3) = pa(3)
         strExc(4) = pa(4)
         strExc(5) = cp(60)
         strExc(6) = Text7(4)
         'edit by nickc 2007/02/05 不用 dll 了
         'If Not objLawDll.UpdAcc0k0(strExc(), True) Then
         If Not ClsLawUpdAcc0k0(strExc(), True) Then
            cnnConnection.RollbackTrans 'Add by Amy 2014/04/22
            Text7(4).SetFocus
            Exit Function
         End If
      End If
   End If
   
   '2005/11/18 end
   
   'intMax = GetNextProgressNo  'edit by nickc 2007/02/02 不用 dll 了  intMax = objPublicData.GetNextProgressNo
   
   If Combo2 <> "" Then
      'Modify by Morgan 2008/2/21
      'cp(44) = ChangeCustomerL(Combo2)
      intI = InStr(Combo2, "-")
      If intI > 0 Then
         cp(44) = Left(Combo2, intI - 1)
         cp(116) = Mid(Combo2, intI + 1)
      Else
         cp(44) = Combo2
         cp(116) = ""
      End If
      cp(44) = ChangeCustomerL(cp(44))
      'end 2008/2/21
   
      'edit by nickc 2007/02/02 不用 dll 了
      'If Not objPublicData.GetCaseThatCode(cp) Then cp(45) = ""
      If Not ClsPDGetCaseThatCode(cp) Then cp(45) = ""
   Else
      cp(44) = ""
      cp(116) = ""
      cp(45) = ""
   End If
   
   'add by sonia 2023/3/21 308改請衍生設計，先將原申請案號轉存CP30，將來以原申請案號才能查到案件P-130147-1
   If Text7(2) = "308" Then
      strSql = "Update caseprogress set cp30=(select pa11 from patent where cp01=pa01 and cp02=pa02 and cp03=pa03 and cp04=pa04)" & _
               " WHERE CP09='" & strReceiveNo & "'"
      cnnConnection.Execute strSql, intI
   End If
   'end 2023/3/21
   
   '1
   
   strExc(0) = ""
   
   If pa(9) = "000" Then
      Select Case Text7(2)
         'Modify by Morgan 2005/3/16 改請應沿用原申請日不必更新，案號也不更新--秀玲
         'Case "101", "102", "103", "104", "105", "301", "302", "303", "304", "305", "306", "307", "803"
         'Modified by Morgan 2012/12/19 +衍生設計125
         Case "101", "102", "103", "104", "105", "125", "803"
         '2005/3/16 end
            If pa(1) = "P" Then
               strExc(0) = "PA10=" & Val(TransDate(Text7(0), 2)) & ",PA11=" & CNULL(Text7(24)) & ","
            ElseIf pa(1) = "PS" Then
               strExc(0) = "SP10=" & Val(TransDate(Text7(0), 2)) & ",SP11=" & CNULL(Text7(24)) & ","
            End If
         'Add by Morgan 2010/6/23 改請聯合 305 要更新申請號
         'Modified by Morgan 2012/12/19 +改請衍生設計308
         Case "305", "308"
            If pa(1) = "P" Then
               strExc(0) = "PA11=" & CNULL(Text7(24)) & ","
            End If
            
         'Added by Morgan 2012/12/27
         '台灣發明分割要更新是否初審階段提分割欄位
         Case "307"
            If pa(1) = "P" And pa(8) = "1" Then
               strExc(0) = strExc(0) & "pa163='" & m_PA163 & "',"
            End If
            
         Case Else
            strExc(0) = ""
      End Select
   End If
   
   '2008/8/21 add by sonia 414回復原狀發文時專用期仍有效者才更新專利權是否存在pa17
   'Modify by Morgan 2010/8/10 百年蟲
   'If pa(1) = "P" And Text7(2) = "414" And pa(25) >= strSrvDate(2) Then
   If pa(1) = "P" And Text7(2) = "414" And Val(pa(25)) >= Val(strSrvDate(2)) Then
      strExc(0) = "PA17='Y',"
   End If
   '2008/8/21 end
   
   
   'Modify by Morgan 2010/5/3 若多變少或無時要清除不要的
   'If strInventor(2) <> "" Then
   '   varTmp = Split(strInventor(2), ",")
   '   For i = 0 To UBound(varTmp)
   '      strExc(0) = strExc(0) & "PA" & Format(i + 60) & "='" & varTmp(i) & "',"
   '   Next
   'End If
   If pa(1) = "P" Then
      varTmp = Split(strInventor(2), ",")
      'Modify By Sindy 2014/12/9
      If strSrvDate(1) >= 專利發明人檔啟用日 Then
         If strInventor(2) <> "" Then
            '全部刪除,重新新增
            strSql = "delete from patentInventor where pi01=" + CNULL(pa(1)) + " and pi02=" + CNULL(pa(2)) + " and pi03=" + CNULL(pa(3)) + " and pi04=" + CNULL(pa(4))
            Pub_SeekTbLog strSql 'Add By Sindy 2017/8/23
            cnnConnection.Execute strSql
            For i = 0 To UBound(varTmp)
               strSql = "INSERT into patentInventor(pi01,pi02,pi03,pi04,pi05,pi06) VALUES(" & _
                        CNULL(pa(1)) & "," & CNULL(pa(2)) & "," & CNULL(pa(3)) & "," & CNULL(pa(4)) & "," & i + 1 & ",'" & varTmp(i) & "')"
               Pub_SeekTbLog strSql 'Add By Sindy 2017/8/23
               cnnConnection.Execute strSql
            Next i
         Else
            '全部刪除,重新新增
            strSql = "delete from patentInventor where pi01=" + CNULL(pa(1)) + " and pi02=" + CNULL(pa(2)) + " and pi03=" + CNULL(pa(3)) + " and pi04=" + CNULL(pa(4))
            Pub_SeekTbLog strSql 'Add By Sindy 2017/8/23
            cnnConnection.Execute strSql
         End If
      Else
      '2014/12/9 END
         For i = 0 To 9
            If i <= UBound(varTmp) Then
               strExc(0) = strExc(0) & "PA" & Format(i + 60) & "='" & varTmp(i) & "',"
            Else
               strExc(0) = strExc(0) & "PA" & Format(i + 60) & "=null,"
            End If
         Next
      End If
      
      'Add by Morgan 2016/11/9 擇一申復發文要更新PA60='Y',因有可能沒有通知擇一或來函改案件性質 Ex.P-111903 --玲玲
      If pa(9) = "000" And Text7(2) = "239" Then
          strExc(0) = strExc(0) & "PA60='Y',"
      End If
      'end 2016/11/9
   End If
   'end 2010/5/3
   
   ' 90.07.18 modify by louis (存檔時存九碼)
   For nIndex = 4 To 8
      If IsEmptyText(Text7(nIndex)) = False Then
         Text7(nIndex) = Text7(nIndex) & String(9 - Len(Text7(nIndex)), "0")
      End If
   Next nIndex
   
   Select Case pa(1)
      Case "P"
         'Modify by Morgan 2005/11/18 加更新申請人地址語法  & strAddSQL
         'Modified by Morgan 2012/9/14 +PA161
         'Modify By Sindy 2014/7/14 +IIf(Combo1.Enabled = True And Combo1 <> "", ",PA158='" & Left(Combo1, 1) & "'", "")
         'Modified by Morgan 2020/3/11 PA161改放T(控制已取消，目前已不會更新)
         strTxt(1) = "UPDATE PATENT SET " & strExc(0) & "PA05=" & CNULL(ChgSQL(Text7(14))) & ",PA06=" & CNULL(ChgSQL(Text7(15))) & _
            ",PA07=" & CNULL(ChgSQL(Text7(16))) & ",PA26=" & CNULL(Text7(4)) & ",PA27=" & CNULL(Text7(5)) & _
            ",PA28=" & CNULL(Text7(6)) & ",PA29=" & CNULL(Text7(7)) & ",PA30=" & CNULL(Text7(8)) & _
            ",PA91=" & CNULL(ChgSQL(Text7(18))) & strAddSQL & IIf(m_bolUpdatePA161, ",PA161='T'", "") & _
            IIf(Combo1.Enabled = True And Combo1 <> "", ",PA158='" & Left(Combo1, 1) & "'", "") & _
            " WHERE " & ChgPatent(pa(1) & pa(2) & pa(3) & pa(4))
        cnnConnection.Execute strTxt(1)
        
        '若國內案案件名稱更改, 其相關的大陸案案件名稱必須一致
        '92.11.20 MODIFY BY SONIA
        'If pa(9) = 台灣國家代號 Then
        'Modify by Morgan 2011/3/22 大陸若是基礎案也要
        'If pa(9) = 台灣國家代號 And (Text7(2) = 發明申請 Or Text7(2) = 新型申請 Or Text7(2) = 設計申請 Or Text7(2) = 追加申請 Or Text7(2) = 聯合申請 Or Text7(2) = 翻譯 Or Text7(2) = 檢索報告) Then
        'Modified by Morgan 2012/12/19 +衍生設計
        If (pa(9) = 台灣國家代號 Or pa(9) = 大陸國家代號) And (Text7(2) = 發明申請 Or Text7(2) = 新型申請 Or Text7(2) = 設計申請 Or Text7(2) = 追加申請 Or Text7(2) = 聯合申請 Or Text7(2) = 衍生設計 Or Text7(2) = 翻譯 Or Text7(2) = 檢索報告) Then
        '92.11.20 END
        
'Modified by Morgan 2020/2/12 改共用並判斷新申請案程序未發文就要更新(因大陸案會有代理人撰稿先發文 Ex:P-123495)
'            StrSQLa = "Select CM01,CM02,CM03,CM04 From CaseMap Where CM05='" & PA(1) & "' AND CM06='" & PA(2) & "' AND CM07='" & PA(3) & "' AND CM08='" & PA(4) & "' AND CM10='0' "
'            intI = 1
'            Set rsA = ClsLawReadRstMsg(intI, StrSQLa)
'            If intI = 1 Then
'            While Not rsA.EOF
'               '判斷所有進度資料是否無發文日
'               StrSqlB = "Select 1 From Caseprogress Where " & ChgCaseprogress(rsA.Fields(0).Value & rsA.Fields(1).Value & rsA.Fields(2).Value & rsA.Fields(3).Value) & " And CP27>0"
'               intI = 1
'               Set rsB = ClsLawReadRstMsg(intI, StrSqlB)
'               '若所有進度資料皆無發文日
'               If intI = 0 Then
'                  strTxt(1) = "UPDATE PATENT SET PA05=" & CNULL(ChgSQL(Text7(14))) & ",PA06=" & CNULL(ChgSQL(Text7(15))) & _
'                     ",PA07=" & CNULL(ChgSQL(Text7(16))) & " " & _
'                     "  WHERE " & ChgPatent(rsA.Fields(0).Value & rsA.Fields(1).Value & rsA.Fields(2).Value & rsA.Fields(3).Value)
'                  cnnConnection.Execute strTxt(1)
'
'                  'Add by Morgan 2011/3/25 更新國外案發明人
'                  CopyInventor PA(1) & PA(2) & PA(3) & PA(4), rsA(0) & rsA(1) & rsA(2) & rsA(3)
'
'                End If
'                rsA.MoveNext
'            Wend
'            End If
'            If rsB.State <> adStateClosed Then rsB.Close
'            Set rsB = Nothing
'            If rsA.State <> adStateClosed Then rsA.Close
'            Set rsA = Nothing
            PUB_UpdateRefCaseInventorAndCaseName pa(1), pa(2), pa(3), pa(4)
'end 2020/2/12
        End If
        
        'Add by Amy 2013/08/06 +P的非台灣案發文時帶已鍵關聯之最新發明人資訊
        If cm(5) <> "" Then
            '更新發明人資訊
            'Modify by Amy 2014/04/22 改只save Patent
            'CopyInventor cm(5) & cm(6) & cm(7) & cm(8), cp(1) & cp(2) & cp(3) & cp(4)
            UpdPatentInventor cp(1) & cp(2) & cp(3) & cp(4), strInventor(2)
        End If
        'end 2013/08/06
        
      Case "PS"
         For i = 5 To 7
            Text7(i + 9) = pa(i)
         Next
         strTxt(1) = "UPDATE SERVICEPRACTICE SET " & strExc(0) & "SP05=" & CNULL(ChgSQL(Text7(14))) & ",SP06=" & CNULL(ChgSQL(Text7(15))) & _
            ",SP07=" & CNULL(ChgSQL(Text7(16))) & ",SP18=" & CNULL(ChgSQL(Text7(18))) & ",SP08=" & CNULL(Text7(4)) & _
            ",SP58=" & CNULL(Text7(5)) & ",SP59=" & CNULL(Text7(6)) & " WHERE " & ChgService(pa(1) & pa(2) & pa(3) & pa(4))
        cnnConnection.Execute strTxt(1)

   End Select
   
   '2006/5/22 ADD BY SONIA 自請撤回413,放棄專利權429依詢問使用者的是否要閉卷更新基本檔,閉卷日期為系統日,並新增B類收文閉卷資料
   If m_Close413429 = "Y" Then
      If pa(1) = "P" Then
         strTxt(1) = "UPDATE PATENT          SET PA57='Y',PA58=" & strSrvDate(1) & ",PA59='09' WHERE PA01='" & cp(1) & "' AND PA02='" & cp(2) & "' AND PA03='" & cp(3) & "' AND PA04='" & cp(4) & "'"
      ElseIf pa(1) = "PS" Then
         strTxt(1) = "UPDATE SERVICEPRACTICE SET SP15='Y',SP16=" & strSrvDate(1) & ",SP17='09' WHERE SP01='" & cp(1) & "' AND SP02='" & cp(2) & "' AND SP03='" & cp(3) & "' AND SP04='" & cp(4) & "'"
      End If
      cnnConnection.Execute strTxt(1)
      strExc(0) = AutoNo("B", 6) 'B類總收文號
      strTxt(1) = "insert into caseprogress (cp01,cp02,cp03,cp04,cp05,cp09,cp10,cp12,cp13,cp14,cp20,cp26,cp27,cp32,cp43,CP44,cp45,cp46,cp57,cp58,cp116) values " & _
         " ('" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "'," & strSrvDate(1) & _
         ",'" & strExc(0) & "','913','" & stCP12 & "','" & stCP13 & "','" & strUserNum & "','N','N'," & strSrvDate(1) & _
         ",'N','" & cp(9) & "','" & cp(44) & "','" & cp(45) & "','" & cp(46) & "'," & strSrvDate(1) & ",'09','" & cp(116) & "')"
      cnnConnection.Execute strTxt(1)
   End If
   '2006/5/22 END
   
   'Added by Morgan 2013/5/14
   stCP118 = txtCP118
   stCP152 = ""
   If txtCP118 = "Y" And Val(txtCP84) > 0 And pa(9) = "000" Then
      If txtPayToday <> "" Then
         stCP118 = "A"
         If txtPayToday = "Y" Then
            stCP152 = CompWorkDay(2, DBDATE(Text7(0)))
         Else
            stCP152 = CompWorkDay(3, DBDATE(Text7(0)))
         End If
      End If
   End If
   'end 2013/5/14

   
   ' 91.03.25 modify by louis (單引號)
   'Modify by morgan 2004/6/23 加 cp81
   'Modify by morgan 2004/8/11 加 cp84
   'Modify by Morgan 2005/7/13 加 cp110
   'Modify by Morgan 2008/11/10 +CP120
   'Modify by Morgan 2010/1/5 +CP135,CP136,CP137,CP138,m_FeeMemo
   'Modify by Morgan 2011/7/29 +CP118
   'Modify by Morgan 2013/5/14 +CP152
   'Modified by Lydia 2021/05/25 +CP113工作時數
   'Modified by Lydia 2025/02/12 +CP71
   strTxt(2) = "UPDATE CASEPROGRESS SET cp27=" & CNULL(TransDate(Text7(0), 2)) & _
      ",cp14=" & CNULL(Text7(1)) & ",cp44=" & CNULL(cp(44)) & ",CP45=" & CNULL(cp(45)) & _
      ",cp64=" & CNULL(ChgSQL(m_FeeMemo & Text7(17))) & ",cp23=" & CNULL(Text7(19)) & ",cp22=" & CNULL(Text7(20)) & _
      ",cp15=" & CNULL(Text7(22)) & _
      ",cp36=" & CNULL(ChgSQL(Text5(4))) & ",cp37=" & CNULL(ChgSQL(Text5(5))) & _
      ",cp38=" & CNULL(ChgSQL(Text5(6))) & ",cp39=" & CNULL(ChgSQL(Text5(7))) & _
      ",cp40=" & CNULL(ChgSQL(Text5(8))) & ",cp41=" & CNULL(ChgSQL(Text5(9))) & _
      ",cp42=" & CNULL(ChgSQL(Text5(10))) & ",cp81=" & CNULL(cp(81)) & ",cp84=" & Format(Val(txtCP84.Text)) & _
      ",cp110=" & CNULL(cp(110)) & ",cp116=" & CNULL(cp(116)) & " ,cp113=" & CNULL(txtCP113, True) & _
      ",CP118='" & stCP118 & "'" & _
      ",cp120=" & CNULL(Text7(27)) & ",cp135=" & CNULL(txtCP135, True) & ",cp136=" & CNULL(txtCP136, True) & _
      ",cp137=" & CNULL(txtCP137, True) & ", cp138=" & CNULL(txtCP138, True) & ",CP152=" & CNULL(stCP152, True) & _
      ",cp71=" & CNULL(IIf(pa(9) = "000", DBDATE(txtCP71), txtCP71)) & _
      " WHERE CP09='" & strReceiveNo & "'"
      
   'Add By Cheng 2002/11/06
   cnnConnection.Execute strTxt(2)
   
   'Added by Lydia 2025/02/24 TIPS分配比例管制：與ACS案有關之智財協作發文時一併產生TIPS案請款階段分配比例
   If pa(1) = "PS" Then
      Call PUB_InsertACS_TIPS_Rate(pa(1), pa(2), pa(3), pa(4), strReceiveNo, cp(10))
   End If
   'end 2025/02/24
   
   'Add by Morgan 2011/6/29
   '有已收文超頁超項費更新發文日及發文規費
   'Modified by Morgan 2012/3/20 有超頁超項費才要自動發文(不考慮本程序有超收也不考慮有超頁費或超項費收文一次以上的情形)
   'If m_lngRecOverPageFee > 0 Or m_lngRecOverItemFee > 0 Then
   '   strSql = "Update caseprogress set cp27=" & DBDATE(Text7(0)) & ",cp84=0" & _
   '         " where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10 in ('938','939') and cp27||cp57 is null"
   '   cnnConnection.Execute strSql, intI
   'End If
   'Modified by Morgan 2012/8/31 是否出名CP22,出名人CP110,是否電子送件CP118也要更新
   If m_lngOverPageFee + m_lngOverItemFee > 0 And m_lngRecOverPageFee + m_lngRecOverItemFee > 0 Then
      '已收超頁費且 應收超頁費>0 或 應收超項費>已收超項費
      If m_lngRecOverPageFee > 0 And (m_lngOverPageFee > 0 Or m_lngOverItemFee > m_lngRecOverItemFee) Then
         strSql = "Update caseprogress set cp27=" & DBDATE(Text7(0)) & ",cp84=0,cp22=" & CNULL(Text7(20)) & ",cp110=" & CNULL(cp(110)) & ",CP118='" & stCP118 & "'" & _
            " where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10='938' and cp27||cp57 is null"
         cnnConnection.Execute strSql, intI
      End If
      '已收超項費且 應收超項費>0 或 應收超頁費>已收超頁費
      If m_lngRecOverItemFee > 0 And (m_lngOverItemFee > 0 Or m_lngOverPageFee > m_lngRecOverPageFee) Then
         'Modified by Morgan 2013/5/14 +CP152
         strSql = "Update caseprogress set cp27=" & DBDATE(Text7(0)) & ",cp84=0" & ",cp22=" & CNULL(Text7(20)) & ",cp110=" & CNULL(cp(110)) & ",CP118='" & stCP118 & "',CP152=" & CNULL(stCP152, True) & _
            " where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10='939' and cp27||cp57 is null"
         cnnConnection.Execute strSql, intI
      End If
   End If
   'end 2012/3/20
      
   'Add by Morgan 2010/1/5 補收文超頁超項費
   If m_lngOverPageFeeDiff + m_lngOverItemFeeDiff > 0 Then
      'Modify by Morgan 2010/2/2 改掛原承辦人(原來掛程序)
      If m_lngOverPageFeeDiff > 0 Then
         strExc(1) = AutoNo("B", 6) 'B類總收文號
         'Modified by Morgan 2013/5/14 +CP152
         strSql = "insert into caseprogress (cp01,cp02,cp03,cp04,cp05,cp09,cp10,cp12,cp13,cp14,cp16,cp17,cp18,cp26,cp27,cp43,cp84,cp22,cp110,cp118,cp152) values " & _
            " ('" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "'," & DBDATE(Text7(0)) & _
            ",'" & strExc(1) & "','938','" & stCP12 & "','" & stCP13 & "'," & CNULL(Text7(1)) & "," & m_lngOverPageFeeDiff & "," & m_lngOverPageFeeDiff & ",0,'N'" & _
            "," & strSrvDate(1) & ",'" & cp(9) & "',0," & CNULL(Text7(20)) & "," & CNULL(cp(110)) & ",'" & stCP118 & "'," & CNULL(stCP152, True) & ")"
         cnnConnection.Execute strSql, intI
         'add by sonia 2014/5/1 文雄要求同時上完稿日及會稿完成日,雅娟也同意
         strSql = "UPDATE ENGINEERPROGRESS SET EP06=" & strSrvDate(1) & ",EP09=" & strSrvDate(1) & ",EP08=" & strSrvDate(1) & " WHERE EP02='" & strExc(1) & "'"
         cnnConnection.Execute strSql, intI
         '2014/5/1 end
      End If
      If m_lngOverItemFeeDiff > 0 Then
         strExc(1) = AutoNo("B", 6) 'B類總收文號
         'Modified by Morgan 2013/5/14 +CP152
         strSql = "insert into caseprogress (cp01,cp02,cp03,cp04,cp05,cp09,cp10,cp12,cp13,cp14,cp16,cp17,cp18,cp26,cp27,cp43,cp84,cp22,cp110,cp118,cp152) values " & _
            " ('" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "'," & DBDATE(Text7(0)) & _
            ",'" & strExc(1) & "','939','" & stCP12 & "','" & stCP13 & "'," & CNULL(Text7(1)) & "," & m_lngOverItemFeeDiff & "," & m_lngOverItemFeeDiff & ",0,'N'" & _
            "," & strSrvDate(1) & ",'" & cp(9) & "',0," & CNULL(Text7(20)) & "," & CNULL(cp(110)) & ",'" & stCP118 & "'," & CNULL(stCP152, True) & ")"
         cnnConnection.Execute strSql, intI
         'add by sonia 2014/5/1 文雄要求同時上完稿日及會稿完成日,雅娟也同意
         strSql = "UPDATE ENGINEERPROGRESS SET EP06=" & strSrvDate(1) & ",EP09=" & strSrvDate(1) & ",EP08=" & strSrvDate(1) & " WHERE EP02='" & strExc(1) & "'"
         cnnConnection.Execute strSql, intI
         '2014/5/1 end
      End If
   End If
    
   intStep = 3
   
   '911028 nick 重新抓
   
   'intMax = GetNextProgressNo  'edit by nickc 2007/02/02 不用 dll 了  intMax = objPublicData.GetNextProgressNo
   
   '2
   '2005/8/29 MODIFY BY SONIA
   'If Text7(11) <> "" Then
   '     '若本所期限非工作天則抓最近工作天
   '   strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05," & _
   '      "NP07,NP08,NP09,NP10,NP22) VALUES ('" & strReceiveNo & "','" & pa(1) & _
   '      "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 催審 & "," & _
   '      PUB_GetWorkDay1(TransDate(Text7(11), 2), True) & "," & TransDate(Text7(11), 2) & _
   '      ",'" & strUserNum & "'," & intMax & ")"
   '     'Add By Cheng 2002/11/06
   '     cnnConnection.Execute strTxt(intStep)
'  '    intMax = intMax + 1
   '     intMax = objPublicData.GetNextProgressNo
   '   intStep = intStep + 1
   'End If
   If Text7(11) <> "" Then
'Modify by Morgan 2009/8/18 改呼叫共用函式
'      '台灣修正或申復之催審更新相關來函總收文號之相關總收文號之程序之催審期限, 若無才新增催審期限
'      If pa(9) = 台灣國家代號 And (Text7(2) = 修正 Or Text7(2) = 申復) And cp(43) <> "" Then
'         strTxt(intStep) = "UPDATE NEXTPROGRESS SET NP08=" & PUB_GetWorkDay1(TransDate(Text7(11), 2), True) & ",NP09=" & TransDate(Text7(11), 2) & _
'            " WHERE NP07=411 AND NP06 IS NULL AND NP01 IN (SELECT CP43 FROM CASEPROGRESS WHERE CP09 IN (SELECT CP43 FROM CASEPROGRESS WHERE CP09='" & strReceiveNo & "'))"
'         cnnConnection.Execute strTxt(intStep), lngEff
'         If lngEff = 0 Then
'            strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05," & _
'               "NP07,NP08,NP09,NP10,NP22) VALUES ('" & strReceiveNo & "','" & pa(1) & _
'               "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 催審 & "," & _
'               PUB_GetWorkDay1(TransDate(Text7(11), 2), True) & "," & TransDate(Text7(11), 2) & _
'               ",'" & strUserNum & "',GETNP22)"
'            cnnConnection.Execute strTxt(intStep)
'         End If
'      Else
'         '若本所期限非工作天則抓最近工作天
'         strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05," & _
'            "NP07,NP08,NP09,NP10,NP22) VALUES ('" & strReceiveNo & "','" & pa(1) & _
'            "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 催審 & "," & _
'            PUB_GetWorkDay1(TransDate(Text7(11), 2), True) & "," & TransDate(Text7(11), 2) & _
'            ",'" & strUserNum & "',GETNP22)"
'         cnnConnection.Execute strTxt(intStep)
'      End If
'      'intMax = GetNextProgressNo  'edit by nickc 2007/02/02 不用 dll 了  intMax = objPublicData.GetNextProgressNo
'      intStep = intStep + 1
      'Modified by Lydia 2016/10/13 + PA09
      PUB_UpdateChkResultDate Text7(11), cp, cp(9), Text7(2), cp(43), pa(9)
   End If
   '2005/8/29 END
   '3
   '92.7.29 modify by sonia 新型也不做通知實審日
   '2005/11/22 MODIFY BY SONIA 實體審查發文時以發明申請案之收文號掛通知實審日期限
   'If pa(9) = 台灣國家代號 And ((Text7(2) <> "101" And Text7(2) <> "102" And Text7(2) <> "106" And Left(Text7(2), 1) = "1") Or Text7(2) = "416" Or Left(Text7(2), 1) = "8") Then
   'Modified by Morgan 2012/6/29 很多 1 字頭的不要掛所以改列出要的
   'If pa(9) = 台灣國家代號 And ((Text7(2) <> "101" And Text7(2) <> "102" And Text7(2) <> "106" And Left(Text7(2), 1) = "1") Or Left(Text7(2), 1) = "8") Then
   'Modified by Morgan 2012/12/19 +衍生設計
   'Modified by Morgan 2024/1/9 調整案件性質--陳玲玲
   'If pa(9) = 台灣國家代號 And (Text7(2) = "103" Or Text7(2) = "105" Or Text7(2) = "125" Or Text7(2) = "107" Or Text7(2) = "117" Or Left(Text7(2), 1) = "8") Then
   If pa(9) = 台灣國家代號 And cp(9) < "C" And (InStr("103,107,117,125,303,306,308,309,803,804", Text7(2)) > 0 Or (Text7(2) = "307" And pa(8) = "3")) Then
   '2005/11/22 END
        '若本所期限非工作天則抓最近工作天
      strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05," & _
         "NP07,NP08,NP09,NP10,NP22) VALUES ('" & strReceiveNo & "','" & pa(1) & _
         "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 通知實審日 & "," & _
         PUB_GetWorkDay1(CompDate(0, 1, TransDate(Text7(0), 2)), True) & "," & CompDate(0, 1, TransDate(Text7(0), 2)) & _
         ",'" & strUserNum & "',GETNP22)"
      cnnConnection.Execute strTxt(intStep)
      'intMax = GetNextProgressNo  'edit by nickc 2007/02/02 不用 dll 了  intMax = objPublicData.GetNextProgressNo
      intStep = intStep + 1
   End If
   '2005/11/22 ADD BY SONIA 實體審查發文時以發明申請案之收文號掛通知實審日期限,若無發明申請案才掛實體審查
   If pa(9) = 台灣國家代號 And Text7(2) = "416" Then
      If rsA.State <> adStateClosed Then rsA.Close
      Set rsA = Nothing
      StrSQLa = "Select CP09 From CASEPROGRESS Where CP01='" & pa(1) & "' AND CP02='" & pa(2) & "' AND CP03='" & pa(3) & "' AND CP04='" & pa(4) & "' AND CP10 IN ('101','301','307') "
      rsA.CursorLocation = adUseClient
      rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
      If rsA.RecordCount > 0 Then
         If "" & rsA.Fields(0).Value = "" Then
            strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05," & _
               "NP07,NP08,NP09,NP10,NP22) VALUES ('" & strReceiveNo & "','" & pa(1) & _
               "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 通知實審日 & "," & _
               PUB_GetWorkDay1(CompDate(0, 1, TransDate(Text7(0), 2)), True) & "," & CompDate(0, 1, TransDate(Text7(0), 2)) & _
               ",'" & strUserNum & "',GETNP22)"
         Else
            strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05," & _
               "NP07,NP08,NP09,NP10,NP22) VALUES ('" & rsA.Fields(0).Value & "','" & pa(1) & _
               "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 通知實審日 & "," & _
               PUB_GetWorkDay1(CompDate(0, 1, TransDate(Text7(0), 2)), True) & "," & CompDate(0, 1, TransDate(Text7(0), 2)) & _
               ",'" & strUserNum & "',GETNP22)"
         End If
      Else
         strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05," & _
            "NP07,NP08,NP09,NP10,NP22) VALUES ('" & strReceiveNo & "','" & pa(1) & _
            "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 通知實審日 & "," & _
            PUB_GetWorkDay1(CompDate(0, 1, TransDate(Text7(0), 2)), True) & "," & CompDate(0, 1, TransDate(Text7(0), 2)) & _
            ",'" & strUserNum & "',GETNP22)"
      End If
      If rsA.State <> adStateClosed Then rsA.Close
      Set rsA = Nothing
      cnnConnection.Execute strTxt(intStep)
      'intMax = GetNextProgressNo  'edit by nickc 2007/02/02 不用 dll 了  intMax = objPublicData.GetNextProgressNo
      intStep = intStep + 1
   End If
   '2005/11/22 END
   
'Remove by Morgan 2009/8/18 改上面程式段處理(催審表不再使用,審查時間設6個月)
'   '4
'   If Text7(2) = 修正 Or Text7(2) = 申復 Then
'        'Modify By  Cheng 2002/12/18
'        '避免傳回"資料提供者或其他服務回傳電子郵件狀態"訊息
''      strExc(0) = "SELECT MIN(NP22) FROM NEXTPROGRESS WHERE NP01='" & strReceiveNo & "' AND " & _
''         "NP07=" & 催審 & " AND (NP06 IS NULL OR NP06='')"
'      strExc(0) = "SELECT NP22 FROM NEXTPROGRESS WHERE NP01='" & strReceiveNo & "' AND " & _
'         "NP07=" & 催審 & " AND (NP06 IS NULL OR NP06='') AND NP22 = (SELECT MIN(NP22) FROM NEXTPROGRESS WHERE NP01='" & strReceiveNo & "' AND NP07=" & 催審 & " AND (NP06 IS NULL OR NP06='') ) "
'      intI = 1
'      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
'      If intI = 1 Then
'         strTmp = CompDate(1, 6, TransDate(Text7(0), 2))
'        '若本所期限非工作天則抓最近的工作天
'         strTxt(intStep) = "UPDATE NEXTPROGRESS SET NP08=" & PUB_GetWorkDay1(strTmp, True) & "," & _
'            "NP09=" & strTmp & " WHERE NP01='" & strReceiveNo & "' AND " & _
'            "NP07=" & 催審 & " AND NP22=" & RsTemp.Fields(0)
'        'Add By Cheng 2002/11/06
'        cnnConnection.Execute strTxt(intStep)
'         intStep = intStep + 1
'      End If
'   End If

   '5
   'm_strMailCP09 = ""            '2010/1/21 cancel by sonia
   ReDim skMail(0) As SeekMails   '2010/1/21 ADD BY SONIA

'Add by Morgan 2007/11/26 新案才要做 Ex.P-85173,CFP-20460,CFP-20457國內新案已發文，國外案齊備日人工拿掉，國內案補文件發文時不可上國外案齊備日
'Modify by Morgan 2010/1/13 A類的修正,主動修正仍然要
'If InStr(CaseMapIn, Text7(2)) > 0 Then
'Modified by Morgan 2016/2/2 排除FMP案
If Not m_bolFMP And InStr(CaseMapIn, Text7(2)) > 0 Or (Text7(2) = "203" Or Text7(2) = "204") Then
   
'Removed by Morgan 2013/2/20 B類也要--郭雅娟
'   'Add by Morgan 2006/10/14
'   '台灣案之B類主動修正及修正發文時,不要更新大陸案或CFP案之齊備日--郭
'   If Not (pa(9) = "000" And Left(cp(9), 1) = "B" And (Text7(2) = "203" Or Text7(2) = "204")) Then
'end 2013/2/20
      
      'Modify by Morgan 2005/1/12 國外案閉卷的不算
      'strExc(0) = "SELECT CM01,CM02,CM03,CM04 FROM CASEMAP WHERE " & ChgCaseMap(pa(1) & pa(2) & pa(3) & pa(4), 0, 1)
      '2010/1/21 MODIFY BY SONIA 加案件名稱(發MAIL用)
      strExc(0) = "SELECT CM01,CM02,CM03,CM04,PA09,NVL(PA05,NVL(PA06,PA07)) PA05,1 Flg FROM CASEMAP,PATENT WHERE " & ChgCaseMap(pa(1) & pa(2) & pa(3) & pa(4), 0, 1) & " AND PA01(+)=CM01 AND PA02(+)=CM02 AND PA03(+)=CM03 AND PA04(+)=CM04 AND CM10='0' AND PA57 IS NULL"
      
      'Add by Morgan 2011/7/7
      '若國外案發文時其他的國外案也要上齊備日 Ex.P-98504
      strExc(0) = strExc(0) & " union " & _
         " SELECT CM01,CM02,CM03,CM04,PA09,NVL(PA05,NVL(PA06,PA07)) PA05,2 Flg FROM CASEMAP a,PATENT" & _
         " where cm10='0' and (cm05,cm06,cm07,cm08) in (select b.cm05,b.cm06,b.cm07,b.cm08 from casemap b" & _
         " where b.cm01='" & pa(1) & "' and b.cm02='" & pa(2) & "' and b.cm03='" & pa(3) & "' and b.cm04='" & pa(4) & "' and b.cm10='0')" & _
         " and pa01(+)=cm01 and pa02(+)=cm02 and pa03(+)=cm03 and pa04(+)=cm04 and pa57 is null"
      'end 2011/7/7
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         With RsTemp
            Do While Not .EOF
            
'Removed by Morgan 2016/6/4 取消,會稿完成控制就好--林柄佑,郭雅娟
'               '更新EP06時同時更新此筆EP02相對於Caseprogress的承辦期限(CP48)
'               '抓無發文日的資料
'               'Modify by Morgan 2004/10/28 加判斷 CP57 IS NULL(未取消收文)
'               '2006/3/7 MODIFY BY SONIA 加案件性質 109,110,112
'               '2010/1/21 MODIFY BY SONIA 國外案案件性質改為常數判斷,並加cp14及各日期於發MAIL時通知承辦人原始資料
'               'StrSQLa = "Select EP02, CP06 From EngineerProgress, CaseProgress WHERE EP02=CP09 And EP02=(SELECT CP09 FROM CASEPROGRESS WHERE " & ChgCaseprogress("" & .Fields(0) & .Fields(1) & .Fields(2) & .Fields(3)) & _
'                               " AND ((To_Number(CP10)>=101 AND To_Number(CP10)<=104) OR To_Number(CP10)=109 OR To_Number(CP10)=110 OR To_Number(CP10)=112) And CP27 Is Null ) AND  CP57 IS NULL "
'               'Modified by Morgan 2016/2/2
'               StrSQLa = "Select EP02,CP06,CP14,CP48,EP06,EP09,EP28,EP07,EP08,EP33,CP12 From EngineerProgress, CaseProgress WHERE EP02=CP09 And EP02=(SELECT CP09 FROM CASEPROGRESS WHERE " & ChgCaseprogress("" & .Fields(0) & .Fields(1) & .Fields(2) & .Fields(3)) & _
'                               " AND instr('" & CaseMapIn & "',cp10)>0 And CP27 Is Null AND ROWNUM<2 ) AND  CP57 IS NULL"
'               '2010/1/21 END
'
'               'Modify by Morgan 2006/7/31 若案件性質為修正(203,204)時,只要國外案未發文則發Mail通知工程師並更新齊備日及承辦期限--郭
'               'StrSQLa = StrSQLa & " AND (EP06 IS NULL OR EP06=0) "
'               'Modify by Morgan 2011/7/7
'               'If Not (Text7(2) = "203" Or Text7(2) = "204") Then
'               If Not (RsTemp.Fields("Flg") = "1" And (Text7(2) = "203" Or Text7(2) = "204")) Then   'Add by Morgan 2011/7/7 因為加國外案發文控制,所以此處加判斷國內案發文
'                  '國外案為大陸外觀設計時則發Mail通知工程師並更新齊備日及承辦期限--郭
'                  'Modify by Morgan 2007/3/1 香港,澳門的外觀設計也比照大陸
'                  'StrSQLa = StrSQLa & " AND (EP06 IS NULL OR EP06=0 OR EXISTS(SELECT * FROM PATENT WHERE PA01=CP01 AND PA02=CP02 AND PA03=CP03 AND PA04=CP04 AND PA08='3' AND PA09='020')) "
'                  'Modify by Morgan 2009/10/28 外觀設計已改由工程師承辦,若已有齊備日則無須再更新--郭
'                  'StrSQLa = StrSQLa & " AND (EP06 IS NULL OR EP06=0 OR EXISTS(SELECT * FROM PATENT WHERE PA01=CP01 AND PA02=CP02 AND PA03=CP03 AND PA04=CP04 AND PA08='3' AND PA09 in ('020','013','044'))) "
'                  StrSQLa = StrSQLa & " AND (EP06 IS NULL OR EP06=0) "
'               End If
'               'End
'               rsA.CursorLocation = adUseClient
'               rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
'               If rsA.RecordCount > 0 Then
'                   While Not rsA.EOF
'                     'Add by Morgan 2006/9/12
'                     '若國外案有其他國內案未發文時不做
'                     bolLstInnerCase = True
'                     If RsTemp.Fields("Flg") = "1" Then 'Add by Morgan 2011/7/7 因為加國外案發文控制,所以此處加判斷國內案發文
'                        strExc(0) = "select cp01,cp02,cp03,cp04 from casemap,caseprogress" & _
'                           " where cm10='0' and cm01='" & .Fields("cm01") & "' and cm02='" & .Fields("cm02") & "' and cm03='" & .Fields("cm03") & "' and cm04='" & .Fields("cm04") & "'" & _
'                           " and cp01(+)=cm05 and cp02(+)=cm06 and cp03(+)=cm07 and cp04(+)=cm08 AND CP10 IN (" & CaseMapIn & ") and cp27 is null and cp57 is null and rownum<2"
'                        intI = 1
'                        Set AdoRecordSet3 = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
'                        If intI = 1 Then
'                           bolLstInnerCase = False
'                        End If
'                     End If
'                     If bolLstInnerCase = True Then
'                     'end 2006/9/12
'
'
'                        If IsNull(rsA.Fields("EP06")) Or (Text7(2) <> "203" And Text7(2) <> "204") Then  'Added by Morgan 2013/8/2 若發文修正或主動修修正且相關案已齊備則改在收文作業
'
'                           'Add by Morgan 2007/3/1 不管有沒有承辦期限都要更新齊備日及發Mail--玲玲
'                           '2010/1/21 MODIFY BY SONIA 其他日期都清除
'                           'strSql = "Update ENGINEERPROGRESS Set EP06=" & strSrvDate(1) & " Where EP02='" & rsA.Fields(0).Value & "' "
'                           strSql = "Update ENGINEERPROGRESS Set EP06=" & strSrvDate(1) & ",EP09=NULL,EP28=NULL,EP07=NULL,EP08=NULL,EP33=NULL Where EP02='" & rsA.Fields(0).Value & "' "
'                           cnnConnection.Execute strSql, intI
'                           '2010/1/21 modify BY SONIA
'                           'm_strMailCP09 = m_strMailCP09 & rsA.Fields(0).Value & ","
'                           ReDim Preserve skMail(UBound(skMail) + 1) As SeekMails
'                           skMail(UBound(skMail)).fiSender = strUserNum
'                           skMail(UBound(skMail)).fiReceiver = rsA.Fields("CP14").Value
'                           skMail(UBound(skMail)).fiRecriverNo = ""
'                           If "" & rsA.Fields("EP06").Value = "" Then
'                              skMail(UBound(skMail)).fiSubject = "因關聯基礎案" & Me.Text1.Text & "-" & Me.Text2.Text & "-" & Me.Text3.Text & "-" & Me.Text4.Text & "的" & Label3(5) & "發文，上未齊備關聯案的文件齊備日及承辦期限！"
'                              skMail(UBound(skMail)).fiContent = "未齊備關聯案：" & vbCrLf & vbCrLf & "本所案號：" & RsTemp("cm01") & "-" & RsTemp("cm02") & IIf(RsTemp("cm03") & RsTemp("cm04") = "000", "", "-" & RsTemp("cm03") & "-" & RsTemp("cm04")) & vbCrLf & "總收文號：" & rsA.Fields(0).Value & vbCrLf & "案件名稱：" & RsTemp("PA05") & vbCrLf & "文件齊備日：" & ChangeTStringToTDateString(strSrvDate(2))
'                           Else
'                              skMail(UBound(skMail)).fiSubject = "因關聯基礎案" & Me.Text1.Text & "-" & Me.Text2.Text & "-" & Me.Text3.Text & "-" & Me.Text4.Text & "的" & Label3(5) & "發文，更新未發文關聯案之文件齊備日為系統日並重新計算承辦期限！"
'                              skMail(UBound(skMail)).fiContent = "未發文關聯案原承辦進度資料如下：" & vbCrLf & vbCrLf & "本所案號：" & RsTemp("cm01") & "-" & RsTemp("cm02") & IIf(RsTemp("cm03") & RsTemp("cm04") = "000", "", "-" & RsTemp("cm03") & "-" & RsTemp("cm04")) & vbCrLf & "總收文號：" & rsA.Fields(0).Value & vbCrLf & "案件名稱：" & RsTemp("PA05") & vbCrLf & _
'                                                                 "文件齊備日：" & ChangeWStringToTDateString("" & rsA.Fields("EP06").Value) & vbCrLf & _
'                                                                 "承辦　期限：" & ChangeWStringToTDateString("" & rsA.Fields("CP48").Value) & vbCrLf & _
'                                                                 "完　稿　日：" & ChangeWStringToTDateString("" & rsA.Fields("EP09").Value) & vbCrLf & _
'                                                                 "會　稿　日：" & ChangeWStringToTDateString("" & rsA.Fields("EP07").Value) & vbCrLf & _
'                                                                 "預定會稿日：" & ChangeWStringToTDateString("" & rsA.Fields("EP28").Value) & vbCrLf & _
'                                                                 "英文核完日：" & ChangeWStringToTDateString("" & rsA.Fields("EP33").Value) & vbCrLf & _
'                                                                 "會稿完成日：" & ChangeWStringToTDateString("" & rsA.Fields("EP08").Value)
'                           End If
'                           '2010/1/21 END
'                           'end 2007/3/1
'
'                        End If 'Added by Morgan 2013/8/2 若發文修正或主動修修正且相關案已齊備則改在收文作業
'
'                        If Left(rsA.Fields("CP12").Value, 1) = "F" Or PUB_IfSetCP48() Then 'Add by Morgan 2010/10/5
'
'                           'Modify by Morgan 2007/10/11 承辦期限改呼叫共用函數計算
'                           'strSQL = "Select NVL(CF04,0) From CaseProgress, Patent, Casefee Where CP09='" & rsA.Fields(0).Value & "' and cp01=pa01(+) and cp02=pa02(+) and cp03=pa03(+) and cp04=pa04(+)  and PA01=cf01(+) and pa09=cf02(+) and cp10=cf03 "
'                           strSql = "Select cp01,cp10,pa09 From CaseProgress, Patent Where CP09='" & rsA.Fields(0).Value & "' and cp01=pa01(+) and cp02=pa02(+) and cp03=pa03(+) and cp04=pa04(+)"
'                           'end 2007/10/11
'                           rsB.CursorLocation = adUseClient
'                           rsB.Open strSql, cnnConnection, adOpenStatic, adLockReadOnly
'                           If rsB.RecordCount > 0 Then
'                               'Modify by Morgan 2007/10/11 承辦期限改呼叫共用函數計算
'                               'If Val("" & rsB.Fields(0).Value) > 0 Then
'                               '    strPromoteDate = CompWorkDay(rsB.Fields(0).Value, strSrvDate(1), 0)
'                               '    '若有計算出承辦期限且有本所期限
'                               '    If strPromoteDate <> "" And "" & rsA.Fields(1).Value <> "" Then
'                               '        '若承辦期限大於本所期限
'                               '        If strPromoteDate > "" & rsA.Fields(1).Value Then
'                               '            strPromoteDate = "" & rsA.Fields(1).Value
'                               '        End If
'                               '    End If
'                               strPromoteDate = Pub_GetHandleDay(rsB.Fields("cp01"), rsB.Fields("pa09"), rsB.Fields("cp10"), , "" & rsA.Fields(1), rsA.Fields(0))
'                               If strPromoteDate <> "" Then
'                               'end 2007/10/11
'                                   strTxt(intStep) = "Update CaseProgress Set CP48=" & CNULL(strPromoteDate) & " Where CP09='" & rsA.Fields(0).Value & "' "
'                                   cnnConnection.Execute strTxt(intStep)
'                                   intStep = intStep + 1
'                                   'Remove by Morgan 2007/3/1 移到上面做
'                                   'Add by Morgan 2006/7/31 齊備日也更新(考慮修正及大陸外觀設計狀況)
'                                   'strSQL = "Update ENGINEERPROGRESS Set EP06=" & strSrvDate(1) & " Where EP02='" & rsA.Fields(0).Value & "' "
'                                   'cnnConnection.Execute strSQL, intI
'                                   'end 2006/7/31
'                                   'm_strMailCP09 = m_strMailCP09 & rsA.Fields(0).Value & ","
'                                   'end 2007/3/1
'                               End If
'                           End If
'                           If rsB.State <> adStateClosed Then rsB.Close
'                           Set rsB = Nothing
'
'                        End If 'Add by Morgan 2010/10/5
'
'                     End If
'                     rsA.MoveNext
'                   Wend
'               End If
'               If rsA.State <> adStateClosed Then rsA.Close
'               Set rsA = Nothing
'               'End
'end 2016/6/4
               
               'Add by Morgan 2009/10/6
               '台灣專利申請案上發文日時發EMail通知大陸案繪圖人員
               'Modify by Morgan 2011/10/26 +PCT
               'If pa(9) = "000" And .Fields("pa09") = "020" Then
               'Modified by Morgan 2015/6/30 +香港短期及外觀(因標準專利建的關聯非國內外cm10='4'故可只控制國家)
               If pa(9) = "000" And (.Fields("pa09") = "020" Or .Fields("pa09") = "056" Or .Fields("pa09") = "013") Then
                  'Removed by Morgan 2013/10/2 取消,承辦單已電子化--瓊玉
                  'strExc(1) = pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4))
                  'strExc(2) = .Fields("cm01") & "-" & .Fields("cm02") & IIf(.Fields("cm03") & .Fields("cm04") = "000", "", "-" & .Fields("cm03") & "-" & .Fields("cm04"))
                  'strExc(3) = "台灣案 " & strExc(1) & " 已發文,請製作" & IIf(.Fields("pa09") = "056", "PCT", "大陸") & "案 " & strExc(2) & " pdf 檔之圖式交承辦人"
                  'strSql = "insert into mailcache(mc01,mc02,mc03,mc04,mc07,mc08)" & _
                     " select '" & strUserNum & "',cp29,to_char(sysdate,'yyyymmdd'),to_char(sysdate,'hh24miss')" & _
                     ",'" & strExc(3) & "'||st02||'('||cp14||')','如旨' from caseprogress,staff" & _
                     " where cp01='" & .Fields("cm01") & "' and cp02='" & .Fields("cm02") & "'" & _
                     " and cp03='" & .Fields("cm03") & "' and cp04='" & .Fields("cm04") & "'" & _
                     " and instr('" & CaseMapOut & "',cp10)>0 and cp57 is null and cp27 is null and cp29 is not null and st01(+)=cp14" & _
                     " and not exists(select * from mailcache where mc02=cp29 and instr(mc07,'" & strExc(1) & "')>0" & _
                     " and instr(mc07,'" & strExc(2) & "')>0 and instr(upper(mc07),'PDF')>0)"
                  'cnnConnection.Execute strSql, intI
                  'end 2013/10/2
                  
                  'Add by Morgan 2010/5/4 草墨都不計件的案子，更新草墨圖要計件,加乘註記=0.2,張數=0(國外計件值會變成0.6)
                  'Modify by Morgan 2010/5/7 草齊日=墨齊日=文齊日
                  'Modify By Sindy 2014/3/31 +,ep34
                  strExc(0) = "select cp09,ep20,ep29,ep17,ep05,ep13,ep34 from caseprogress,engineerprogress" & _
                     " where cp01='" & .Fields("cm01") & "' and cp02='" & .Fields("cm02") & "'" & _
                     " and cp03='" & .Fields("cm03") & "' and cp04='" & .Fields("cm04") & "'" & _
                     " and instr('" & CaseMapOut & "',cp10)>0 and cp57 is null and cp27 is null and ep02(+)=cp09"
                  intI = 1
                  Set AdoRecordSet3 = ClsLawReadRstMsg(intI, strExc(0))
                  If intI = 1 Then
                     bSetEP17 = False 'Added by Morgan 2013/11/20
                     
                     'Removed by Morgan 2016/2/24 舊規則程式不用再留
                     'If AdoRecordSet3("ep20") = "N" And AdoRecordSet3("ep29") = "N" Then
                     '   'Modify by Morgan 2010/12/13 +繪圖主管確認分案
                     '   strSql = "update caseprogress set cp101=0.2,cp104=0.2,CP107=decode(cp29,null,null,'Y') where cp09='" & AdoRecordSet3(0) & "'"
                     '   cnnConnection.Execute strSql, intI
                     '   'Modify by Morgan 2010/11/15 統一用系統日 --瓊玉
                     '   'strSql = "update engineerprogress set ep20=null,ep29=null,ep16=0,ep19=0,ep14=ep06,ep17=ep06 where ep02='" & AdoRecordSet3(0) & "'"
                     '   'Modify By Sindy 2014/3/31 大陸案有靋n會稿者,不要帶繪圖的墨齊日
                     '   'strSql = "update engineerprogress set ep20=null,ep29=null,ep16=0,ep19=0,ep14=" & strSrvDate(1) & ",ep17=" & strSrvDate(1) & " where ep02='" & AdoRecordSet3(0) & "'"
                     '   strSql = "update engineerprogress set ep20=null,ep29=null,ep16=0,ep19=0,ep14=" & strSrvDate(1) & ",ep17=" & IIf(.Fields("pa09") = "020" And "" & AdoRecordSet3("ep34") = "Y", "null", strSrvDate(1)) & " where ep02='" & AdoRecordSet3(0) & "'"
                     '   cnnConnection.Execute strSql, intI
                     '
                     '   bSetEP17 = True 'Added by Morgan 2013/11/20
                     '
                     ''Add by Morgan 2011/4/12
                     ''新規則改要計件
                     'Else
                     'end 2016/2/24
                     
                        'Modify By Sindy 2014/3/31 大陸案有勾要會稿者,不要帶繪圖的墨齊日
'                        strSql = "update engineerprogress set ep14=nvl(ep14,decode(ep20,null,to_char(sysdate,'yyyymmdd')))" & _
'                           ",ep17=nvl(ep17,decode(ep29,null,to_char(sysdate,'yyyymmdd')))" & _
'                           " where ep02='" & AdoRecordSet3(0) & "'"
                        strSql = "update engineerprogress set ep14=nvl(ep14,decode(ep20,null,to_char(sysdate,'yyyymmdd')))" & _
                           ",ep17=nvl(ep17,decode(ep29,null," & IIf(.Fields("pa09") = "020" And "" & AdoRecordSet3("ep34") = "Y", "null", strSrvDate(1)) & "))" & _
                           " where ep02='" & AdoRecordSet3(0) & "'"
                        cnnConnection.Execute strSql, intI
                        
                        If IsNull(AdoRecordSet3("ep29")) And IsNull(AdoRecordSet3("ep17")) Then bSetEP17 = True 'Added by Morgan 2013/11/20
                        
                     'End If 'Removed by Morgan 2016/2/24
                     
                     'Add By Sindy 2014/3/31 大陸案有勾要會稿者,不要帶繪圖的墨齊日
                     If .Fields("pa09") = "020" And "" & AdoRecordSet3("ep34") = "Y" Then
                        bSetEP17 = False
                     End If
                     '2014/3/31 END
                     
                     'Added by Morgan 2013/11/21
                     '若有上 墨齊日 則發Mail通知並新增 系統上墨 歷程
                     If bSetEP17 = True And Not IsNull(AdoRecordSet3("ep13")) Then
                        strExc(1) = pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4))
                        strExc(2) = .Fields("cm01") & "-" & .Fields("cm02") & IIf(.Fields("cm03") & .Fields("cm04") = "000", "", "-" & .Fields("cm03") & "-" & .Fields("cm04"))
                        strExc(3) = "台灣案 " & strExc(1) & " 已發文," & IIf(.Fields("pa09") = "056", "PCT", "大陸") & "案 " & strExc(2) & " 請上墨處理！"
                        strSql = "insert into mailcache(mc01,mc02,mc03,mc04,mc07,mc08)" & _
                           " values('" & strUserNum & "','" & AdoRecordSet3("ep13") & "',to_char(sysdate,'yyyymmdd'),to_char(sysdate,'hh24miss')" & _
                           ",'" & strExc(3) & "','如旨')"
                        cnnConnection.Execute strSql, intI
                        strSql = "insert into empelectronprocess(eep01,eep02,eep03,eep04,eep05,eep06,eep07,eep08) select '" & AdoRecordSet3("cp09") & "',nvl(max(eep02),0)+1" & _
                           ",'" & AdoRecordSet3("ep05") & "','22','" & AdoRecordSet3("ep13") & "',to_char(sysdate,'yyyymmdd'),to_char(sysdate,'hh24miss'),'國內案已發文，請上墨處理！'" & _
                           " FROM empelectronprocess WHERE eep01='" & AdoRecordSet3("cp09") & "'"
                        cnnConnection.Execute strSql, intI
                     End If
                     
                  End If
                  'end 2010/5/4
                  
               End If
               'End 2009/10/6
               
'Remove by Morgan 2006/10/14 上面已經有做過
'               'EngineerProgress上文件齊備日(EP06)
'               '2006/3/7 MODIFY BY SONIA 加案件性質 109,110,112
'               strTxt(intStep) = "UPDATE ENGINEERPROGRESS SET EP06=" & strSrvDate(1) & _
'                  " WHERE EP02 IN (SELECT CP09 FROM CASEPROGRESS WHERE " & ChgCaseprogress(.Fields(0) & .Fields(1) & .Fields(2) & .Fields(3)) & _
'                  " AND ((CP10>='101' AND CP10<='104') OR CP10='109' OR CP10='110' OR CP10='112')) AND (EP06 IS NULL OR EP06=0)"
'               cnnConnection.Execute strTxt(intStep), intI
'               intStep = intStep + 1
'end
               
               'Add by Morgan 2007/2/9 台灣新型發文預估3個月的核准日更新到國外新申請案的期限
               'Remove by Morgan 2007/8/13 領證發文預設公告的控制已足夠--請作單
               'If pa(9) = "000" And Text7(2) = "102" Then
               '   strExc(1) = CompDate(1, 3, Text7(0))
               '   strExc(2) = PUB_GetWorkDay1(strExc(1), True)
               '   strSQL = "UPDATE CASEPROGRESS SET CP06=" & strExc(2) & ",CP07=" & strExc(1) & _
               '      " WHERE " & ChgCaseprogress("" & .Fields(0) & .Fields(1) & .Fields(2) & .Fields(3)) & _
               '      " AND CP27 IS NULL AND CP57 IS NULL AND CP10 IN ('101','102','103','104','105')" & _
               '      " AND ( CP07 IS NULL OR CP07>" & strExc(1) & " )"
               '   adoTaie.Execute strSQL, intI
               'End If
               'End 2007/8/13
               'End 2007/2/9
               .MoveNext
            Loop
         End With
      End If
      
'   End If 'Removed by Morgan 2013/2/20 B類也要--郭雅娟
End If

   'Modify by Morgan 2009/6/1  原提申期限改為最終提申期限(國外指示信輸入)
   'If Text7(3) <> "" And Me.Text7(3).Enabled Then
   '     '若本所期限非工作天則抓最近的工作天
   '   strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05,NP07,NP08,NP09,NP10,NP22) VALUES " & _
   '      "('" & strReceiveNo & "','" & pa(1) & "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'," & 提申 & "," & _
   '      PUB_GetWorkDay1(TransDate(Text7(3), 2), True) & "," & TransDate(Text7(3), 2) & ",'" & strUserNum & "'," & intMax & ")"
   '     'Add By Cheng 2002/11/06
   '     cnnConnection.Execute strTxt(intStep)
   ''    intMax = intMax + 1
   '     intMax = GetNextProgressNo  'edit by nickc 2007/02/02 不用 dll 了  intMax = objPublicData.GetNextProgressNo
   '   intStep = intStep + 1
   'End If
   '沒有指定提申日時要管制最終和一般期限
   If Text7(28) = "" Then
      'Added by Morgan 2013/7/5
      '有法定期限時都要管制最終提申
      If pa(9) <> "000" Then
         '最終提申
         'Modified by Morgan 2013/7/29 106(主張國際優先權),121(主張國內優先權)除外
         'Modified by Morgan 2013/10/24 +排除 C類,會稿924,告代901,回代936,檢視PCT公開本與FCP相異處942
         If Text7(3) = "" And cp(7) <> "" And cp(9) < "C" And InStr("106,121,924,901,936,942", Text7(2)) = 0 Then
            strExc(1) = DBDATE(cp(7))
            strExc(2) = PUB_GetWorkDay1(strExc(1), True)
            strSql = " insert into nextprogress a (np01,np02,np03,np04,np05,np07,np08,np09,np10,np22)" & _
               " values('" & cp(9) & "','" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "','996'" & _
               "," & strExc(2) & "," & strExc(1) & ",'" & strUserNum & "',GETNP22)"
            cnnConnection.Execute strSql, intI
         End If
      End If
      'end 2013/7/5
      
      '有設定提申期限的才要管制
      If ClsPDGetCaseDelayDay(cp(1), pa(9), cp(10), , , strTmp) Then
         If strTmp <> "" Then
            'Removed by Morgan 2013/7/5 移到上面
            ''最終提申
            'If Text7(3) = "" And cp(7) <> "" Then
            '   strExc(1) = DBDATE(cp(7))
            '   strExc(2) = PUB_GetWorkDay1(strExc(1), True)
            '   strSql = " insert into nextprogress a (np01,np02,np03,np04,np05,np07,np08,np09,np10,np22)" & _
            '      " values('" & cp(9) & "','" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "','996'" & _
            '      "," & strExc(2) & "," & strExc(1) & ",'" & strUserNum & "',GETNP22)"
            '   cnnConnection.Execute strSql, intI
            'End If
            'end 2013/7/5
            
            'Modify by Morgan 2009/12/17 +控制有順稿的不掛一般提申期限
            If Check1.Value = 0 Then
               If Not (Text7(24) = "" And Text7(2) = "203") Then 'Added by Morgan 2013/5/21 主動補正有申請案號時才要管制收達提申期限
                  '一般提申
                  strExc(1) = CompDate(2, Val(strTmp), DBDATE(Text7(0)))
                  'Add by Morgan 2010/6/15 +判斷沒有最終提申或一般提申早於最終提申時才新增
                  If Text7(3) <> "" Then
                     strExc(3) = DBDATE(Text7(3))
                  ElseIf cp(7) <> "" Then
                     strExc(3) = DBDATE(cp(7))
                  Else
                     strExc(3) = ""
                  End If
                  If strExc(3) = "" Or Val(strExc(1)) < Val(strExc(3)) Then
                  'end 2010/6/15
                     strExc(2) = PUB_GetWorkDay1(strExc(1), True)
                     strSql = " insert into nextprogress a (np01,np02,np03,np04,np05,np07,np08,np09,np10,np22)" & _
                        " values('" & cp(9) & "','" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "','998'" & _
                        "," & strExc(2) & "," & strExc(1) & ",'" & strUserNum & "',GETNP22)"
                     cnnConnection.Execute strSql, intI
                     
                  End If 'Add by Morgan 2010/6/15
                  
               End If 'Added by Morgan 2013/5/21
            End If
               
         End If
      End If
   End If
   'end 2009/6/1
   
   
   '回覆代理人發文檢查若相關總收文號的相關總收文號已發文未提申時
   '以本程序發文日重算提申期限更新之
'Modify by Morgan 2009/12/17 回覆委任代理人發文要掛相關收文號一般提申期限
'   If cp(10) = "902" Then
'      strExc(0) = "select cp09,cp10 from caseprogress a where cp09=(select b.cp43 from caseprogress b where b.cp09='" & cp(43) & "') and cp27>0 and cp47 is null"
'      intI = 1
'      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
'      If intI = 1 Then
'         strRecNo = RsTemp(0)
'         '有預設提申期限的才做
'         If ClsPDGetCaseDelayDay(pa(1), pa(9), RsTemp("cp10"), , , strTmp) Then
'            If strTmp <> "" Then
'               '提申期限
'               strExc(1) = CompDate(2, Val(strTmp), DBDATE(Text7(0))) '法
'               strExc(2) = PUB_GetWorkDay1(strExc(1), True) '所
'               strExc(0) = "select * from nextprogress where np01='" & strRecNo & "' and np07='998' and np06 is null"
'               intI = 1
'               Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
'               If intI = 1 Then
'                  strSql = "update nextprogress set np08=" & strExc(2) & ",np09=" & strExc(1) & _
'                     " where np01='" & RsTemp("np01") & "' and np07='998' and np22=" & RsTemp("np22")
'                  cnnConnection.Execute strSql, intI
'               Else
'                  strSql = " insert into nextprogress a (np01,np02,np03,np04,np05,np07,np08,np09,np10,np22)" & _
'                     " values('" & strRecNo & "','" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "'" & _
'                     ",'998'," & strExc(2) & "," & strExc(1) & ",'" & strUserNum & "',GETNP22)"
'                  cnnConnection.Execute strSql, intI
'               End If
'            End If
'         End If
'      End If
   'Modify by Morgan 2010/1/28 C類則再抓一次相關總收文號
   'If Text7(2) = "936" And cp(43) <> "" And cp(43) < "C" Then
   'Modified by Morgan 2014/6/20 要判斷未提申--玲玲 Ex.P-108140
   If Text7(2) = "936" And cp(43) <> "" Then
      'Modify By Sindy 2014/7/24 若相關總收文號的案件性質為950案件暫緩時，再抓一次相關總收文號，去更新該筆資料下一程序的提申期限
      If str950CP43 <> "" Then
         strExc(0) = "select cp09,cp10,np01 from caseprogress,nextprogress" & _
            " where cp09='" & str950CP43 & "' and np01(+)=cp09 and np07(+)='995' and cp27>0 and cp47 is null"
      ElseIf cp(43) < "C" Then
      'If cp(43) < "C" Then
      '2014/7/24 END
         strExc(0) = "select cp09,cp10,np01 from caseprogress,nextprogress" & _
            " where cp09='" & cp(43) & "' and np01(+)=cp09 and np07(+)='995' and cp27>0 and cp47 is null"
      'Add by Morgan 2010/1/28
      Else
         strExc(0) = "select cp09,cp10,np01 from caseprogress c1,nextprogress" & _
            " where cp09=(select c2.cp43 from caseprogress c2 where c2.cp09='" & cp(43) & "') and np01(+)=cp09 and np07(+)='995' and cp27>0 and cp47 is null"
      End If
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         '沒有掛指定提申期限
         If IsNull(RsTemp.Fields("np01")) Then
            st936CP09 = "" & RsTemp.Fields("cp09")
            If ClsPDGetCaseDelayDay(cp(1), pa(9), RsTemp("cp10"), , , strTmp) Then
               '有設定提申天數
               If strTmp <> "" Then
                  '一般提申
                  strExc(1) = CompDate(2, Val(strTmp), DBDATE(Text7(0)))
                  strExc(2) = PUB_GetWorkDay1(strExc(1), True)
                  strSql = "update nextprogress set np08=" & strExc(2) & ",np09=" & strExc(1) & _
                     " where np01='" & st936CP09 & "' and np07='998'"
                  cnnConnection.Execute strSql, intI
                  If intI = 0 Then
                     strSql = " insert into nextprogress a (np01,np02,np03,np04,np05,np07,np08,np09,np10,np22)" & _
                        " values('" & st936CP09 & "','" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "','998'" & _
                        "," & strExc(2) & "," & strExc(1) & ",'" & strUserNum & "',GETNP22)"
                     cnnConnection.Execute strSql, intI
                  End If
               End If
            End If
         End If
      End If
   End If
'2009/12/17
   
   '13
   '若更改案件性質
   If Text7(2) <> cp(10) Then
      If Left(Text7(2), 1) = "3" Then
         strTxt(intStep) = "INSERT INTO CASEPROGRESS (CP01,CP02,CP03,CP04,CP09," & _
            "CP10,CP20,CP32,CP27) VALUES ('" & pa(1) & "','" & pa(2) & _
            "','" & pa(3) & "','" & pa(4) & "','" & AutoNo("B", 6) & "','" & Text7(2) & _
            "','N','N'," & TransDate(Text7(0), 2) & ")"
        cnnConnection.Execute strTxt(intStep)
         intStep = intStep + 1
         If Text7(2) = "301" Or Text7(2) = "302" Or Text7(2) = "303" Then
            strTxt(intStep) = "UPDATE PATENT SET PA08='" & Right(Text7(2), 1) & "' WHERE " & ChgPatent(pa(1) & pa(2) & pa(3) & pa(4))
            cnnConnection.Execute strTxt(intStep)
            intStep = intStep + 1
         End If
      ElseIf Text7(2) = 舉發 Then
         strTxt(intStep) = "INSERT INTO CASEPROGRESS (CP01,CP02,CP03,CP04,CP09," & _
            "CP10,CP20,CP32,CP27) VALUES ('" & pa(1) & "','" & pa(2) & _
            "','" & pa(3) & "','" & pa(4) & "','" & AutoNo("B", 6) & "','" & 舉發 & _
            "','N','N'," & TransDate(Text7(0), 2) & ")"
        cnnConnection.Execute strTxt(intStep)
         intStep = intStep + 1
         strTxt(intStep) = "UPDATE PATENT SET PA23='3' WHERE " & ChgPatent(pa(1) & pa(2) & pa(3) & pa(4))
        cnnConnection.Execute strTxt(intStep)
         intStep = intStep + 1
      End If
   End If
   
'Modify by Morgan 2009/11/11 收達期限管控改呼叫公用函式
'   strExc(0) = "SELECT CF23 FROM CASEFEE WHERE CF01='" & pa(1) & "' AND CF02='" & pa(9) & "' AND CF03='" & cp(10) & "'"
'   intI = 1
'   Set RsTemp = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
'   If intI = 1 Then
'      If Not IsNull(RsTemp.Fields(0)) Or RsTemp.Fields(0) <> 0 Then
'            '若本所期限非工作天則抓最近的工作天
'         strTxt(intStep) = "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05,NP07,NP08," & _
'            "NP09,NP10,NP22) VALUES ('" & strReceiveNo & "','" & pa(1) & "','" & pa(2) & _
'            "','" & pa(3) & "','" & pa(4) & "'," & 收達 & "," & _
'            PUB_GetWorkDay1(CompDate(2, RsTemp.Fields(0), TransDate(Text7(0), 2)), True) & "," & _
'            CompDate(2, RsTemp.Fields(0), TransDate(Text7(0), 2)) & ",'" & _
'            strUserNum & "',GETNP22)"
'        cnnConnection.Execute strTxt(intStep)
'         intStep = intStep + 1
'      End If
'   End If
   If pa(9) <> "000" Then
      If Not (Text7(24) = "" And Text7(2) = "203") Then 'Added by Morgan 2013/5/21 主動補正有申請案號時才要管制收達提申期限
         PUB_SetArriveDate cp(9)
      End If 'end 2013/5/21
   End If
'end 2009/11/11

   'edit by nickc 2007/02/02 不用 dll 了
   'If Not objPublicData.SavePriority(pA, strPriority(1), strPriority(2), strPriority(3)) Then
   'Modify by Morgan 2008/6/6 +strPriority(4)
   'Modify by Amy 2014/04/08 +strPriority(5)
   If Not ClsPDSavePriority(pa, strPriority(1), strPriority(2), strPriority(3), strPriority(4), strPriority(5)) Then
        GoTo ErrorHandler
   End If
   'Added by Lydia 2023/06/15 寰華案:「414恢復權利-主張優先權106」更新實審期限
   If bolChk414for106 = True Then
      '更新公開和實審期限
      strExc(5) = PUB_GetFirstPriDate(cp())
      strExc(9) = ""
      If strExc(5) <> "" And strExc(5) <> strFirstPriDate Then
         '參考一般來函輸入frm04010504_3:「視為未主張」1918=>公開或實審期限的相關總收文號用申請程序的收文號
         strSql = "select cp09 from caseprogress WHERE CP01='" & pa(1) & "' AND CP02='" & pa(2) & "' AND CP03='" & pa(3) & "' AND CP04='" & pa(4) & "' and instr('" & NewCasePtyList & "',cp10)>0 and cp159=0 order by cp05 asc"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strSql)
         If intI = 1 Then
            strExc(9) = "" & RsTemp(0)
         End If
         '模組沒有寫備註
         strSql = "Update CaseProgress Set CP64=sqldatet(to_char(sysdate,'yyyymmdd'))||'更新期限：原所限'||sqldatet(CP06)||'，原法限'||sqldatet(CP07)||';'||CP64 where CP01='" & pa(1) & "' AND CP02='" & pa(2) & "' AND CP03='" & pa(3) & "' AND CP04='" & pa(4) & "' and cp10='416' and cp158=0 "
         cnnConnection.Execute strSql
         strSql = "Update NextProgress Set NP15=sqldatet(to_char(sysdate,'yyyymmdd'))||'更新期限：原所限'||sqldatet(NP08)||'，原法限'||sqldatet(NP09)||';'||NP15 where np02='" & pa(1) & "' AND np03='" & pa(2) & "' AND np04='" & pa(3) & "' AND np05='" & pa(4) & "' and np07='416' and np06 is null "
         cnnConnection.Execute strSql

         PUB_UpdCfpDate2 pa(1), pa(2), pa(3), pa(4), strExc(5), strExc(9)
         '請彈跳提醒視窗：已更新實體審查期限為: XXX/XX/XX=>移到存檔完成
         strFirstPriDate = "Y" & strFirstPriDate
      End If
   End If
   'end 2023/06/15
'8
   If pa(1) = "P" Then
      i = 專利
   Else
      i = 0
   End If

   'edit by nickc 2007/02/05 不用 dll 了
   'If Not obj003.SaveAddDeadline(cp, strAdddeadline(1), strAdddeadline(2), strAdddeadline(3), 國內, cp(13)) Then
   If Not Cls003SaveAddDeadline(cp, strAdddeadline(1), strAdddeadline(2), strAdddeadline(3), 國內, cp(13)) Then
        GoTo ErrorHandler
   End If
   '92.9.20 add by sonia A類收文之準備程序或言詞辯論, 產生B類收文資料, 但不上發文日,不算案件數
   'Modify by Morgan 2005/3/9 B類也要--郭
   'If Label3(0) < "B" And (Text7(2) = 準備程序 Or Text7(2) = 言詞辯論) Then
   'Modified by Morgan 2019/2/22 改用問的--玲玲
   'If Label3(0) < "C" And (Text7(2) = 準備程序 Or Text7(2) = 言詞辯論) Then
   If m_bAutoBProc Then
      '2009/6/16 MODIFY BY SONIA 加CP64帶出開庭時間
      strTxt(intStep) = "INSERT INTO CASEPROGRESS (CP01,CP02,CP03,CP04,CP09," & _
         "CP10,CP20,CP26,CP32,CP11,CP05,CP06,CP07,CP12,CP13,CP14,CP43,CP64) VALUES ('" & pa(1) & "','" & pa(2) & _
         "','" & pa(3) & "','" & pa(4) & "','" & AutoNo("B", 6) & "','" & Text7(2) & _
         "','N','N','N','90'," & strSrvDate(1) & "," & CNULL(PUB_GetWorkDay1(ChangeTStringToWString(cp(6)), True)) & "," & CNULL(ChangeTStringToWString(cp(7))) & ",'" & stCP12 & _
         "','" & stCP13 & "','" & cp(14) & "','" & cp(9) & "','" & cp(64) & "')"
        cnnConnection.Execute strTxt(intStep)
         intStep = intStep + 1
   End If
   '92.9.20 end
    
   'Add by Morgan 2004/4/1
   'FCP及P的國內案件，若專利種類為'發明'且案件性質為'分割'時，實審期限=母案之申請日＋3年<=分割案之收文日＋1月
   '若有收文未取消收文之'實體審查'，則更新該筆'實體審查'之期限，若無則新增下一程序'實體審查'期限，並顯示'此分割案尚未收文實體審查，期限為XXXXXX，請提醒智權人員 !!'
   If pa(8) = "1" And Text7(2).Text = "307" And pa(9) = "000" Then
      '有收'實體審查'
      If m_stCP09 <> "" Then
         strTxt(intStep) = " UPDATE CASEPROGRESS SET CP06=" & m_stVar(0) & ",CP07=" & m_stVar(3) & " WHERE CP09='" & m_stCP09 & "'"
      '沒有收'實體審查'
      Else
         'Modified by Morgan 2012/10/19 智權人員改抓最新(stCP13)
         strTxt(intStep) = _
            " DECLARE" & _
               " V_NP22 NUMERIC(10,0);" & _
               " V_NP02 VARCHAR2(9);" & _
            " BEGIN" & _
                  " SELECT MAX(NP02) INTO V_NP02 FROM NEXTPROGRESS WHERE NP01='" & cp(9) & "' AND NP07='416';" & _
                  " IF V_NP02 IS NULL THEN" & _
                     " SELECT NVL(MAX(NP22),0)+1 INTO V_NP22 FROM NEXTPROGRESS;" & _
                     " INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05,NP07,NP08,NP09,NP10,NP22)" & _
                     " VALUES ('" & cp(9) & "','" & pa(1) & "','" & pa(2) & "','" & pa(3) & "','" & pa(4) & "'" & _
                     " ,'416'," & m_stVar(0) & "," & m_stVar(3) & ",'" & stCP13 & "',V_NP22);" & _
                  " ELSE" & _
                        " UPDATE NEXTPROGRESS SET NP08=" & m_stVar(0) & ",NP09=" & m_stVar(3) & " WHERE NP01='" & cp(9) & "' AND NP07='416';" & _
                  " END IF;" & _
            " END;"
      End If
      cnnConnection.Execute strTxt(intStep)
      intStep = intStep + 1
   End If
   
   '2005/9/13 ADD BY SONIA 台灣發明案發文日>=91/10/26
   If pa(9) = 台灣國家代號 And pa(8) = "1" And Val(Text7(0)) >= 911026 Then
      '若案件性質為"發明申請"(101)
      If cp(10) = "101" Then
         Dim strTmp1A(0 To 4) As String, strTmpA(1 To 3) As String
         strTmp1A(0) = cp(9)
         For i = 1 To 4
            strTmp1A(i) = pa(i)
         Next
         If GetMoneyDate(Val(pa(8) + 3), pa(9), strTmp1A, strTmpA(1), strTmpA(2), strTmpA(3)) = True Then
            '法定期限
            If strTmpA(3) <> "" Then
                'Added by Lydia 2025/10/29
                stNP23 = ""
                If strSrvDate(1) >= 內專本所約定期限啟用日 Then
                   strTmpA(2) = PUB_GetPOurDeadline(strTmpA(3), pa(9), stNP23, pa(1), 實體審查)
                Else
                'end 2025/10/29
                   'Added by Morgan 2014/10/28
                   If pa(9) = 台灣國家代號 And strSrvDate(1) >= 台灣案所限新規則啟用日 Then
                      strTmpA(2) = PUB_GetOurDeadline(strTmpA(3))
                   Else
                   'end 2014/10/28
                      strTmpA(2) = CompDate(2, -2, strTmpA(3))
                   End If 'Added by Morgan 2014/10/28
                End If 'Added by Lydia 2025/10/29
               
                If rsB.State <> adStateClosed Then rsB.Close
                Set rsB = Nothing
                StrSqlB = "Select * From CaseProgress Where " & ChgCaseprogress(pa(1) & pa(2) & pa(3) & pa(4)) & " And CP10='" & 實體審查 & "' And CP05 IS NOT NULL And CP57 IS NULL "
                rsB.CursorLocation = adUseClient
                rsB.Open StrSqlB, cnnConnection, adOpenStatic, adLockReadOnly
                '若案件進度檔無實體審查的資料(即未收文)
                If rsB.RecordCount <= 0 Then
                    If rsA.State <> adStateClosed Then rsA.Close
                    Set rsA = Nothing
                    StrSQLa = "Select NP01,NP07,NP22 From Nextprogress Where NP22= (SELECT MAX(NP22) FROM NEXTPROGRESS WHERE NP02='" & pa(1) & "' AND NP03='" & pa(2) & "' AND NP04='" & pa(3) & "' AND NP05='" & pa(4) & "' AND NP07='" & 實體審查 & "' AND NP06 IS NULL ) "
                    rsA.CursorLocation = adUseClient
                    rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
                    If rsA.RecordCount > 0 Then
                       'Modified by Lydia 2025/10/29 +NP23
                       strTxt(intStep) = "Update NEXTPROGRESS SET NP08=" & PUB_GetWorkDay1(strTmpA(2), True) & ",NP09=" & strTmpA(3) & ",NP23=" & IIf(stNP23 = "", "NP23", stNP23) & " WHERE NP01='" & rsA.Fields(0).Value & "' AND NP07='" & rsA.Fields(1).Value & "' AND NP22=" & rsA.Fields(2).Value
                       cnnConnection.Execute strTxt(intStep)
                       intStep = intStep + 1
                    Else
                        'Modified by Morgan 2012/10/19 智權人員改抓最新(stCP13)
                        'Modified by Lydia 2025/10/29 +NP23
                        strTxt(intStep) = strTxt(intStep) & "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05,NP07,NP08," & _
                           "NP09,NP10,NP22,NP23) VALUES ('" & cp(9) & "','" & pa(1) & "','" & pa(2) & "','" & pa(3) & "','" & _
                           pa(4) & "'," & 實體審查 & "," & CNULL(PUB_GetWorkDay1(strTmpA(2), True)) & "," & CNULL(strTmpA(3)) & ",'" & stCP13 & "',GETNP22," & CNULL(stNP23, True) & ")"
                        cnnConnection.Execute strTxt(intStep)
                        intStep = intStep + 1
                    End If
                '若案件進度檔有未發文的實體審查資料
                ElseIf "" & rsB("CP27") = "" Then
                    strTxt(intStep) = "Update CaseProgress Set CP06=" & Val(strTmpA(2)) & ",CP07=" & Val(strTmpA(3)) & " Where " & ChgCaseprogress(pa(1) & pa(2) & pa(3) & pa(4)) & " And CP10='" & 實體審查 & "' And CP27 IS NULL "
                    cnnConnection.Execute strTxt(intStep)
                    intStep = intStep + 1
                End If
                If rsB.State <> adStateClosed Then rsB.Close
                Set rsB = Nothing
            End If
         End If
      '若案件性質為"改請發明"(301)
      ElseIf cp(10) = "301" Then
         Dim strNP08 As String '下一程序本所期限
         Dim strNP09 As String '下一程序法定期限
         '法定期限 = 畫面上發文日 + 30 天
         strNP09 = DBDATE(DateSerial(DBYEAR(Text7(0).Text), DBMONTH(Text7(0).Text), DBDAY(Text7(0).Text) + 30))
         
         'Added by Lydia 2025/10/29
         stNP23 = ""
         If strSrvDate(1) >= 內專本所約定期限啟用日 Then
            strNP08 = PUB_GetPOurDeadline(strNP09, pa(9), stNP23, pa(1), 實體審查)
         Else
         'end 2025/10/29
            'Added by Morgan 2014/10/28
            If pa(9) = 台灣國家代號 And strSrvDate(1) >= 台灣案所限新規則啟用日 Then
               strNP08 = PUB_GetOurDeadline(strNP09)
            Else
            'end 2014/10/28
               strNP08 = PUB_GetWorkDay1(DBDATE(DateSerial(DBYEAR(strNP09), DBMONTH(strNP09), DBDAY(strNP09) - 2)), True)
            End If 'Added by Morgan 2014/10/28
         End If 'Added by Lydia 2025/10/29
         
         If rsB.State <> adStateClosed Then rsB.Close
         Set rsB = Nothing
         StrSqlB = "Select * From CaseProgress Where " & ChgCaseprogress(pa(1) & pa(2) & pa(3) & pa(4)) & " And CP10='" & 實體審查 & "' And CP05 IS NOT NULL And CP57 IS NULL "
         rsB.CursorLocation = adUseClient
         rsB.Open StrSqlB, cnnConnection, adOpenStatic, adLockReadOnly
         '若案件進度檔無實體審查的資料(即未收文)
         If rsB.RecordCount <= 0 Then
            If rsA.State <> adStateClosed Then rsA.Close
            Set rsA = Nothing
            StrSQLa = "Select NP01,NP07,NP22 From Nextprogress Where NP22= (SELECT MAX(NP22) FROM NEXTPROGRESS WHERE NP02='" & pa(1) & "' AND NP03='" & pa(2) & "' AND NP04='" & pa(3) & "' AND NP05='" & pa(4) & "' AND NP07='" & 實體審查 & "' AND NP06 IS NULL ) "
            rsA.CursorLocation = adUseClient
            rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
            If rsA.RecordCount > 0 Then
               'Modified by Lydia 2025/10/29 +NP23
               strTxt(intStep) = "Update NEXTPROGRESS SET NP08=" & strNP08 & ",NP09=" & strNP09 & ",NP23=" & IIf(stNP23 = "", "NP23", stNP23) & " WHERE NP01='" & rsA.Fields(0).Value & "' AND NP07='" & rsA.Fields(1).Value & "' AND NP22=" & rsA.Fields(0).Value
               cnnConnection.Execute strTxt(intStep)
               intStep = intStep + 1
            Else
               'Modified by Lydia 2025/10/29 +NP23
               strTxt(intStep) = strTxt(intStep) & "INSERT INTO NEXTPROGRESS (NP01,NP02,NP03,NP04,NP05,NP07,NP08," & _
                  "NP09,NP10,NP22,NP23) VALUES ('" & cp(9) & "','" & pa(1) & "','" & pa(2) & "','" & pa(3) & "','" & _
                  pa(4) & "'," & 實體審查 & "," & CNULL(strNP08) & "," & CNULL(strNP09) & ",'" & cp(13) & "',GETNP22," & CNULL(stNP23, True) & ")"
               cnnConnection.Execute strTxt(intStep)
               intStep = intStep + 1
            End If
            If rsA.State <> adStateClosed Then rsA.Close
            Set rsA = Nothing
        '若案件進度檔有未發文的實體審查資料
        ElseIf "" & rsB("CP27").Value = "" Then
            strTxt(intStep) = "Update CaseProgress Set CP06=" & Val(strNP08) & ",CP07=" & Val(strNP09) & " Where " & ChgCaseprogress(pa(1) & pa(2) & pa(3) & pa(4)) & " And CP10='" & 實體審查 & "' And CP27 IS NULL "
            cnnConnection.Execute strTxt(intStep)
            intStep = intStep + 1
        End If
        If rsB.State <> adStateClosed Then rsB.Close
        Set rsB = Nothing
      End If
   End If
   '2005/9/13 END
   
   'Add by Morgan 2004/7/19
   For i = 1 To 5
      If Text7(i + 3).Text <> "" Then
         If txtAppID(i).Tag = "" And txtAppID(i).Text <> "" Then
            strTmp = Text7(i + 3).Text & "0000"
            'Modify by Amy 2022/05/18 避免統編存前後空白造成上傳發票錯誤,故個人或公司且國籍為台灣取代換行及空白
            strCU11 = txtAppID(i).Text
            If m_CU15(i) <= 1 And m_CU10(i) < "010" Then
                strCU11 = Trim(PUB_StringFilter(strCU11))
            End If
            strSql = "UPDATE CUSTOMER SET CU11='" & strCU11 & "' WHERE CU01='" & Left(strTmp, 8) & "' AND CU02 ='" & Mid(strTmp, 9, 1) & "'"
            'end 2022/05/18
            cnnConnection.Execute strSql
         End If
      End If
   Next
   
   'Add by Morgan 2006/5/3
   '被主張國內優先權的案子若有掛實審期限應予以解除
   If Text7(2) = "121" Then
      'Modify by Morgan 2009/6/4 +主張多個國內優先權
      arrPriority1 = Split(strPriority(1), "，")
      arrPriority2 = Split(strPriority(2), "，")
      arrPriority3 = Split(strPriority(3), "，")
      For i = LBound(arrPriority1) To UBound(arrPriority1)
         strSql = "update nextprogress set np06='N',np11=to_char(sysdate,'yyyymmdd'),np12='88'" & _
            " where np06 is null and np07='416' and (np02,np03,np04,np05) in (select pa01,pa02,pa03,pa04 from  patent where pa09='" & arrPriority1(i) & "' and pa10=" & arrPriority2(i) & " and pa11='" & arrPriority3(i) & "')"
         cnnConnection.Execute strSql, intI
         
         'Added by Morgan 2022/10/31 催審、通知實審日也要解除 111/8/19請作單--陳玲玲
         strSql = "update nextprogress set np06='N',np11=to_char(sysdate,'yyyymmdd'),np12='88'" & _
            " where np06 is null and np07 in ('" & 催審 & "','" & 通知實審日 & "') and (np01,np02,np03,np04,np05) in (select cp09,pa01,pa02,pa03,pa04 from patent,caseprogress where pa09='" & arrPriority1(i) & "' and pa10=" & arrPriority2(i) & " and pa11='" & arrPriority3(i) & "' and cp01(+)=pa01 and cp02(+)=pa02 and cp03(+)=pa03 and cp04(+)=pa04 and cp10 in ('101','102'))"
         cnnConnection.Execute strSql, intI
         'end 2022/10/31
      Next
      'end 2009/6/4
   End If
   '2006/5/3 end
   
   'Add by Morgan 2007/12/31 非PCT案之國際優先權發文若證明文件未送時自動收文補文件(優先權證明)
   'Modified by Morgan 2012/7/2 +回復優先權主張124
   If (Text7(2) = "106" Or Text7(2) = "124") And Text7(13) = "N" And pa(46) = "" Then
      'strExc(7) = cp(14) 'Removed by Morgan 2015/7/7 改依申請國家個別抓設定
      '台灣
      If pa(9) = "000" Then
         'Added by Morgan 2025/1/24
         If strSrvDate(1) >= P業務區劃分啟用日 Then
            strExc(7) = PUB_GetPHandler(pa(1) & pa(2) & pa(3) & pa(4))
         Else
         'end 2025/1/24
            strExc(7) = Pub_GetSpecMan("AB202") 'Added by Morgan 2015/7/7 改抓臺灣案補文件承辦人特殊特定AB202 --玲玲
         End If 'Added by Morgan 2025/1/24
         '法限=送件日+4個月
         strExc(1) = CompDate(1, 4, Text7(0))
         'Added by Morgan 2012/7/10 102新法
         If DBDATE(strExc(1)) > 20130000 Then
            strExc(5) = ""
            strExc(3) = PUB_GetFirstPriDate(pa, strExc(4))
            If strExc(3) <> "" Then
               If pa(8) = "3" Or strExc(4) = "2" Then
                  strExc(5) = CompDate(1, 10, strExc(3))
               Else
                  strExc(5) = CompDate(1, 16, strExc(3))
               End If
            End If
            If Val(strExc(5)) >= 20130101 Then
               strExc(1) = strExc(5)
            End If
         End If
         'end 2012/7/10
         'Added by Lydia 2025/10/29
         stNP23 = ""
         If strSrvDate(1) >= 內專本所約定期限啟用日 Then
            strExc(2) = PUB_GetPOurDeadline(strExc(1), pa(9), stNP23, pa(1), "232")
         Else
         'end 2025/10/29
            'Added by Morgan 2014/10/28
            If pa(9) = 台灣國家代號 And strSrvDate(1) >= 台灣案所限新規則啟用日 Then
               strExc(2) = PUB_GetOurDeadline(strExc(1))
            Else
            'end 2014/10/28
               '所限=法限-4天
               strExc(2) = PUB_GetWorkDay1(CompDate(2, -4, strExc(1)), True)
            End If 'Added by Morgan 2014/10/28
         End If 'Added by Lydia 2025/10/29
      '其他
      Else
         'Added by Morgan 2025/1/24
         If strSrvDate(1) >= P業務區劃分啟用日 Then
            strExc(7) = PUB_GetPHandler(pa(1) & pa(2) & pa(3) & pa(4))
         Else
         'end 2025/1/24
            strExc(7) = Pub_GetSpecMan("G") 'Added by Morgan 2014/2/26 承辦人改抓特殊特定G --玲玲
         End If 'Added by Morgan 2025/1/24
         
         '法限=送件日+3個月
         'Modified by Morgan 2021/5/28 2021/6/1以後發文主張國際優先權，補優先權證明期限改設定為最早優先權日起16個月
         'Modified by Morgan 2021/6/2 限發明和新型
         If Text7(2) = "106" And DBDATE(Text7(0)) > "20210601" And (pa(8) = "1" Or pa(8) = "2") Then
            strExc(3) = PUB_GetFirstPriDate(pa)
            strExc(1) = CompDate(1, 16, strExc(3))
         Else
         'end 2021/5/28
            strExc(1) = CompDate(1, 3, Text7(0))
         End If
         'Added by Lydia 2025/10/29
         stNP23 = ""
         If m_bolFMP = False And strSrvDate(1) >= 內專本所約定期限啟用日 Then
            strExc(2) = PUB_GetPOurDeadline(strExc(1), pa(9), stNP23, pa(1), "232")
         Else
         'end 2025/10/29
            '所限=法限-10天
            strExc(2) = PUB_GetWorkDay1(CompDate(2, -10, strExc(1)), True)
         End If 'Added by Lydia 2025/10/29
      End If
      'Modify by Morgan 2009/12/17 改掛下一程序
      '2010/2/11 MODIFY BY SONIA 大陸案才改下一程序,台灣案維持進度檔P-093797
      'Modify by Morgan 2010/12/21 只留FMP案掛下一程序 --99.12.2請作單
      'If pa(9) = "000" Then
      'Modified by Morgan 2012/7/5 案件性質改用232補優先權證明(原用202補文件)
      If Not m_bolFMP Then
         strSql = "INSERT INTO CASEPROGRESS (CP01,CP02,CP03,CP04,CP09," & _
            "CP10,CP20,CP26,CP32,CP11,CP05,CP06,CP07,CP12,CP13,CP14,CP43,CP64) VALUES ('" & pa(1) & "','" & pa(2) & "'" & _
            ",'" & pa(3) & "','" & pa(4) & "','" & AutoNo("B", 6) & "','232'" & _
            ",'N','N','N','90'," & strSrvDate(1) & "," & CNULL(strExc(2)) & "," & CNULL(strExc(1)) & ",'" & cp(12) & _
            "','" & cp(13) & "','" & strExc(7) & "','" & cp(9) & "','優先權證明')"
      Else
         'Modified by Lydia 2025/10/29 +NP23
         strSql = "INSERT INTO NEXTPROGRESS(NP01,NP02,NP03,NP04,NP05,NP07,NP08,NP09,NP10,NP15,NP22,NP23)" & _
            " VALUES ('" & cp(9) & "','" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & "','232'" & _
            "," & CNULL(strExc(2), True) & "," & CNULL(strExc(1), True) & ",'" & cp(13) & "'" & _
            ",'優先權證明',GETNP22, " & CNULL(stNP23, True) & " )"
      End If
      
      
      cnnConnection.Execute strSql, intI
   End If
   'end 2007/12/31
         
   'Add by Morgan 2006/9/11
   '大陸一案兩請，若申請日為95.7.1以後則新型放棄專利權發文時，自動上閉卷
   If m_DualCase429 = True Then
      'Added by Lydia 2016/09/29 發明案的陳述意見做內部收文放棄專利權(429)時,符合新型案自動閉卷 'Memo by Lydia 2022/06/29 (2017/11/09) 若智權同仁自行收文A類放棄專利權429,請一併上發文日
      If m_DualCase429B = True Then
         strSql = "UPDATE PATENT SET PA57='Y',PA58=" & strSrvDate(1) & ",PA59='09', PA91=PA91||'" & m_DualCase429Memo & "' WHERE PA01='" & m_DualCaseNo(1) & "' AND PA02='" & m_DualCaseNo(2) & "' AND PA03='" & m_DualCaseNo(3) & "' AND PA04='" & m_DualCaseNo(4) & "' AND PA57 IS NULL"
      Else
      'end 2016/09/29
         strSql = "UPDATE PATENT SET PA57='Y',PA58=" & strSrvDate(1) & ",PA59='09', PA91=PA91||'" & m_DualCase429Memo & "' WHERE PA01='" & pa(1) & "' AND PA02='" & pa(2) & "' AND PA03='" & pa(3) & "' AND PA04='" & pa(4) & "' AND PA57 IS NULL"
      End If
      
      cnnConnection.Execute strSql, intI
   End If
   
   'Add by Morgan 2007/1/17 香港短期專利發文時掛2個月回覆代理人期限
   If pa(9) = "013" And Text7(2) = "112" Then
   'Add by Morgan 2009/10/1
   '香港短期專利發文時更新B類補文件的代理人
      strSql = "update caseprogress a set cp44='" & cp(44) & "' where cp01='" & cp(1) & "' and cp02='" & cp(2) & "'" & _
         " and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10='202' and cp09>'B' and cp27 is null" & _
         " and exists(select * from caseprogress b where b.cp09=a.cp43 and b.cp10='421')"
      cnnConnection.Execute strSql, intI
   End If
   '香港申請檢索報告發文時掛2個月的補文件期限 (若短期專利已發文則與該程序設相同代理人)
   If pa(9) = "013" And Text7(2) = "421" Then
   'end 2009/10/1
   
      ReDim Ncp(1 To TF_CP)
      
'Remove by Morgan 2009/10/1
'      strExc(0) = "select cp09 from caseprogress c1 where cp43='" & cp(9) & "' and cp10='902'"
'      intI = 1
'      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
'      If intI = 1 Then
'         Ncp(9) = RsTemp.Fields(0)
'      'edit by nickc 2007/02/02 不用 dll 了
'      'ElseIf objPublicData.GetAutoNumber("B", Ncp(9), True, True) Then
'      ElseIf ClsPDGetAutoNumber("B", Ncp(9), True, True) Then
'         Ncp(9) = "B" & Right(DBYEAR(strSrvDate(1)) - 1911, 2) & Ncp(9)
'      Else
'         GoTo ErrorHandler
'      End If
'end 2009/10/1
      
      Ncp(1) = cp(1)
      Ncp(2) = cp(2)
      Ncp(3) = cp(3)
      Ncp(4) = cp(4)
      Ncp(5) = strSrvDate(1)
      Ncp(6) = CompDate(1, 2, strSrvDate(1)) '所限
      Ncp(7) = CompDate(1, 2, strSrvDate(1)) '法限
      If ClsPDGetAutoNumber("B", Ncp(9), True, True) Then
         'Modify By Sindy 2010/8/18 比對自動編號年度
         'Ncp(9) = "B" & Right(strSrvDate(2) \ 10000, 2) & Ncp(9)
         Ncp(9) = "B" & CompAutoNumberYear(CStr(Val(Mid(strSrvDate(1), 1, 4)) - 1911)) & Ncp(9)
      Else
         GoTo ErrorHandler
      End If
      'Modify by Morgan 2009/10/1
      'Ncp(10) = "902"
      Ncp(10) = "202"
      'end 2009/10/1
      Ncp(11) = "90"
      Ncp(12) = cp(12)
      Ncp(13) = cp(13)
      Ncp(14) = strUserNum
      Ncp(20) = "N"
      Ncp(26) = "N"
      Ncp(32) = "N"
      Ncp(43) = cp(9)
      'Modify by Morgan 2009/10/1
      'Ncp(44) = cp(44)
      strExc(0) = "select cp44 from caseprogress where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10='112' and cp27>0"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         Ncp(44) = "" & RsTemp(0)
      End If
      'end 2009/10/1
      Ncp(45) = cp(45)
      Ncp(116) = cp(116)
      If PUB_AddNewCaseProgress(Ncp) = False Then GoTo ErrorHandler
   End If
   'end 2007/1/17
   
   'Add by Morgan 2007/10/22
   '96/11/1起若無代表圖則檢查國內是否有，有則複製否則發Mail通知郭雅娟
   m_NoPicMailSub = ""
   'Modified by Morgan 2012/4/26 +排除 FMP 案
   If Val(strSrvDate(1)) >= 20071101 And InStr(CaseMapIn, Text7(2)) > 0 And Not m_bolFMP Then
      '檢查是否已有代表圖
      'Modify by Amy 2018/07/23 改寫至function for 彩色代表圖
'      strSql = "select 1 from imgbytefile where ibf01='" & pa(1) & "' and ibf02='" & pa(2) & "' and ibf03='" & pa(3) & "' and ibf04='" & pa(4) & "' and ibf05='1'"
'      intI = 1
'      Set RsTemp = ClsLawReadRstMsg(intI, strSql)
      '無圖時,再檢查是否有國內案
      'If intI <> 1 Then
      If ChkImgByteFile(pa(1), pa(2), pa(3), pa(4)) = False Then
      'end 2018/07/23
         'Modify by Morgan +香港大陸案也要--郭雅娟
         'Add by Morgan 2008/11/19 +分割案抓母案
         If Text7(2) = "307" Then
            'Modify by Amy 2018/07/23 拿掉and ibf05(+)='1' for 彩色代表圖
            strSql = "select dc05,dc06,dc07,dc08,ibf01 from divisioncase,imgbytefile" & _
               " where dc01='" & pa(1) & "' and dc02='" & pa(2) & "' and dc03='" & pa(3) & "' and dc04='" & pa(4) & "' and ibf01(+)=dc05 and ibf02(+)=dc06 and ibf03(+)=dc07 and ibf04(+)=dc08 "
         Else
         'end 2008/11/19
            'Modified by Morgan 2012/5/25 一案兩請的圖也一樣--張瓊玉,郭雅娟
            'Modified by Morgan 2012/7/2 一案兩請先後順序不一定都要考慮
            'Modify by Amy 2018/07/23 拿掉and ibf05(+)='1' for 彩色代表圖
            strSql = "select cm05,cm06,cm07,cm08,ibf01" & _
               " from (select cm05,cm06,cm07,cm08 from casemap where cm01='" & pa(1) & "' and cm02='" & pa(2) & "' and cm03='" & pa(3) & "' and cm04='" & pa(4) & "' and cm10 in ('0','4','3')" & _
               " union select cm01,cm02,cm03,cm04 from casemap where cm05='" & pa(1) & "' and cm06='" & pa(2) & "' and cm07='" & pa(3) & "' and cm08='" & pa(4) & "' and cm10='3'" & _
               "),imgbytefile where ibf01(+)=cm05 and ibf02(+)=cm06 and ibf03(+)=cm07 and ibf04(+)=cm08 order by ibf01"
         End If
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strSql)
         If intI = 1 Then
            With RsTemp
            strCN(1) = .Fields(0)
            strCN(2) = .Fields(1)
            strCN(3) = .Fields(2)
            strCN(4) = .Fields(3)
            If IsNull(.Fields("ibf01")) Then
               'Add by Morgan 2008/11/19 +分割案抓母案
               If Text7(2) = "307" Then
                  m_NoPicMailSub = "分割案【" & pa(1) & pa(2) & pa(3) & pa(4) & "】已發文但尚缺代表圖且母案【" & strCN(1) & strCN(2) & strCN(3) & strCN(4) & "】亦無代表圖！"
               Else
               'end 2008/11/19
                  m_NoPicMailSub = "【" & pa(1) & pa(2) & pa(3) & pa(4) & "】已發文但尚缺代表圖且相關國內案【" & strCN(1) & strCN(2) & strCN(3) & strCN(4) & "】亦無代表圖！"
               End If
            Else
               If PUB_CopyImgFile(strCN, pa) = False Then
                  GoTo ErrorHandler
               End If
            End If
            End With
         '無國內案則發Mail
         Else
            m_NoPicMailSub = "【" & pa(1) & pa(2) & pa(3) & pa(4) & "】已發文但尚缺代表圖！"
         End If
      End If
   End If
   'end 2007/10/22
   
'Remove by Morgan 2009/11/11 改執行補件期限畫面存檔
'   '2008/11/21 ADD BY SONIA 非台灣之新申請案若撰寫指示信時進度檔有掛B類補文件期限,則以發文日+1個月更新該筆補文件本所期限,法定=本所+10天
'   If pa(9) <> "000" And InStr(CaseMapIn, Text7(2)) > 0 Then
'      '2009/6/26 MODIFY BY SONIA 改為發文日+2個月更新該筆補文件本所期限
'      strExc(1) = PUB_GetWorkDay1(CompDate(1, 2, TransDate(Text7(0), 2)), True)
'      strSQL = "Update CaseProgress Set CP06=" & strExc(1) & ",CP07=" & CompDate(2, 10, strExc(1)) & " Where " & ChgCaseprogress(pa(1) & pa(2) & pa(3) & pa(4)) & " and cp09>'B' And CP10='" & 補文件 & "' And CP27 IS NULL and cp57 is null AND CP43='" & cp(9) & "'"
'      cnnConnection.Execute strSQL
'   End If
'   '2008/11/21 END
'end 2009/11/11
   
'Modify by Amy 2014/09/09 for 台灣案電子化
If P台灣案電子化啟用日 <= Val(strSrvDate(1)) Then
   'Modified by Morgan 2016/3/17 C類也可發文
   'If pa(1) = "P" And cp(9) < "C" And pa(9) = 台灣國家代號 Then
   'Modified by Morgan 2019/3/29 +PS
   If pa(1) = "PS" Or (pa(1) = "P" And pa(9) = 台灣國家代號) Then
   
      'C類來函發文由工程師跑歷程判發,信函進度則自行判發即可(目前只有舉發、舉發答辯的審定函)
      If cp(9) > "C" Then
         strExc(1) = PUB_SetLP11(pa(26), pa(75), strExc(2))
         If bolPost Then
            'Modified by Morgan 2016/11/2 不必考慮原來是否有定稿 Ex.P-114218 (承辦人由程序改工程師)
            'strSql = "update letterprogress set lp04=null,lp05=" & strSrvDate(1) & ",lp08='" & cp(14) & "',lp09=" & strSrvDate(1) & ",lp10='Y',lp11='" & strExc(1) & "',LP31='" & strExc(2) & "' where lp01='" & strReceiveNo & "' and lp10 is null"
            'Modified by Morgan 2022/4/21 +LP52='Y'
            strSql = "update letterprogress set lp04=null,lp05=" & strSrvDate(1) & ",lp08='" & cp(14) & "',lp09=" & strSrvDate(1) & ",lp10='Y',lp11='" & strExc(1) & "',LP31='" & strExc(2) & "',LP52='Y' where lp01='" & strReceiveNo & "'"
            'end 2016/11/2
            cnnConnection.Execute strSql, intI
            
            'Added by Morgan 2022/4/21
            '掛號直寄若為E化案件(非全E)，已上發文室發文(QPGMR)要清除
            'Modified by Morgan 2022/11/11
            'If strExc(1) = "Y" Then
            '   strSql = "update caseprogress set cp154=null,cp127=null,cp128=null where cp09='" & strReceiveNo & "' and cp154='QPGMR' and exists(select * from letterprogress where lp01=cp09 and lp26='Y')"
            '   cnnConnection.Execute strSql, intI
            'End If
            PUB_ECaseAuotPost strReceiveNo, pa(1)
            'end 2022/11/11
            'end 2022/4/21
         Else
            If Text7(0) = "111111" Then
               strExc(0) = "不通知客戶;"
            Else
               strExc(0) = "不寄紙本通知函給客戶;"
            End If
            strSql = "update letterprogress set lp04=null,lp05=decode(lp03,0,0," & strSrvDate(1) & "),lp06='" & strUserNum & "',lp07=" & strSrvDate(1) & ",lp08='" & cp(14) & "',lp09=" & strSrvDate(1) & ",lp10='N',lp11='" & strExc(1) & "',lp12='" & strExc(0) & "',LP31='" & strExc(2) & "' where lp01='" & strReceiveNo & "'"
            cnnConnection.Execute strSql, intI
         End If
      Else
   'end 2016/3/17
      
        cnnConnection.Execute "delete LetterProgress where lp01='" & strReceiveNo & "'", intI 'Added by Morgan 2016/2/26 可能會重新發文
        '*沒出客戶通知函
        If Text7(21) = "N" Then
            'Added by Morgan 2015/2/10
            '分析沒有系統定稿但要通知客戶(工程師用撰寫信函寫)
            'Modified by Morgan 2016/8/1 +903專利調查,927其他翻譯--玲玲 Ex:P-115116
            'Modified by Morgan 2018/12/10 改規則與CFP相同(AB類都詢問1.是否寄通知函 2.通知函是否掛號)
            'If Text7(2) = "941" Or Text7(2) = "903" Or Text7(2) = "927" Then
            '   'Modified by Morgan 2015/7/8 A類分析函是否寄發讓User選擇
            '   'If Not bolAuto941Case Then
            '   If bolAuto941Case = False And bolNoPost = False Then
            '   'end 2015/7/8
            If bolPost Then
            'end 2018/12/10
                  'Modified by Morgan 2018/8/1
                  'strExc(1) = PUB_GetLetterJudge(pa(1), cp(10), , , pa(1), pa(2), pa(3), pa(4))
                  strExc(1) = PUB_GetLetterJudgeNew("1", pa(1), cp(10))
                  'Modified by Morgan 2015/2/11 跑掛號流程
                  'Modified by Morgan 2016/12/22 只有分析直寄(因為有會稿)--陳玲玲 Ex.P116072 專利調查要給業務確認
                  'PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), True, pa(26), cp(10), pa(75), False
                  'Modified by Morgan 2018/12/10
                  'PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), IIf(Text7(2) = "941", True, False), pa(26), cp(10), pa(75), False
                  PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), bolRegMail, pa(26), cp(10), pa(75), False
                  'end 2018/12/10
                  'end 2016/12/22
                  'Added by Morgan 2015/5/19
                  strSql = "update letterprogress set lp08='工程師撰寫',lp09=" & strSrvDate(1) & " where lp01='" & strReceiveNo & "'"
                  cnnConnection.Execute strSql, intI
                  'end 2015/5/19
                  
                  'Added by Morgan 2015/3/17
                  If LCase(strNewFileName) <> LCase(strOldFileName) Then
                     strSql = "update casepaperpdf set cpp02='" & ChgSQL(strNewFileName) & "'  where cpp01='" & cp(9) & "' and cpp02='" & ChgSQL(strOldFileName) & "'"
                     cnnConnection.Execute strSql, intI
                  End If
                  'end 2015/3/17
                  
               'End If 'Removed by Morgan 2018/12/10
            Else
            'end 2015/2/10
   
               'Morgan 2015/1/9 原判需新增LetterProgress
                 '1.要計件2.(發文規費>0或非電子送件)且非新案及改請 3.同一天 沒有其他有規費的發文
               'Modify by Amy 2015/02/13 修改、整理判斷條件
                 '1.非新案、非改請且電子送件且規費>0,有收據
                 '2.非新案、非改請非電子送件且經發文室要計件,有回執
               'Modify by Amy 2015/03/06 修改判斷條件
                 '1.非新案、非改請且電子送件且規費>0且同一日無新案改請程序發文,有收據
                 '2.非新案、非改請非電子送件且經發文室要計件,有回執
               'Mark by Amy 2015/03/06 回執改至PUB_UpdateLP19做
'               If Not (InStr(NewCasePtyList, Text7(2)) > 0 Or Left(Text7(2), 1) = "3") Then
'                  strExc(1) = PUB_GetLetterJudge(pa(1), cp(10))
'                  If txtCP118 = "Y" Then
'                     If Val(txtCP84) > 0 Then
'                        PUB_AddLetterProgress strReceiveNo, 1, False, strExc(1), False, pa(26), cp(10), pa(75), True
'                     End If
'                  Else
'                     If Left(m_CP123s, 1) = "Y" Then
'                        PUB_AddLetterProgress strReceiveNo, 1, False, strExc(1), False, pa(26), cp(10), pa(75), True
'                     End If
'                  End If
'               End If
'               'end 2015/02/13
               
            End If 'Added by Morgan 2015/2/10
            
        '*有出客戶通知函
        Else
            'Modified by Morgan 2018/8/1
            'strExc(1) = PUB_GetLetterJudge(pa(1), cp(10), , , pa(1), pa(2), pa(3), pa(4))
            strExc(1) = PUB_GetLetterJudgeNew("1", pa(1), cp(10))
            
            'Modified by Morgan 2015/2/5
            '1.有規費的都有收據
            '2.無規費時電子送的無回執,紙本的要計件的才有回執(申請書)
            'Mark by Amy 2015/03/06 回執改至PUB_UpdateLP19做
'            If Val(txtCP84) > 0 Then
'               PUB_AddLetterProgress strReceiveNo, 1, True, strExc(1), False, pa(26), cp(10), pa(75), True
'            ElseIf txtCP118 = "Y" Then
'                PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), False, pa(26), cp(10), pa(75), False
'            Else
'                'Modified by Morgan 2015/1/9 +判斷要計件的才有收據/回執
'                'Modified by Morgan 2015/2/4 沒有收據/回執時,檔案數要設 0
'               'PUB_AddLetterProgress strReceiveNo, 1, True, strExc(1), False, pa(26), cp(10), pa(75), True
               PUB_AddLetterProgress strReceiveNo, IIf(Left(m_CP123s, 1) = "Y", 1, 0), True, strExc(1), False, pa(26), cp(10), pa(75), IIf(Left(m_CP123s, 1) = "Y", True, False)
'               'end 2015/1/9
'            End If
'            'end 2015/2/5
            'end 2015/03/06
        End If
        '*有申請書
        If Text7(9) <> "N" Then
            If ExistCheck("AppForm", "AF01", strReceiveNo, "", False) = False Then
                 '新增申請書轉檔記錄
                 PUB_AddAppForm strReceiveNo
            End If
        End If
      End If 'Added by Morgan 2016/3/17
   
   'Added by Morgan 2016/5/11
   '指示信電子化
   ElseIf pa(9) <> 台灣國家代號 And Left(Pub_StrUserSt03, 1) <> "F" Then
      If Text7(25) <> "N" Then
         m_Subject = "請代為提出" & Label3(5) & "申請" & IIf(cp(45) <> "", " Y/R:" & cp(45) & ";", "") & " O/R:" & cp(1) & "-" & cp(2) & IIf(cp(3) & cp(4) = "000", "", "-" & cp(3) & "-" & cp(4))
         'Modified by Morgan 2016/12/13 若已有指示信表示有異常(Ex.P100930)
         'If ExistCheck("AppForm", "AF01", strReceiveNo, "", False) = False Then
         If ExistCheck("AppForm", "AF01", strReceiveNo, "", False) Then
            Err.Raise 999, , "指示信記錄(Appform)已存在，若為之前有誤操作請通知電腦中心刪除該筆記錄！"
         Else
         'end 2016/12/13
            'Modified by Morgan 2017/3/6 436申請優先權DAS的指示信要判發--潘韻丞
            'Modified by Morgan 2018/7/30 指示信判發人改抓設定檔
            strExc(2) = PUB_GetLetterJudgeNew("2", pa(1), cp(10), pa(9))
            'Modified by Morgan 2025/5/19 +423申請專利權評價報告(改都抓設定)--郭
            'If cp(10) = "436" Then
            '   'strExc(2) = Pub_GetSpecMan("PS4")
            '   PUB_AddAppForm strReceiveNo, True, Pub_GetSpecMan("PS4"), m_Subject
            'Else
            '   'strExc(2) = strUserNum
            '   PUB_AddAppForm strReceiveNo, True, strExc(2), m_Subject '不轉檔,自行判發
            'End If
            PUB_AddAppForm strReceiveNo, True, strExc(2), m_Subject '不轉檔,自行判發
            'end 2025/5/19
            'end 2017/3/6
         End If
      End If
   'end 2016/5/11
   
      'Added by Morgan 2016/6/22
      '客戶通知函
      If 內專全面電子化啟用日 <= Val(strSrvDate(1)) Then
         'Modify By Sindy 2016/7/12
         'If Text7(21) <> "N" Then
         'C類來函發文由工程師跑歷程判發,信函進度則自行判發即可(目前只有舉發、舉發答辯的審定函)
         If cp(9) > "C" Then
            'Modified by Morgan 2016/7/20 FMP除外
            If Not m_bolFMP Then
               'Added by Morgan 2020/1/17 配合有客戶大陸案要有公文正本才發文(有通知函,程序承辦,非掛號)
               If PUB_GetST03(cp(14)) = "P12" Then
                  '已自行判發的要更新判發日期時間--玲玲
                  strSql = "update letterprogress set lp05=to_number(to_char(sysdate,'YYYYMMDD')),lp17=to_number(to_char(sysdate,'HH24MISS')) where lp01='" & strReceiveNo & "' and lp04 is null and lp05>0"
                  cnnConnection.Execute strSql, intI
               Else
               'end 2020/1/17
               
                  'Modified by Morgan 2016/8/31
                  '1209檢索報告,1008 核發-申請技術報告/申請評價報告 不用掛號
                  strExc(2) = ""
                  If cp(10) = "1209" Or cp(10) = "1008" Then
                     strExc(1) = ""
                  Else
                     strExc(1) = PUB_SetLP11(pa(26), pa(75), strExc(2))
                  End If
                  If bolPost Then
                     'Modified by Morgan 2018/10/4 不必管是否原來有定稿都要更新--Ex:P-116275
                     strSql = "update letterprogress set lp04=null,lp05=" & strSrvDate(1) & ",lp08='" & cp(14) & "',lp09=" & strSrvDate(1) & ",lp10='Y',lp11='" & strExc(1) & "',LP31='" & strExc(2) & "' where lp01='" & strReceiveNo & "'"
                     cnnConnection.Execute strSql, intI
                     
                     PUB_ECaseAuotPost strReceiveNo, pa(1) 'Added by Morgan 2022/11/11
                  Else
                     If Text7(0) = "111111" Then
                        strExc(0) = "不通知客戶;"
                     Else
                        strExc(0) = "不寄紙本通知函給客戶;"
                     End If
                     strSql = "update letterprogress set lp04=null,lp05=decode(lp03,0,0," & strSrvDate(1) & "),lp06='" & strUserNum & "',lp07=" & strSrvDate(1) & ",lp08='" & cp(14) & "',lp09=" & strSrvDate(1) & ",lp10='N',lp11='" & strExc(1) & "',lp12='" & strExc(0) & "',LP31='" & strExc(2) & "' where lp01='" & strReceiveNo & "'"
                     cnnConnection.Execute strSql, intI
                  End If
               End If 'Added by Morgan 2020/1/17
            End If
            'end 2016/7/20
         Else
            cnnConnection.Execute "delete LetterProgress where lp01='" & strReceiveNo & "'", intI 'Added by Morgan 2016/2/26 可能會重新發文
            '*沒出客戶通知函
            If Text7(21) = "N" Then
               'Added by Morgan 2015/2/10
               '分析沒有系統定稿但要通知客戶(工程師用撰寫信函寫)
               'Modified by Morgan 2016/8/1 +903專利調查,927其他翻譯--玲玲 ExP-115116
               'Modified by Morgan 2018/11/7 +956報告客戶 --玲玲 Ex:P-92596
               'Modified by Morgan 2018/12/10 改規則與CFP相同(AB類都詢問1.是否寄通知函 2.通知函是否掛號)
               'If Text7(2) = "941" Or Text7(2) = "903" Or Text7(2) = "927" Or Text7(2) = "956" Then
               '   'Modified by Morgan 2015/7/8 A類分析函是否寄發讓User選擇
               '   'If Not bolAuto941Case Then
               '   If bolAuto941Case = False And bolNoPost = False Then
               If bolPost Then
               
                  'end 2015/7/8
                     'Modified by Morgan 2018/8/1
                     'strExc(1) = PUB_GetLetterJudge(pa(1), cp(10), , , pa(1), pa(2), pa(3), pa(4))
                     strExc(1) = PUB_GetLetterJudgeNew("1", pa(1), cp(10), pa(9), , , m_bolFMP)
                     'Modified by Morgan 2015/2/11 跑掛號流程
                     'Modified by Morgan 2016/12/22 只有分析直寄(因為有會稿)--陳玲玲 Ex.P116072 專利調查要給業務確認
                     'PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), True, pa(26), cp(10), pa(75), False
                     'Modified by Morgan 2018/12/10
                     'PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), IIf(Text7(2) = "941", True, False), pa(26), cp(10), pa(75), False
                     PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), bolRegMail, pa(26), cp(10), pa(75), False
                     'end 2018/12/10
                     'end 2016/12/22
                     'Added by Morgan 2015/5/19
                     strSql = "update letterprogress set lp08='工程師撰寫',lp09=" & strSrvDate(1) & " where lp01='" & strReceiveNo & "'"
                     cnnConnection.Execute strSql, intI
                     'end 2015/5/19
                     
                     'Added by Morgan 2015/3/17
                     If LCase(strNewFileName) <> LCase(strOldFileName) Then
                        strSql = "update casepaperpdf set cpp02='" & ChgSQL(strNewFileName) & "'  where cpp01='" & cp(9) & "' and cpp02='" & ChgSQL(strOldFileName) & "'"
                        cnnConnection.Execute strSql, intI
                     End If
                     'end 2015/3/17
                  End If
               'End If 'Removed by Morgan 2018/12/10
            Else
         '2016/7/12 END
               'Modified by Morgan 2018/8/1
               'strExc(1) = PUB_GetLetterJudge(pa(1), cp(10), , pa(9), pa(1), pa(2), pa(3), pa(4))
               strExc(1) = PUB_GetLetterJudgeNew("1", pa(1), cp(10), pa(9), , , m_bolFMP)
               PUB_AddLetterProgress strReceiveNo, 0, True, strExc(1), False, pa(26), cp(10), pa(75)
            End If
         End If
      End If
      'end 2016/6/22
   End If
End If
'end 2014/09/09

   'Add by Morgan 2009/3/23
   If pa(9) = "000" Then
      PUB_UpdateDispatch m_CP09s, m_CP123s, m_CP130
      'Add by Amy 2015/02/13 更新收據/回執設定
      'Modify by Amy 2015/03/06 +發文日參數
      PUB_UpdateLP19 cp(1), cp(2), cp(3), cp(4), m_CP09s, m_CP123s, Text7(0)
   End If
   
   'Add by Morgan 2009/7/16 大陸分割案期限控管
   If Text7(2).Text = "307" And pa(9) = "020" Then
      st307Msg = PUB_Update307Ref(cp(9))
   End If
   
   'Add by Morgan 2009/11/13
   '新增順稿期限
   If pa(9) <> "000" And Check1.Value = 1 And txtDate <> "" Then
      strExc(2) = DBDATE(txtDate)
      strSql = "update nextprogress set np08=" & strExc(2) & ",np09=" & strExc(2) & _
         " where np01='" & cp(9) & "' and np06 is null and np07='994'"
      cnnConnection.Execute strSql, intI
      If intI = 0 Then
         strExc(1) = Pub_GetSpecMan("G") '順稿管制人
         strSql = "insert into nextprogress(NP01,NP02,NP03,NP04,NP05,NP07,NP08,NP09,NP10,NP22)" & _
            " SELECT '" & cp(9) & "','" & cp(1) & "','" & cp(2) & "','" & cp(3) & "','" & cp(4) & _
            "','994'," & strExc(2) & "," & strExc(2) & ",'" & strExc(1) & "',NP22" & _
            " FROM (SELECT NVL(MAX(NP22),0)+1 NP22 FROM NEXTPROGRESS) X"
         cnnConnection.Execute strSql, intI
      End If
   End If
   
   'FMP案 C類通知補正發文日上11/11/11時，自動內部收文補正，同時更新下一程序補正為續辦。
   If m_bolFMP And Text7(2) = "1201" And Text7(0) = "111111" Then
      strExc(1) = AutoNo("B", 6)
      strSql = "INSERT INTO CASEPROGRESS (CP01,CP02,CP03,CP04,CP05,CP06,CP07" & _
         ",CP09,CP10,CP11,CP12,CP13,CP14,CP20,CP26,CP32,CP43) " & _
         "select cp01,cp02,cp03,cp04,to_char(sysdate,'yyyymmdd'),cp06,cp07" & _
         ",'" & strExc(1) & "','204','90','" & stCP12 & "','" & stCP13 & "',cp14,'N','N','N',cp09" & _
         " from caseprogress where cp09='" & cp(9) & "'"
      cnnConnection.Execute strSql, intI
               
      strSql = "update Nextprogress set np06='Y' where np01='" & cp(9) & "' and np06 is null and np07='204'"
      cnnConnection.Execute strSql, intI
   End If
   'end 2009/11/13
   
   'Add by Morgan 2009/12/11
   '大陸口頭審理上發文日時,自動形成一道告知代理人之內部收文,承辦人為口審之承辦人,本所期限設定為口頭審理法定＋２週，不設定法定，進度備註註明：口頭審理報告。
   'Modified by Morgan 2024/10/30 +407請求電詢,發文日＋７日為本所期限
   If pa(9) = "020" And (Text7(2) = "408" Or Text7(2) = "407") Then
      If Text7(2) = "407" Then
         strExc(2) = PUB_GetWorkDay1(CompDate(2, 7, Text7(0)), True)
         strExc(3) = "電詢報告"
      Else
   'end 2024/10/30
         strExc(2) = PUB_GetWorkDay1(CompDate(2, 14, cp(7)), True) '本所期限
         strExc(3) = "口頭審理報告"
      End If
   
      strExc(1) = AutoNo("B", 6)
      'Modified by Morgan 2018/11/7 +改收 956 報告客戶(原為 901 告代)
      strSql = "INSERT INTO CASEPROGRESS (CP01,CP02,CP03,CP04,CP05,CP06" & _
         ",CP09,CP10,CP11,CP12,CP13,CP14,CP20,CP26,CP32,CP43,CP64) " & _
         " select cp01,cp02,cp03,cp04,to_char(sysdate,'yyyymmdd')," & CNULL(strExc(2), True) & _
         ",'" & strExc(1) & "','956','90','" & stCP12 & "','" & stCP13 & "',cp14,'N','N','N',cp09,'" & strExc(3) & "'" & _
         " from caseprogress where cp09='" & cp(9) & "'"
      cnnConnection.Execute strSql, intI
   End If
   
   'Add by Morgan 2010/1/21
   '退費要更新未退預繳年費的發文日
   If Text7(2) = "908" Then
      strSql = "update t99 set t14=" & DBDATE(Text7(0)) & " where t01='" & pa(1) & "'" & _
         " and t02='" & pa(2) & "' and t03='" & pa(3) & "' and t04='" & pa(4) & "' and t14 is null"
      cnnConnection.Execute strSql, intI
      
      'Add by Morgan 2011/6/17
      strSql = "update t100 set t14=" & DBDATE(Text7(0)) & " where t01='" & pa(1) & "'" & _
         " and t02='" & pa(2) & "' and t03='" & pa(3) & "' and t04='" & pa(4) & "' and t14 is null"
      cnnConnection.Execute strSql, ii
      
      'Add by Morgan 2010/4/14 進度備註+退費年度
      
      'Modify by Morgan 2011/6/17 +考慮T100
      'If intI = 1 Then
      '   strSQL = "update caseprogress set cp64=(select '退費年度:'||T09||'-'||T10||';'||cp64" & _
      '      " from t99 where t01='" & pa(1) & "' and t02='" & pa(2) & "' and t03='" & pa(3) & "'" & _
      '      " and t04='" & pa(4) & "') where cp09='" & cp(9) & "'"
      '   cnnConnection.Execute strSQL, intI
      'End If
      If ii = 1 Or intI = 1 Then
         PUB_ChkRefund pa(), , strExc(1), strExc(2), True, DBDATE(Text7(0))
         strSql = "update caseprogress set cp64='退費年度:" & strExc(1) & "-" & strExc(2) & ";'||cp64" & _
            " where cp09='" & cp(9) & "'"
         cnnConnection.Execute strSql, intI
      End If
      'end 2011/6/17
   End If
   
   PUB_944Inform cp(9) 'Add by Morgan 2011/7/27
   
   'Added by Morgan 2012/6/28 102新法
   If pa(9) = "000" Then
      '發明申請(101),申請寄存(108)發文,新增(更新)寄存證明(231)期限
      If m_bolCtrl231 = True Then
         strExc(2) = ""
         strExc(3) = PUB_GetFirstPriDate(pa)
         '法限=最早優先權日起16個月 或 申請案發文日+4個月
         If strExc(3) <> "" Then
            strExc(3) = CompDate(1, 16, strExc(3))
         ElseIf Text7(2) = "101" Then
            strExc(3) = CompDate(1, 4, Text7(0))
         End If
         
         If strExc(3) <> "" Then
            stDate(0) = ""
            stDate(1) = pa(1)
            stDate(2) = pa(9)
            stDate(3) = strExc(3)
            GetCtrlDT stDate
            '本所期限
            strExc(2) = PUB_GetWorkDay1(stDate(0), True)
         End If
         
         If m_st231CP09 <> "" Then
            If strExc(3) <> "" Then
               strSql = "Update CaseProgress Set CP06=" & CNULL(strExc(2), True) & ",CP07=" & CNULL(strExc(3), True) & " where cp09='" & m_st231CP09 & "' and cp27||cp57 is null"
               cnnConnection.Execute strSql, intI
            End If
         Else
            strExc(1) = AutoNo("B", 6)
            strSql = "INSERT INTO CASEPROGRESS (CP01,CP02,CP03,CP04,CP05,CP06,CP07" & _
               ",CP09,CP10,CP11,CP12,CP13,CP14,CP20,CP26,CP32,CP43) " & _
               " select cp01,cp02,cp03,cp04,to_char(sysdate,'yyyymmdd')," & CNULL(strExc(2), True) & "," & CNULL(strExc(3), True) & _
               ",'" & strExc(1) & "','231','90','" & stCP12 & "','" & stCP13 & "',cp14,'N','N','N',cp09" & _
               " from caseprogress where cp09='" & cp(9) & "'"
            cnnConnection.Execute strSql, intI
         End If
      End If
   End If
   'end 2012/6/28
   
   'Removed by Morgan 2013/10/2 取消,承辦單已電子化--瓊玉
   ''Added by Morgan 2012/8/6
   ''台灣新申請案發文Email提醒繪圖
   'If pa(9) = "000" And InStr(NewCasePtyList, Text7(2)) > 0 And cp(29) <> "" And cp(29) <> "99999" Then
   '   strExc(1) = pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4))
   '   strExc(2) = "台灣案 " & strExc(1) & " 已送件,請製作 PDF 檔圖式,存放至 Pat1/TEMP 資料夾"
   '   strExc(3) = "如旨"
   '   strExc(4) = ""
   '   '因分所無法透過檔案總管連結ftp故北所也不開放連結功能
   '   'If PUB_GetST06(cp(29)) = "1" Then
   '   '   '空白需用 &nbsp;
   '   '   strExc(3) = "<FONT size=3>請連結至&nbsp;<A href=""\\Pat1\TEMP"">Pat1/TEMP</A>存入送件版本 PDF 檔圖式</FONT>"
   '   '   strExc(4) = "Y"
   '   'End If
   '   strSql = "insert into mailcache(mc01,mc02,mc03,mc04,mc07,mc08,mc10)" & _
   '      " values('" & strUserNum & "','" & cp(29) & "',to_char(sysdate,'yyyymmdd'),to_char(sysdate,'hh24miss')" & _
   '      ",'" & strExc(2) & "','" & strExc(3) & "','" & strExc(4) & "')"
   '   cnnConnection.Execute strSql, intI
   'End If
   ''end 2012/8/6
   'end 2013/10/2
   
   'Added by Morgan 2012/10/23
   '香港標準專利批准紀錄請求發文要解除維持費期限
   If pa(9) = "013" And Text7(2) = "111" Then
      strSql = "update nextprogress set np06='N' where np02='" & pa(1) & "' and np03='" & pa(2) & "' and np04='" & pa(3) & "' and np05='" & pa(4) & "' and np06 is null and np07=" & 維持費 & " and np09>" & DBDATE(Text7(0))
      cnnConnection.Execute strSql, intI
   End If
   'end 2012/10/23
   
   'Add By Sindy 2014/7/4 台灣新申請案發文時,檢查是否有總委任書
'Modified by Morgan 2021/2/4 改到 TxtValidate 詢問
'   If InStr(NewCasePtyList, Text7(2)) > 0 And pa(9) = "000" Then
'      bolChkPA165IsY = True
'      If Trim(Text7(4)) <> "" Then
'         If PUB_ChkPA165IsY(Text7(4)) = True Then
'            If Trim(Text7(5)) <> "" Then
'               If PUB_ChkPA165IsY(Text7(5)) = True Then
'                  If Trim(Text7(6)) <> "" Then
'                     If PUB_ChkPA165IsY(Text7(6)) = True Then
'                        If Trim(Text7(7)) <> "" Then
'                           If PUB_ChkPA165IsY(Text7(7)) = True Then
'                              If Trim(Text7(8)) <> "" Then
'                                 If PUB_ChkPA165IsY(Text7(8)) = False Then
'                                    bolChkPA165IsY = False
'                                 End If
'                              End If
'                           Else
'                              bolChkPA165IsY = False
'                           End If
'                        End If
'                     Else
'                        bolChkPA165IsY = False
'                     End If
'                  End If
'               Else
'                  bolChkPA165IsY = False
'               End If
'            End If
'         Else
'            bolChkPA165IsY = False
'         End If
'      End If
'      If bolChkPA165IsY = False Then
'         If MsgBox("是否要設定為總委任書案件？", vbYesNo + vbDefaultButton2 + vbInformation) = vbYes Then
'            strTxt(1) = "UPDATE PATENT SET PA165='Y' WHERE " & ChgPatent(pa(1) & pa(2) & pa(3) & pa(4))
'            cnnConnection.Execute strTxt(1)
'         End If
'      End If
'   End If
   If bolSetPA165 = True Then
      strSql = "UPDATE PATENT SET PA165='Y' WHERE " & ChgPatent(pa(1) & pa(2) & pa(3) & pa(4))
      cnnConnection.Execute strSql, intI
   End If
'end 2021/2/4
   '2014/7/4 END
   
   'Added by Morgan 2014/12/8
   '來函自動收文的B類分析發文同時,1.來函上發文日 2.將分析函移至來函卷宗區並更名為客戶函 3.更新來函信函進度相關欄位
   If bolAuto941Case = True Then
      '來函上發文日
      strSql = "update caseprogress set cp27=" & DBDATE(Text7(0)) & " where cp09='" & cp(43) & "' and cp27 is null"
      cnnConnection.Execute strSql, intI
      
      PUB_DelFtpFile2 cp(43), " and upper(cpp02)='" & strAuto941RefFileName & "'" 'Added by Morgan 2015/4/15 檔案改放 FTP,必須在DB資料刪除前執行
      
      '分析函移至來函
      'strExc(1) = pa(1) & Val(pa(2)) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4)) 'Removed by Morgan 2015/3/17
      strSql = "delete casepaperpdf  where cpp01='" & cp(43) & "' and upper(cpp02)='" & strAuto941RefFileName & "'"
      cnnConnection.Execute strSql, intI
      
      'Modified by Morgan 2015/3/17
      'strSql = "update casepaperpdf set cpp01='" & cp(43) & "',cpp02='" & strAuto941RefFileName & "'  where cpp01='" & cp(9) & "' and upper(cpp02)='" & strExc(1) & ".941.RJN.PDF'"
      strSql = "update casepaperpdf set cpp01='" & cp(43) & "',cpp02='" & strAuto941RefFileName & "'  where cpp01='" & cp(9) & "' and cpp02='" & ChgSQL(strOldFileName) & "'"
      'end 2015/3/17
      cnnConnection.Execute strSql, intI
      
      'Modified by Morgan 2014/12/15 直寄設定也要更新
      'Modified by Morgan 2015/10/8 +LP31
      strExc(1) = PUB_SetLP11(pa(26), pa(75), strExc(2))
      strSql = "update letterprogress set lp08='" & cp(14) & "',lp09=" & strSrvDate(1) & ",lp10='Y',lp11='" & strExc(1) & "',LP31='" & strExc(2) & "' where lp01='" & cp(43) & "' and lp10 is null"
      cnnConnection.Execute strSql, intI
   End If
   'end 2014/12/8
   
   'Add By Sindy 2015/8/3 發文時,若工程師各項日期未輸入者,自動更新為發文日
   Call PUB_UpdEmpDate(cp(9), cp(1), cp(10), DBDATE(Text7(0)))
   
   'Added by Morgan 2016/1/22
   '一案兩請之擇一申復發文時,倘若相對應的新型案尚未繳年費,且本所期限是落在發文日起算三個月內者,或者是已逾本所期限但仍在6個月補期限內者,則請發email知會智權同仁 -郭雅娟
   If pa(9) = "000" And Text7(2) = "239" Then
      strExc(0) = "select cm01||'-'||cm02||decode(cm03||cm04,'000','','-'||cm03||'-'||cm04) CaseNo" & _
         " from ( select cp01,cp02,cp03,cp04,cp27" & _
         ",nvl(c1.cm05,c2.cm01) cm01,nvl(c1.cm06,c2.cm02) cm02,nvl(c1.cm07,c2.cm03) cm03,nvl(c1.cm08,c2.cm04) cm04" & _
         " from caseprogress,casemap c1,casemap c2 where cp09='" & cp(9) & "'" & _
         " and c1.cm01(+)=cp01 and c1.cm02(+)=cp02 and c1.cm03(+)=cp03 and c1.cm04(+)=cp04 and c1.cm10(+)='3'" & _
         " and c2.cm05(+)=cp01 and c2.cm06(+)=cp02 and c2.cm07(+)=cp03 and c2.cm08(+)=cp04 and c2.cm10(+)='3'" & _
         ") X where exists(select * from nextprogress where np02=cm01 and np03=cm02 and np04=cp03 and np05=cp04 and np07='605' and np06 is null" & _
         " and to_date(np08,'yyyymmdd')<=add_months(to_date(cp27,'yyyymmdd'),3) and to_date(np09,'yyyymmdd')>add_months(to_date(cp27,'yyyymmdd'),-6))"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         strExc(1) = "一案兩請發明案(" & pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4)) & ")擇一申復已發文，新型案(" & RsTemp(0) & ")尚未繳納當年度年費提醒！"
         strExc(2) = "本案(" & pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4)) & ")已提出擇一申復選擇發明" & _
            ",預估很快即可發出核准審定書,惟因本案之新型案(" & RsTemp(0) & ")尚未繳納當年度年費,依規定,發明審定前,新型專利必須是處於存續狀態,否則發明將不予專利" & _
            ",故請告知客戶儘速繳納新型年費,以維護發明專利。"
         strSql = "insert into mailcache(mc01,mc02,mc03,mc04,mc07,mc08)" & _
                     " values( '" & strUserNum & "','" & cp(13) & "',to_char(sysdate,'yyyymmdd')" & _
                     ",to_char(sysdate,'hh24miss'),'" & strExc(1) & "','" & strExc(2) & "')"
         cnnConnection.Execute strSql, intI
      End If
   End If
   'end 2016/1/22
   
   'Added by Lydia 2016/09/29 一案兩請大陸發明案發文陳述意見時,若新型案有內部收文放棄專利權將一併上發文日
   If m_DualCase429B Then
       'Modified by Lydia 2022/06/29  P-122995之A類收文放棄專利權沒有一併上發文日;參考 2017/11/09 若智權同仁自行收文A類放棄專利權429,請一併上發文日
       'strSql = "Update caseprogress set cp27=" & CNULL(TransDate(Text7(0), 2)) & _
                " where cp01='" & m_DualCaseNo(1) & "' and cp02='" & m_DualCaseNo(2) & "' and cp03='" & m_DualCaseNo(3) & "' and cp04='" & m_DualCaseNo(4) & "'" & _
                " and cp10='429' and substr(cp09,1,1)='B' and cp158=0 "
       strSql = "Update caseprogress set cp27=" & CNULL(TransDate(Text7(0), 2)) & _
                " where cp01='" & m_DualCaseNo(1) & "' and cp02='" & m_DualCaseNo(2) & "' and cp03='" & m_DualCaseNo(3) & "' and cp04='" & m_DualCaseNo(4) & "'" & _
                " and cp10='429' and cp158=0 "
       cnnConnection.Execute strSql, intI
   End If
   'end 2016/09/29
   
   'Add By Sindy 2016/7/7 品薇承辦的非台灣案,才需檢查若為補文件繪圖時,需一併上新案的繪圖草完和墨完日
   'Modify By Sindy 2018/10/4 98012改判斷是P12專利處程序
   'If cp(14) = "98012" And pa(9) <> "000" And cp(10) = 補文件 Then
   If cp(14) <> "" And PUB_GetST03(cp(14)) = "P12" And pa(9) <> "000" And cp(10) = 補文件 Then
      strExc(0) = "select ep15,ep18 from engineerprogress" & _
                  " where ep02='" & Label3(0).Caption & "'" & _
                  " and ep15 is not null and ep18 is not null"
      intI = 1
      CheckOC3
      Set AdoRecordSet3 = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         strEP15 = AdoRecordSet3.Fields("ep15")
         strEP18 = AdoRecordSet3.Fields("ep18")
         '此本所案號有新案未上繪圖草完和墨完日者,一併更新 ex: P-114904
         strExc(0) = "Select CP09 From Caseprogress,engineerprogress" & _
                     " Where CP01='" & pa(1) & "' AND CP02='" & pa(2) & "' AND CP03='" & pa(3) & "' AND CP04='" & pa(4) & "'" & _
                     " AND InStr('" & NewCasePtyList & "',CP10)>0 AND CP09=EP02(+)" & _
                     " AND ep14 is not null AND ep17 is not null" & _
                     " AND ep15 is null AND ep18 is null"
         intI = 1
         CheckOC3
         Set AdoRecordSet3 = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            strSql = "update engineerprogress" & _
                     " set ep15=" & strEP15 & ",ep18=" & strEP18 & _
                     " where ep02='" & AdoRecordSet3.Fields("cp09") & "'"
            cnnConnection.Execute strSql, intI
         End If
      End If
      CheckOC3
   End If
   '2016/7/7 END

   'Added by Morgan 2016/11/29
   If m_990CP09 <> "" Then
      strSql = "update caseprogress set cp27=" & strSrvDate(1) & " where cp09='" & m_990CP09 & "' and cp27 is null"
      cnnConnection.Execute strSql, intI
   End If
   'end 2016/11/29
   
   'Added by Morgan 2020/2/12
   '代理人撰稿發文代理人設定至本程序
   If cp(10) = "958" And cp(44) <> "" And cp(43) <> "" Then
      strSql = "update caseprogress set cp44='" & cp(44) & "' where cp09='" & cp(43) & "' and cp27 is null and cp57 is null"
      cnnConnection.Execute strSql, intI
   End If
   'end 2020/2/12
   
   'Added by Lydia 2022/04/28  工程師命名作業收文FMP主修和告代的承辦期限：先預設新案發文
   '新案命名收文參考frm010005.FcpAddTct = "101,102,103,112,125"
   If m_bolFMP = True And InStr("101,102,103,112,125", cp(10)) > 0 Then
       '主動修正
       Call Pub_GetFMPbCP48("2", cp, "203")
       '告代
       Call Pub_GetFMPbCP48("2", cp, "901")
   End If
   'end 2022/04/28
   
   'Added by Lydia 2022/05/23 法律所案源：法務案無發文日則更新發文日為系統日，但法務案不更新CP84。另加發EMAIL給法務案承辦人，提供案號及案件性質、總收文號，提醒他去案件進度檔補輸工作時數及工作點數分配。
   'Modified by Lydia 2022/09/16 限制B2案源
   If m_LOS15 <> "" And m_LOS02 = "B2" Then
       Call PUB_UpdateLosCP27(m_LOS15)
   End If
   'end 2022/05/23
   'Added by Lydia 2023/03/06 外專新案認領：急件提申發文時取消案件之工程師組別，重新進入認領流程
   'Modifed by Lydia 2023/05/23 限第一次發文cp82
   If strSrvDate(1) >= 外專新案認領啟用日 And pa(1) = "P" And m_bolFMP = True And Val(cp(82)) = 0 Then
      If PUB_UpdateReTCN(pa, cp) = False Then
         GoTo ErrorHandler
      End If
   End If
   'end 2023/03/06
   
   'Added by Morgan 2023/4/20 111/8/19請作單--陳玲玲
   '台灣主張國內優先權之後案自請撤回發文時，基礎案則要恢復催審管制 (下一程序的本程序催審已過期的，請更新為恢復管制日+6個月)
   If pa(9) = "000" And Text7(2) = "413" And cp(43) <> "" Then
      strExc(0) = "select * from caseprogress a,pridate,patent" & _
         " where cp09='" & cp(43) & "' and cp10 in ('101','102')" & _
         " and exists(select * from caseprogress b where cp01=a.cp01" & _
         " and cp02=a.cp02 and cp03=a.cp03 and cp04=a.cp04 and cp10='121' and cp27>0)" & _
         " and pd01(+)=cp01 and pd02(+)=cp02 and pd03(+)=cp03 and pd04(+)=cp04 and pd07='000'" & _
         " and pa09(+)=pd07 and pa10(+)=pd05 and pa11(+)=pd06 and pa01 is not null and pa16 is null"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         With RsTemp
         strExc(0) = "select np01,np07,np08,np09,np22 from caseprogress,nextprogress" & _
            " where cp01='" & .Fields("pa01") & "' and cp02='" & .Fields("pa02") & "'" & _
            " and cp03='" & .Fields("pa03") & "' and cp04='" & .Fields("pa04") & "'" & _
            " and cp10 in ('101','102') and cp24 is null and np01(+)=cp09" & _
            " and np07='411' and np06='N'"
         End With
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            With RsTemp
            strSql = "update nextprogress set np06=null,np11=null,np12=null"
            If .Fields("np08") < strSrvDate(1) Then
               'Added by Lydia 2025/10/29
               stNP23 = ""
               If strSrvDate(1) >= 內專本所約定期限啟用日 Then
                  strExc(1) = PUB_GetPOurDeadline(strSrvDate(1), pa(9), stNP23, pa(1), "" & RsTemp.Fields("np07"))
               Else
               'end 2025/10/29
                  strExc(1) = CompDate(1, 6, strSrvDate(1))
               End If 'Added by Lydia 2025/10/29
               'Modified by Lydia 2025/10/29
               'strSql = strSql & ",np08=" & PUB_GetWorkDay1(strExc(1), True) & ",np09=" & strExc(1)
               strSql = strSql & ",np08=" & PUB_GetWorkDay1(strExc(1), True) & ",np09=" & strExc(1) & ", NP23=" & IIf(stNP23 = "", "NP23", stNP23)
            End If
            strSql = strSql & " where np01='" & .Fields("np01") & "'" & _
                  " and np06='N' and np07='411' and np22=" & .Fields("np22")
            End With
            cnnConnection.Execute strSql, intI
         End If
      End If
   End If
   'end 2023/4/20
   
   'Added by Morgan 2025/4/14
   '國內案發文更新CFP案檢視中文齊備日及本所期限
   If InStr(CaseMapIn, Text7(2)) > 0 Then
      strExc(0) = "select cp06, cp09 from casemap,caseprogress,engineerprogress" & _
         " where cm05='" & pa(1) & "' and cm06='" & pa(2) & "' and cm07='" & pa(3) & "' and cm08='" & pa(4) & "' and cm10='0'" & _
         " and cp01(+)=cm01 and cp02(+)=cm02 and cp03(+)=cm03 and cp04(+)=cm04 and cp10='209' and cp158=0 and cp159=0" & _
         " and ep02(+)=cp09 and ep06 is null"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         '因所限較短CFP檢視中說不必設承辦期限(於ENGINEERPROGRESS_BEFORE5內排除)--柏翰
         '齊備日
         strSql = "update engineerprogress set ep06=" & strSrvDate(1) & " where ep02='" & RsTemp("cp09") & "' and ep06 is null"
         cnnConnection.Execute strSql, intI
         
         '本所期限
         If IsNull(RsTemp("cp06")) Then
            '本所期限=齊備日+2工作天,
            strExc(1) = CompWorkDay(3, strSrvDate(1))
            strSql = "update caseprogress set cp06=" & strExc(1) & " where cp09='" & RsTemp("cp09") & "'"
            cnnConnection.Execute strSql, intI
         End If
      End If
   End If
   'end 2025/4/14
   
   'Added by Morgan 2025/6/16
   If bAutoB204 Then
      strExc(0) = AutoNo("B", 6) 'B類總收文號
      strSql = "insert into caseprogress (cp01,cp02,cp03,cp04,cp05,cp06,cp07,cp08,cp09,cp10,cp11,cp12,cp13,cp14" & _
         ",cp20,cp26,cp27,cp32,cp43,CP44,cp45,cp48,cp116) " & _
         " select cp01,cp02,cp03,cp04," & strSrvDate(1) & ",cp06,cp07,cp08,'" & strExc(0) & "','204','90',cp12,cp13,cp14" & _
         ",'N','N'," & IIf(pa(9) = "000", "null", strSrvDate(1)) & ",'N',cp43,cp44,cp45,cp48,cp116 from caseprogress where cp09='" & cp(9) & "'"
      cnnConnection.Execute strSql, intI
   End If
   'end 2025/6/16
   
   cnnConnection.CommitTrans
   FormSave = True
   
   'Add by Morgan 2009/7/16
   If st307Msg <> "" Then
      MsgBox st307Msg
   End If
   
   'Add by Amy 2014/07/25 若大陸案有收文申請優先權證明或優先權存取碼發Mail通知承辦人可送件(copy frm04010402)
   If pa(9) = "020" And InStr(NewCasePtyList, Text7(2)) > 0 Then
      strExc(0) = "Select cp14,cpm04 From CaseProgress,CasePropertyMap " & _
                       "Where cp01='" & pa(1) & "' And cp02='" & pa(2) & "' And cp03='" & pa(3) & "' And cp04='" & pa(4) & "' " & _
                       "And cp10 In ('405','436') And cp27||cp57 is null And cp01=cpm01(+) And cp10=cpm02(+)"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         Do While RsTemp.EOF = False
            strExc(1) = "" & RsTemp("cp14")
            If strExc(1) = "" Then strExc(1) = strUserNum
            strExc(2) = pa(1) & "-" & pa(2) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4))
            strExc(2) = strExc(2) & " 案已發文，" & RsTemp.Fields("cpm04") & "可送件！"
            strSql = "insert into mailcache(mc01,mc02,mc03,mc04,mc07,mc08)" & _
                        " values( '" & strUserNum & "','" & strExc(1) & "',to_char(sysdate,'yyyymmdd')" & _
                        ",to_char(sysdate,'hh24miss'),'" & strExc(2) & "','如旨')"
            cnnConnection.Execute strSql, intI
            RsTemp.MoveNext
         Loop
      End If
   End If
   'end 2014/07/24
   
   '2010/10/25 ADD BY SONIA 補收文超頁超項費發MAIL通知智權人員及財務處
   'Modified by Morgan 2013/6/17 71005->71006
   If m_lngOverPageFeeDiff + m_lngOverItemFeeDiff > 0 Then
      'Modify by Amy 2024/05/15 財務2個特殊設定拆成3個
      If Val(strSrvDate(1)) >= Val(財務拆總帳出納國內應收啟用日) Then
         strTo = Pub_GetSpecMan("財務處應收處理人員")
      Else
         strTo = Pub_GetSpecMan("財務處總帳人員")
      End If
      ReDim Preserve skMail(UBound(skMail) + 1) As SeekMails
      skMail(UBound(skMail)).fiSender = strUserNum
      skMail(UBound(skMail)).fiReceiver = stCP13 & ";" & strTo
      'end 2024/05/15
      'Modified by Lydia 2022/05/30 傳入最新收文號
      'skMail(UBound(skMail)).fiRecriverNo = ""
      skMail(UBound(skMail)).fiRecriverNo = PUB_GetLastABKindCP09(pa(1), pa(2), pa(3), pa(4))
      'end 2022/05/30
      skMail(UBound(skMail)).fiSubject = Me.Text1.Text & "-" & Me.Text2.Text & "-" & Me.Text3.Text & "-" & Me.Text4.Text & "的" & Label3(5) & "已發文，尚有"
      If m_lngOverPageFeeDiff > 0 Then skMail(UBound(skMail)).fiSubject = skMail(UBound(skMail)).fiSubject & " 超頁費 "
      If m_lngOverItemFeeDiff > 0 Then skMail(UBound(skMail)).fiSubject = skMail(UBound(skMail)).fiSubject & " 超項費 "
      skMail(UBound(skMail)).fiSubject = skMail(UBound(skMail)).fiSubject & "需向申請人收取, 系統已做內部收文財務處將開立收據！謝謝！"
      skMail(UBound(skMail)).fiContent = "本所案號：" & Me.Text1.Text & "-" & Me.Text2.Text & "-" & Me.Text3.Text & "-" & Me.Text4.Text & vbCrLf & "案件名稱：" & Text7(14) & vbCrLf & vbCrLf
      If m_lngOverPageFeeDiff > 0 Then skMail(UBound(skMail)).fiContent = skMail(UBound(skMail)).fiContent & "超頁費：" & Format(m_lngOverPageFeeDiff, "###,##0") & vbCrLf & vbCrLf
      If m_lngOverItemFeeDiff > 0 Then skMail(UBound(skMail)).fiContent = skMail(UBound(skMail)).fiContent & "超項費：" & Format(m_lngOverItemFeeDiff, "###,##0") & vbCrLf & vbCrLf
      skMail(UBound(skMail)).fiContent = skMail(UBound(skMail)).fiContent & "注意：１．請財務處開立收據交智權人員" & vbCrLf & "　　　２．請智權人員不要再填接洽單"
   End If
   '2010/10/25 END
   
   Exit Function
   
ErrorHandler:
   cnnConnection.RollbackTrans
   If Err.NUMBER <> 0 Then MsgBox Err.Description, vbCritical
   
   
End Function

'Add By Sindy 2014/7/9
Private Sub Combo1_Validate(Cancel As Boolean)
   If Combo1 <> "" Then
      Combo1 = Left(Combo1, 1) + "." + PUB_GetCaseAttributeName(Left(Combo1, 1), pa(8))
      If Combo1 = Left(Combo1, 1) + "." Then
         Combo1 = Left(Combo1, 1)
         Cancel = True
         Combo1.SetFocus
      End If
   End If
End Sub
'2014/7/9 End

Private Sub Combo2_Click()
   Combo2_Validate False
End Sub
'Add by Morgan 2008/10/27
Private Sub Combo2_GotFocus()
   CloseIme
End Sub

Private Sub Combo2_KeyPress(KeyAscii As Integer)
   KeyAscii = UpperCase(KeyAscii)
End Sub

Private Sub Combo2_Validate(Cancel As Boolean)
   Dim strNo As String, iPos As Integer
   If Combo2.Text = "" Then
      If pa(9) <> 台灣國家代號 Then
         '+903專利調查,927其他翻譯--玲玲 ExP-115116
         If cp(10) <> "941" And cp(10) <> "903" And cp(10) <> "927" Then 'Added by Morgan 2014/5/20 分析發文對象為客戶
            MsgBox "當申請國家非台灣時, 代理人欄不可為空白!!!", vbExclamation
            Cancel = True
            Exit Sub
         End If
      End If
      
   ElseIf Not ChgType(12) Then
      Cancel = True
      
   Else
      strNo = Combo2.Text
      
      'Add by Morgan 2008/2/21 加聯絡人判斷
      iPos = InStr(strNo, "-")
      If iPos > 0 Then
         strNo = Left(strNo, iPos - 1)
      End If
      'end 2008/2/21
      
      'Add by Morgan 2004/9/14 檢查客戶/代理人是否不再使用
      If PUB_CheckStatus(strNo) = False Then Cancel = True
   End If
End Sub

Private Sub Command2_Click(Index As Integer)
   Dim ii As Integer, jj As Integer
   Dim inv1, inv2
   
   Select Case Index
      Case 0
         'Add by Morgan 2010/4/27 若有選過發明人且申請人有變更時提醒
         If PUB_ChkInventor(strInventor(2), strInventor(1)) = False Then
            MsgBox "申請人已變更，請重新點選發明人資料！"
         End If
         'end 2010/4/27
         
         'Modify by Amy 2014/04/22
         If InStr(NewCasePtyList, Text7(2)) > 0 And bolFirstInventor = True Then
            strInventor(2) = DefInventor
            bolFirstInventor = False
         End If
         'end 2014/04/22
         
         'Modified by Morgan 2020/2/19
         'ModifyInventor strInventor(1), strInventor(2)
         ModifyInventor strInventor(1), strInventor(2), Me
         
         
      Case 1
         'Modify by Morgan 2005/11/7
         'ModifyPriority strPriority(1), strPriority(2), strPriority(3)
         '2006/1/26 CANCEL BY SONIA 不限制申請國家為台灣之案件
         'If pa(9) = "000" Then
            'Modified by Lydia 2023/06/15 「414恢復權利-主張優先權106」不用重新輸入全部資料
            'If m_bolRePriDate = True Then
            If m_bolRePriDate = True Or bolChk414for106 = True Then
               m_bolRePriDate = True
            'end 2023/06/15
               '第二次不再檢查
               'Modify by Morgan 2007/3/5 加申請國家
               'ModifyPriority strPriority(1), strPriority(2), strPriority(3), pa(8), , pa(1) & pa(2) & pa(3) & pa(4),, True
               'Modify by Morgan 2008/6/6 + strPriority(4)
               'Modify by Amy 2014/04/08 + strPriority(5)
               ModifyPriority strPriority(1), strPriority(2), strPriority(3), pa(8), , pa(1) & pa(2) & pa(3) & pa(4), pa(9), True, strPriority(4), strPriority(5)
               'end 2007/3/5
            Else
               m_bolRePriDate = True
               'Modify by Morgan 2007/3/5 加申請國家
               'ModifyPriority strPriority(1), strPriority(2), strPriority(3), pa(8), m_bolRePriDate, pa(1) & pa(2) & pa(3) & pa(4), , True
               'Modify by Morgan 2008/6/6 + strPriority(4)
                'Modify by Amy 2014/04/08 + strPriority(5)
               ModifyPriority strPriority(1), strPriority(2), strPriority(3), pa(8), m_bolRePriDate, pa(1) & pa(2) & pa(3) & pa(4), pa(9), True, strPriority(4), strPriority(5)
               'end 2007/3/5
            End If
         '2006/1/26 CANCEL BY SONIA 不限制申請國家為台灣之案件
         'Else
         '   ModifyPriority strPriority(1), strPriority(2), strPriority(3), , , pa(1) & pa(2) & pa(3) & pa(4)
         'End If
         '2006/1/26 END
      Case 2
         'Add by Morgan 2009/11/10
         If pa(9) <> "000" And InStr(CaseMapIn, Text7(2)) > 0 Then
            strExc(1) = PUB_GetWorkDay1(CompDate(1, 2, Text7(0)), True)
            ModifyAddDeadline1 cp(9), strExc(1), , m_si880017
         Else
         'end 2009/11/10
            frm880003.PA09 = pa(9)
            frm880003.CP10 = Text7(2)
            ModifyAddDeadline strAdddeadline(1), strAdddeadline(2), strAdddeadline(3)
         End If
   End Select
End Sub

Private Sub Form_Activate()
   'Added by Morgan 2020/2/19
   If m_bClickInventor = True Then
      Me.Enabled = True
      Command2(0).Value = True
      m_bClickInventor = False
      Exit Sub
   End If
   'end 2020/2/19
   
    'Add By Cheng 2003/10/06
    '若有按下變更事項按鈕, 則重新讀取資料
    If m_blnClkChgEvnBtn = True Then
        ReadPatent
        Label3(0) = strReceiveNo
        m_blnClkChgEvnBtn = False
    End If
End Sub

Private Sub Form_Load()
    MoveFormToCenter Me
    intWhere = 國內
    With frm040104_1
        Text1 = .Text1
        Text2 = .Text2
        Text3 = .Text3
        Text4 = .Text4
        strReceiveNo = .Tag
        If .mCP09 <> "" Then Me.cmdOK(3).Enabled = False 'Added by Morgan 2020/1/16
    End With
    'Add by Morgan 2005/7/13
    ReDim pa(TF_PA)
    ReDim cp(TF_CP)
    ReadPatent
   Label3(0) = strReceiveNo
   m_blnClkChgEvnBtn = False
    SSTab1.Tab = 0 'Added by Lydia 2021/05/25
    
   'Modify by Amy 2014/04/22 由Process搬過來 有國內案者預設關聯案發明人
   'Add by Amy 2013/08/06 +判斷P案是否有國內案且已發文(排除FCP)
   If InStr(NewCasePtyList, Text7(2)) > 0 Then
      bolFirstInventor = True
      cm(5) = "": cm(6) = "": cm(7) = "": cm(8) = ""
      strExc(0) = "Select CM05,CM06,CM07,CM08 From CaseMap,Caseprogress Where CM01='" & pa(1) & "' AND CM02='" & pa(2) & "' AND CM03='" & pa(3) & "' AND CM04='" & pa(4) & "' " & _
                       "AND CM10='0' AND CM05<>'FCP' And  CM05=CP01 And CM06=CP02 And CM07=CP03 And CM08=CP04 And CP27>0 And InStr('" & NewCasePtyList & "',CP10)>0"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
          cm(5) = RsTemp.Fields("CM05")
          cm(6) = RsTemp.Fields("CM06")
          cm(7) = RsTemp.Fields("CM07")
          cm(8) = RsTemp.Fields("CM08")
          OrgInventor = strInventor(2)
          DefInventor = "Y"
          CopyInventor cm(5) & cm(6) & cm(7) & cm(8), pa(1) & pa(2) & pa(3) & pa(4), True, DefInventor
          MsgBox "國內案 " & cm(5) & "-" & cm(6) & IIf(cm(7) & cm(8) = "000", "", "-" & cm(7) & "-" & cm(8)) & " 已發文！發明人資訊將會預設到本案！", vbExclamation
      End If
      'add by sonia 2019/7/30 PCT進入國家階段提醒
      If pa(46) = "Y" Then
         MsgBox "本案為PCT國際申請案進入國家階段案件，請確認申請文件之PCT相關資料是否正確無誤。"
      End If
      'end 2019/7/30
   End If
   'end 2014/04/22
    
   'Add by Morgan 2008/11/10 預設說明書是否要電子檔
   'Removed by Morgan 2019/4/8 改判斷電子送件都預設要電子檔(txtCP118_Change控制)
   'Text7(27) = PUB_GetDefautCP120(cp(10), pa(9))
   'If Text7(27) = "" Then
   '   lblCP120.Visible = False
   '   Text7(27).Visible = False
   'End If
   'end 2019/4/8
   'end 2008/11/10
   
   'Add by Morgan 2009/6/1
   '檢查是否已有一般提申期限
   'Modify by Morgan 2009/11/11 +收達
   If PUB_ChkFileNP(cp(9), "'997','998'") Then MsgBox "下一程序已有一般提申或收達期限，若為重新發文時需要先刪除後才可作業！"
   'Add by Morgan 2009/12/17 回覆委任代理人發文要檢查相關收文號是否有掛一般提申期限
   If Text7(2) = "936" And cp(43) <> "" And cp(43) < "C" Then
      'Modify By Sindy 2014/7/24 若相關總收文號的案件性質為950案件暫緩時，再抓一次相關總收文號，去更新該筆資料下一程序的提申期限
      str950CP43 = ""
      strExc(0) = "select cp09,cp10,cp43 from caseprogress" & _
            " where cp09='" & cp(43) & "'"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         If RsTemp.Fields("cp10") = "950" Then
            str950CP43 = RsTemp.Fields("cp43")
         End If
      End If
      If str950CP43 <> "" Then
         If PUB_ChkFileNP(str950CP43, "'998'") Then MsgBox "相關收文號下一程序已有一般提申期限，請確認！"
      Else
      'If cp(43) < "C" Then
      '2014/7/24 END
         If PUB_ChkFileNP(cp(43), "'998'") Then MsgBox "相關收文號下一程序已有一般提申期限，請確認！"
      End If
   End If
   
   'Added by Morgan 2021/1/27 從 Formsave 移來以便共用
   'Mark by Lydia 2023/06/15 改在ReadPatent
   'stCP13 = PUB_GetAKindSalesNo(cp(1), cp(2), cp(3), cp(4))
   'stCP12 = GetSalesArea(stCP13)
   ''end 2021/1/27
   
   'Add by Morgan 2009/11/11
   'Modified by Morgan 2021/1/27
   'If Left(cp(12), 1) = "F" And pa(9) <> "000" Then
   'Mark by Lydia 2023/06/15 改在ReadPatent
   'If Left(stCP12, 1) = "F" And pa(9) <> "000" Then
   ''end 2021/1/27
   '   m_bolFMP = True
   'Else
   '   m_bolFMP = False
   'End If
   'end 2023/06/15
   
   'FMP新案預設順稿期限
   strExc(0) = "select np08 from nextprogress where np01='" & cp(9) & "' and np06 is null and np07='994'"
   intI = 1
   Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
   If intI = 1 Then
      Check1.Value = 1
      Check1.Enabled = False
      txtDate = TransDate(RsTemp(0), 1)
   
'2010/2/11 CANCEL BY SONIA
'   ElseIf m_bolFMP And (cp(10) = "101" Or cp(10) = "102" Or cp(10) = "103") Then
'      strExc(1) = PUB_GetDeadLine(DBDATE(cp(5)), DBDATE(cp(7)), 5)
'      If strExc(1) <> "" Then
'         Check1.Value = 1
'         txtDate = TransDate(strExc(1), 1)
'      End If
'2010/2/11 END
   End If
   'end 2009/11/11
   
   
   m_si880017 = 0
   
   'Add by Morgan 2010/1/4 增加頁數,項數欄位
   m_bolChkFee = False
   txtCP135.Enabled = False
   txtCP135.BackColor = Me.BackColor
   txtCP136.Enabled = False
   txtCP136.BackColor = Me.BackColor
   txtCP137.Enabled = False
   txtCP137.BackColor = Me.BackColor
   txtCP138.Enabled = False
   txtCP138.BackColor = Me.BackColor
   txtCP84.Enabled = True
   
   m_strReExamCP27 = "" 'Added by Morgan 2013/1/10
   m_bolFixNewFee = False 'Added by Morgan 2013/1/10
   
   'Modified by Morgan 2013/6/4 設計不用(只有發明要)
   'If pa(9) = "000" Then
   If pa(9) = "000" And pa(8) = "1" Then
      'Modified by Morgan 2013/10/9 申復 205 不必輸也不必問--102/7/30 陳玲玲請作單
      If (cp(10) = "416" Or cp(10) = "203" Or cp(10) = "204" Or cp(10) = "206") Then
      
         'Added by Morgan 2013/1/10
         If (cp(10) = "210" Or cp(10) = "203" Or cp(10) = "204" Or cp(10) = "205" Or cp(10) = "206") Then
            m_strReExamCP27 = PUB_GetReExamDate(cp)
            If m_strReExamCP27 > "20130000" Then
               m_bolFixNewFee = True
            End If
         End If
         'end 2013/1/10
         
         If m_strReExamCP27 = "" Then 'Added by Morgan 2013/1/10
         
            m_bol99Case = Chk99NewCase(cp(1), cp(2), cp(3), cp(4))
            If m_bol99Case Then
               '實審
               If cp(10) = "416" Then
                  m_bolChkFee = True
                  m_bolChkPageItem = True
                  txtCP84.Enabled = False
                  txtCP135.Enabled = True
                  txtCP135.BackColor = vbWhite
                  lblCP136.Caption = "總項數"
                  txtCP136.Enabled = True
                  txtCP136.BackColor = vbWhite
               '修正
               ElseIf cp(10) = "203" Or cp(10) = "204" Or cp(10) = "205" Or cp(10) = "206" Then
                  '實審已發文
                  If PUB_ChkCPExist(cp, "416", 2) Then
                     m_bolChkItem = True 'Add by Morgan 2010/10/11
                     m_bolChkFee = True
                     txtCP84.Enabled = False
                     lblCP136.Caption = "增加項數"
                     txtCP136.Enabled = True
                     txtCP136.BackColor = vbWhite
                     txtCP137.Enabled = True
                     txtCP137.BackColor = vbWhite
                     '已輸審查意見通知
                     If PUB_ChkCPExist(cp, "1202") = True Then
                        txtCP138.Enabled = True
                        txtCP138.BackColor = vbWhite
                     End If
                  End If
               End If
            End If
            
         'Added by Morgan 2013/1/10
         '有再審102年後發文,修正要收超項費
         ElseIf m_bolFixNewFee = True Then
            m_bolChkItem = True
            m_bolChkFee = True
            txtCP84.Enabled = False
            lblCP136.Caption = "增加項數"
            txtCP136.Enabled = True
            txtCP136.BackColor = vbWhite
            txtCP137.Enabled = True
            txtCP137.BackColor = vbWhite
            txtCP138.Enabled = True
            txtCP138.BackColor = vbWhite
         End If
      
      '102年起再審也要算超頁超項費(若有延期則以延期發文日判斷)
      ElseIf cp(10) = "107" And m_bol107NewFee = True Then
         m_bolChkFee = True
         m_bolChkPageItem = True
         txtCP84.Enabled = False
         txtCP135.Enabled = True
         txtCP135.BackColor = vbWhite
         lblCP136.Caption = "總項數"
         txtCP136.Enabled = True
         txtCP136.BackColor = vbWhite
      'end 2013/1/10
      
      End If
   End If
   
   'Add By Sindy 2014/7/9
   If pa(9) = "000" And pa(8) = "3" And pa(23) = "1" Then '台灣設計案且卷宗性質為1.申請時,才顯示案件屬性
      Combo1.Enabled = True
   Else
      Combo1.Enabled = False
   End If
   '2014/7/9 END
   
   cp(110) = "" '要清空,否則若重新發文會殘留前次發文資料,當新案有改出名人而本程序未改選將會造成不一致 Added by Morgan 2012/9/7
     

   'Added by Morgan 2012/9/6
   '台灣專利案若以專利商標出名則提醒
   'Modified by Morgan 2020/3/11
   'If pa(1) = "P" And pa(9) = "000" And pa(161) = "Y" And InStr(NewCasePtyList, cp(10)) > 0 Then
'Removed by Morgan 2020/3/13 取消--郭
'   If pa(1) = "P" And pa(9) = "000" And pa(161) = "T" And InStr(NewCasePtyList, cp(10)) > 0 Then
'      MsgBox "本案是以專利商標名義提申，請檢查申請文件是否正確，出名代理人將預設為 ""林景郁"" ！"
'      cp(110) = "94007"
'   End If
'end 2020/3/11
   'end 2012/9/6
   
   'Add by Morgan 2005/7/13
   '台灣加出名代理人清單供勾選,原是否出名欄位不顯示
   Text7(20).Visible = False
   'Modify by Amy 2018/10/12 +Len(cp(10)) <> 4
   lstNameAgent.Clear
   If pa(9) = "000" And Len(cp(10)) <> 4 Then
      'Modified by Morgan 2021/12/14 +傳入bForm2=True
      'PUB_SetOurAgent lstNameAgent, pa(), cp(110), cp(10)   '2010/5/7 加傳CP(10)
      PUB_SetOurAgent lstNameAgent, pa(), cp(110), cp(10), True
      
      lstNameAgent.Visible = True
      lblNameAgent.Visible = True
   Else
      lstNameAgent.Visible = False
      lblNameAgent.Visible = False
   End If
   '2005/7/13 END
   
   'Add by Amy 2014/04/08 因應台日優先權證明文件控管
   If Text1 = "P" And (pa(9) = 台灣國家代號 Or pa(9) = 大陸國家代號) And (pa(8) = "1" Or pa(8) = "2") And (Text7(2) = "106" Or Text7(2) = "124") And frm040104_1.strChoose <> "" Then
       If frm040104_1.strChoose = "2" Then
          Text7(13).Enabled = True
       Else
          Text7(13).Enabled = False
       End If
   Else
      Text7(13).Enabled = True
   End If
   'end 2013/04/08
End Sub

Private Sub Form_Unload(Cancel As Integer)
   PUB_SendMailCache 'Add by Morgan 2007/3/23
   'Set frm040104_3 = Nothing 'Removed by Morgan 2021/12/14 form2.0會有問題，改在呼叫時清除記憶體變數
End Sub

Private Sub ReadPatent()
Dim Lbl As Object, txt As Object, i As Integer
'Add By Cheng 2002/07/11
Dim rsA As New ADODB.Recordset
Dim StrSQLa As String
Dim m_Fee As String         '銷帳服務費 2012/8/1 add by sonia
Dim m_Official As String    '銷帳規費   2012/8/1 add by sonia
 
   For Each Lbl In Label3
      Lbl = ""
   Next
   For Each txt In Text7
      txt = ""
   Next
   pa(1) = Text1
   pa(2) = Text2
   pa(3) = Text3
   pa(4) = Text4
   
   strInventor(1) = "": strInventor(2) = ""
   Select Case pa(1)
      Case "P"
         If ClsPDReadPatentDatabase(pa(), intWhere) Then 'edit by nickc 2007/02/02 不用 dll 了 If objPublicData.ReadPatentDatabase(pA(), intWhere) Then
            For i = 5 To 7
               Text7(i + 9) = pa(i)
            Next
            Text7(18) = pa(91)
            For i = 26 To 30
               If pa(i) <> "" Then
                  strInventor(1) = strInventor(1) & pa(i) & ","
                  Text7(i - 22) = pa(i)
                  ChgType (i)
               End If
            Next
            'Modify By Sindy 2014/12/9 讀取發明人資料
            If strSrvDate(1) >= 專利發明人檔啟用日 Then
               StrSQLa = "SELECT * from PatentInventor where pi01=" + CNULL(pa(1)) + " and pi02=" + CNULL(pa(2)) + " and pi03=" + CNULL(pa(3)) + " and pi04=" + CNULL(pa(4)) & _
                         " order by pi05 asc"
               If rsA.State <> adStateClosed Then rsA.Close
               rsA.CursorLocation = adUseClient
               rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
               If rsA.RecordCount > 0 Then
                  rsA.MoveFirst
                  Do While Not rsA.EOF
                     strInventor(2) = strInventor(2) & rsA.Fields("pi06") & ","
                     rsA.MoveNext
                  Loop
               End If
            Else
            '2014/12/9 END
               '2008/9/18 ADD BY SONIA
               For i = 60 To 69
                  If pa(i) <> "" Then
                     strInventor(2) = strInventor(2) & pa(i) & ","
                  End If
               Next
               '2008/9/18 END
            End If
            'Add By Cheng 2002/08/23
            m_strCust1 = "" & Me.Text7(4).Text
            m_strCust2 = "" & Me.Text7(5).Text
            m_strCust3 = "" & Me.Text7(6).Text
            m_strCust4 = "" & Me.Text7(7).Text
            m_strCust5 = "" & Me.Text7(8).Text
            
            'Add By Sindy 2014/9/22
            If pa(158) <> "" Then
               Combo1.ListIndex = Val(pa(158)) - 1
            End If
            '2014/9/22 END
         End If
      Case "PS"
         If ClsPDReadServicePracticeDatabase(pa(), intWhere) Then 'edit by nickc 2007/02/02 不用 dll 了 If objPublicData.ReadPatentDatabase(pA(), intWhere) Then
            For i = 5 To 7
               Text7(i + 9) = pa(i)
            Next
            Text7(18) = pa(18)
            If pa(8) <> "" Then
               strInventor(1) = strInventor(1) & pa(i) & ","
               Text7(4) = pa(8)
               ChgType (26)
            End If
            If pa(58) <> "" Then
               strInventor(1) = strInventor(1) & pa(i) & ","
               Text7(5) = pa(58)
               ChgType (27)
            End If
            If pa(59) <> "" Then
               strInventor(1) = strInventor(1) & pa(i) & ","
               Text7(6) = pa(59)
               ChgType (28)
            End If
            'Add By Cheng 2002/08/23
            m_strCust1 = "" & Me.Text7(4).Text
            m_strCust2 = "" & Me.Text7(5).Text
            m_strCust3 = "" & Me.Text7(6).Text
            m_strCust4 = ""
            m_strCust5 = ""
         End If
   End Select
   'Add by Amy 2018/10/30
   For i = 4 To 8
      Me.Text7(i).Tag = Me.Text7(i).Text
   Next i
   'end 2018/10/30
   If Right(strInventor(1), 1) = "," Then strInventor(1) = Left(strInventor(1), Len(strInventor(1)) - 1)
   If Right(strInventor(2), 1) = "," Then strInventor(2) = Left(strInventor(2), Len(strInventor(2)) - 1) 'Add By Sindy 2014/12/9
   
   Text7(24) = pa(11)
   If pa(9) <> "" Then
      'edit by nickc 2007/02/02 不用 dll 了
      'If objPublicData.GetNation(pA(9), strExc(0)) Then Label3(8) = strExc(0)
      If ClsPDGetNation(pa(9), strExc(0)) Then Label3(8) = strExc(0)
   End If
   
   cp(9) = strReceiveNo
   If PUB_ReadCaseProgressDatabase(cp(), intWhere) Then
      '92.6.10 ADD BY SONIA
      'Modify by Morgan 2010/6/23 +改請聯合 305 但不管原申請號,一率抓母案+U0x
      'If pa(9) = "000" And cp(10) >= "104" And cp(10) <= "105" And Text7(24) = "" Then
      'Modified by Morgan 2012/12/19 +衍生設計125,改請衍生設計308,抓母案+D0x
      If pa(9) = "000" And ((((cp(10) >= "104" And cp(10) <= "105") Or cp(10) = "125") And Text7(24) = "") Or cp(10) = "305" Or cp(10) = "308") Then
         strExc(0) = "SELECT PA11 FROM PATENT WHERE PA01='" & cp(1) & "' AND " & _
         "PA02='" & cp(2) & "' AND PA03='0' AND PA04='" & cp(4) & "'"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
         If intI = 1 And Not IsNull(RsTemp.Fields(0)) Then
            'Modify by Morgan 2010/6/23
            'If cp(10) = "105" Then
            If cp(10) = "105" Or cp(10) = "305" Then
               Text7(24) = RsTemp.Fields(0) & "U0" & cp(3)
            End If
            If cp(10) = "104" Then
               Text7(24) = RsTemp.Fields(0) & "A0" & cp(3)
            End If
            
            'Added by Morgan 2012/12/19
            If cp(10) = "125" Or cp(10) = "308" Then
               Text7(24) = RsTemp.Fields(0) & "D0" & cp(3)
            End If
         End If
      End If
      '92.6.10 END

      'Added by Lydia 2023/06/15
      'Move by Lydia 2023/06/20 從ChkCp10上方移來
      stCP13 = PUB_GetAKindSalesNo(cp(1), cp(2), cp(3), cp(4))
      stCP12 = GetSalesArea(stCP13)
      If Left(stCP12, 1) = "F" And pa(9) <> "000" Then '判斷FMP案
         m_bolFMP = True
      Else
         m_bolFMP = False
      End If
      '判斷寰華案
      m_bolFMP2 = False
      bolChk414for106 = False
      strFirstPriDate = ""
      If m_bolFMP = True Then
         
         m_bolFMP2 = PUB_FMPtoCheck(1, 2, Pub_strUserST05, pa(1), pa(2), pa(3), pa(4))
         'Added by Lydia 2023/06/20 有可能新案尚未發文
         If m_bolFMP2 = False And InStr(NewCasePtyList, cp(10)) > 0 Then
            m_bolFMP2 = PUB_GetFMP2toP(pa(1), pa(2), pa(3), pa(4))
         End If
         'end 2023/06/20
         '「414恢復權利-主張優先權106」:「414恢復權利」相關收文號，為最原始的總收文號為「106主張國際優先權」
         'Modified by Lydia 2023/06/28 debug: + And cp(10) = "414"
         If cp(43) <> "" And m_bolFMP2 = True And cp(10) = "414" Then
            strExc(0) = "select c1.cp09 as cp09_1,c1.cp10 as cp10_1,c2.cp09 as cp09_2,c2.cp10 as cp10_2 from caseprogress c1, caseprogress c2 where c1.cp09='" & cp(43) & "' and c1.cp43=c2.cp09(+)"
            intI = 1
            Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
            If intI = 1 Then
               If "" & RsTemp.Fields("cp10_1") = "106" Or "" & RsTemp.Fields("cp10_2") = "106" Then
                  bolChk414for106 = True
                  strFirstPriDate = PUB_GetFirstPriDate(cp())
               End If
            End If
         End If
      End If
      'end 2023/06/15
      '-----end ---'Move by Lydia 2023/06/20 從ChkCp10上方移來
      
      If cp(10) <> "906" Then
         SSTab1.TabVisible(1) = False
      End If
      If cp(13) <> "" Then
         Label3(1) = GetStaffName(cp(13), True)
      End If
      Label3(2) = cp(6)
      Label3(7) = cp(7)
      If cp(27) = "" Then
         Text7(0) = strSrvDate(2)
      Else
         Text7(0) = cp(27)
      End If
      If cp(14) <> "" Then
         Text7(1) = cp(14): ChgType (1)
      End If
      If cp(10) <> "" Then
         Text7(2) = cp(10)
         ChgType (2)
      End If
        'Add By Cheng 2002/12/10
        '若案件性質為發明(101), 新型(102), 設計(103), 改請(3xx), 異議(801), 才開放可修改案件性質
        Select Case cp(10)
        Case "101", "102", "103", "301", "302", "303", "304", "305", "306", "307", "801"
            Me.Text7(2).Enabled = True
        Case Else
            Me.Text7(2).Enabled = False
        End Select
        
      Text7(17) = cp(64)
      Text7(19) = cp(23)
      Text7(20) = cp(22)
      Text7(22) = cp(15)
      For i = 4 To 10
         Text5(i) = cp(32 + i)
      Next
      
      'Modify by Morgan 2008/10/16 +若進度檔已有代理人則預設
      'Modify by Morgan 2009/10/2
      '香港檢索報告不預設代理人
      'Modified by Morgan 2014/5/20 +分析 941(分文對象為客戶)
      'Modified by Morgan 2021/11/3 非台灣案才要預設(台灣案可能會給大陸代理人翻譯) Ex:P-126258
      If pa(9) <> "000" And Not (pa(9) = "013" And cp(10) = "421") And cp(10) <> "941" Then
         AddAgent Combo2, cp, , cp(44), cp(116)
      End If
      
      'Added by Lydia 2016/10/27 新案有申請人指定國外代理人檔則預設
      'Modified by Morgan 2021/11/3 非台灣案才要預設(台灣案可能會給大陸代理人翻譯) Ex:P-126258
      If pa(9) <> "000" And cp(31) = "Y" Then
         AddAgent Combo2, cp, , cp(44), , cp(9), pa(9), pa(26)
      End If
      'end 2016/10/27
      
      Text7(27).Enabled = False 'Added by Morgan 2019/4/8
      'Modified by Morgan 2013/5/14
      'txtCP118 = cp(118) 'Add by Morgan 2011/7/29
      txtCP118 = ""
      If cp(118) <> "" Then txtCP118 = "Y"
      'end 2013/5/14
      
      'Added by Morgan 2024/1/19 大陸案預設電子送件--郭
      'Removed by Morgan 2024/1/30 改分案預設--郭
'      If pa(9) = "020" Then
'         'Modified by Morgan 2024/1/25 有設定大陸P案要公文正本者預設紙本送件--郭
'         If PUB_GetCustomerValue(pa(26), "CU182") = "Y" Then
'            txtCP118 = ""
'         Else
'            txtCP118 = "Y"
'         End If
'      End If
      'end 2024/1/19
      
      'Added by Morgan 2012/10/9
      '新案發文時若為電子送件,當天發文其他案件性質也應為電子送件--玲玲
      If cp(118) = "" And pa(9) = 台灣國家代號 And InStr(NewCasePtyList, cp(10)) = 0 Then
         'Modify by Amy 2016/06/28 +if 排除 501 訴願/503 行政訴訟/803 舉發/804 舉發答辯,不設電子送件--雅娟
         If cp(10) = "501" Or cp(10) = "503" Or cp(10) = "803" Or cp(10) = "804" Then
            txtCP118 = ""
            txtCP118.Locked = True: txtCP118.Enabled = False
         Else
            strExc(0) = "select cp118 from caseprogress where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "'" & _
               " and cp27='" & strSrvDate(1) & "' and cp10 in (" & NewCasePtyList & ") and cp118 is not null"
            intI = 1
            Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
            If intI = 1 Then
               txtCP118 = "Y"
            End If
         End If
         'end 2016/06/28
      End If
      'end 2012/10/9
      
      'Added by Morgan 2013/5/14 102/6/1 起電子送件一率自動扣款(A)若超過3點半發文則須人工輸入是否當日扣款
      txtPayToday = ""
      If strSrvDate(1) >= 20130601 And pa(9) = 台灣國家代號 Then
         txtPayToday.Visible = True
         lblPayToday.Visible = True
         If txtCP118 = "Y" Then
            If Val(ServerTime) <= 153000 Then
               txtPayToday = "Y"
            End If
         End If
      Else
         txtPayToday.Visible = False
         lblPayToday.Visible = False
      End If
      'end 2013/5/14
   End If
   
    'Added by Lydia 2021/05/25
    txtCP113 = ""
    If cp(113) <> "" Then txtCP113 = cp(113)
    'end 2021/05/25
    
    'Add By Cheng 2003/01/03
    '若台灣案且案件性質為補換發證書
    If pa(9) = 台灣國家代號 And cp(10) = 補換發證書 Then
        Frame1.Visible = True
    End If
    
    'Added by Lydia 2025/02/12 P臺灣與大陸案若申請延緩審查，請於發文時讓user輸入延緩審查日期
    txtCP71 = cp(71)
    m_CP416forCP07 = "" '實審的法限
    strExc(0) = "select cp07 from caseprogress where cp01='" & pa(1) & "' and cp02='" & pa(2) & "' and cp03='" & pa(3) & "' and cp04='" & pa(4) & "' and cp10='416' and cp159=0 "
    intI = 1
    Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
    If intI = 1 Then
       m_CP416forCP07 = "" & RsTemp.Fields("cp07")
    End If
    If pa(1) = "P" And cp(10) = "245" Then
       lblCP71.Visible = True
       txtCP71.Visible = True
       If pa(9) = 台灣國家代號 Then
          txtCP71 = TransDate(cp(71), 1)
       End If
    Else
       lblCP71.Visible = False
       txtCP71.Visible = False
    End If
    txtCP71.Tag = txtCP71.Text
    'end 2025/02/12
    
   ChkCp10
   
   'Modify By Cheng 2002/07/11
   '以總收文號+本所案號+下一程序代號(998)抓下一程序檔中"是否續辦"為NULL, 帶出法定期限於畫面上的提申期限欄,若有資料此欄不可修改
   '若無資料, 利用GetCaseFee函式計算出提申期限, 此欄可修改可空白
   'Modify by Morgan 2009/6/1
   '產生指示信時若有輸入最終提申期限或指定提申日時會新增提申期限
   StrSQLa = "SELECT NP09,NP07 FROM NEXTPROGRESS WHERE NP01='" & strReceiveNo & "' AND NP02='" & pa(1) & "' AND NP03='" & pa(2) & "' AND NP04='" & pa(3) & "' AND NP05='" & pa(4) & "' AND NP07 IN ('995','996') AND NP06 IS NULL AND NP09>0"
   If rsA.State <> adStateClosed Then rsA.Close 'Add By Sindy 2014/12/9
   rsA.CursorLocation = adUseClient
   rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
   If rsA.RecordCount > 0 Then
      Do While Not rsA.EOF
         If rsA("NP07") = "996" Then
            Text7(3).Text = "" & (Val(rsA.Fields("NP09").Value) - 19110000)
            Text7(3).Enabled = False
         ElseIf rsA("NP07") = "995" Then
            Text7(28).Text = "" & (Val(rsA.Fields("NP09").Value) - 19110000)
            Text7(28).Enabled = False
         End If
         rsA.MoveNext
      Loop
   End If
   If rsA.State <> adStateClosed Then rsA.Close
   Set rsA = Nothing
   
   'Modify by Morgan 2009/8/3
   '不必判斷最終提申期限但催審期限仍要預設
   'If Text7(3) = "" Then
      'Modify by Morgan 2009/8/4
      'GetCaseFee pa(1), pa(9), cp(10)
      If Val(Text7(0)) > 0 And Text7(2) <> "" Then
         PUB_SetChkResultDate pa(1), pa(9), Text7(2), Text7(0), Text7(11), cp, pa(8)
         Text7(2).Tag = Text7(2)
         Text7(0).Tag = Text7(0)
         'Added by Morgan 2012/12/21
         '台灣申請寄存催審期限不可小於系統日+10個日曆天
         If Text7(11) <> "" And pa(1) = "P" And pa(9) = "000" And cp(10) = "108" Then
            strExc(1) = CompDate(2, 10, strSrvDate(1))
            If DBDATE(Text7(11)) < DBDATE(strExc(1)) Then
               MsgBox "台灣申請寄存催審期限不可小於系統日+10個日曆天,請修正!!!", vbExclamation
            Else
               Text7(11).Enabled = False
               lblCaseFee.Visible = False
               lblCaseFees.Visible = False
            End If
         End If
         'end 2012/12/21
      End If
   'End If
   Text7(3).Enabled = False
   Text7(28).Enabled = False
   'end 2009/6/1
   
   If pa(1) = "P" Then
      i = 專利
   Else
      i = 0
   End If

   'edit by nickc 2007/02/02 不用 dll 了
   'If Not objPublicData.ReadPriority(pA, strPriority(1), strPriority(2), strPriority(3)) Then
   'Modify by Amy 2014/04/08 +strPriority(5)
   If Not ClsPDReadPriority(pa, strPriority(1), strPriority(2), strPriority(3), strPriority(4), strPriority(5)) Then
   
   End If
  
   'Added by Morgan 2018/4/27 整合下面規則
   'C類不印通知函
   If cp(9) > "C" Then
      Text7(21) = "N": Text7(21).Enabled = False
   'B類預設不印通知函(有例外)--2018/4/27 玲玲
   'modify by sonia 2019/3/20 243補書狀要出定稿
   'modify by sonia 2019/4/18 +244補中文說明書
   ElseIf cp(9) > "B" And cp(10) <> 言詞辯論 And cp(10) <> "243" And cp(10) <> "244" Then
      '204修正的相關收文號為1225依職權電話通知修正時預設要印通知函
      If cp(10) = "204" And cp(43) <> "" Then
         'Modified by Morgan 2024/5/15 +判斷正常發文日的才預設有通知函 Ex:P-126616 --品薇
         strExc(0) = "select 1 from caseprogress where cp09='" & cp(43) & "' and cp10='1225' and cp27>=cp05"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 0 Then
            Me.Text7(21) = "N"
         End If
      'add by sonia 2019/4/12 承辦人為程序之報告客戶956,且相關總收文號為言詞辯或準備程序時要出電子筆錄定稿
      ElseIf cp(10) = "956" Then
         strExc(0) = "select 1 from staff,caseprogress where st01='" & Text7(1) & "' and st03='P12' and cp09='" & cp(43) & "' and cp10 in ('211','212')"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 0 Then
            Me.Text7(21).Text = "N"
         End If
      'end 2019/4/12
      Else
         Text7(21) = "N"
      End If
   'Added by Lydia 2025/10/27 各專業部的智財協作發文，都預設不出定稿
   ElseIf pa(1) = "PS" And cp(10) = "967" Then
      Text7(21) = "N"
   End If
   'end 2018/4/27
  
   ' 90.07.05 modify by louis
   If pa(9) < "010" Then
      'Add by Morgan 2005/5/17
      '指示信控制
      lblLetter(2).Visible = False: Text7(25).Visible = False: Text7(25) = "N"
      lblLetter(3).Visible = False: Text7(26).Visible = False: Text7(26) = ""
      '申請書控制
      lblLetter(4).Visible = True: Text7(9).Visible = True: Text7(9).Enabled = False: Text7(9) = "N"
      lblLetter(5).Visible = True: Text7(10).Visible = True: Text7(10).Enabled = False: Text7(10) = ""
      '列印申請書
     
      'Modified by Morgan 2013/7/9 加註聯合 603 改預設不要出申請書但可選擇要出--敏惠
      If Me.Text7(2).Text = "608" Or Me.Text7(2).Text = "602" Then
         Text7(9).Enabled = True: Text7(9) = ""
         Text7(10).Enabled = True
      ElseIf Me.Text7(2).Text = "603" Then
         Text7(9).Enabled = True
         Text7(10).Enabled = True
      End If
      '2005/5/17 end
      
'Removed by Morgan 2018/4/27 統一放上面
'      'Add by Morgan 2009/10/6
'      'C類來函發文不印通知函
'      If cp(9) > "C" Then
'         Text7(21) = "N": Text7(21).Enabled = False
'      Else
'      'end 2009/10/6
      
         Select Case cp(10)
            'Modify by Morgan 2010/6/23 改請聯合 305 改預設要出通知函
            'Modified by Morgan 2013/7/9 加註聯合 603 改預設要出通知函--敏惠
            'Modified by Lydia 2025/06/13 衍生設定案125預設不出通知函--韻丞
            Case "101", "102", "103", "602", "301", "302", "303", "304", "306", "307", "117", "933", "125"
               ' 是否列印通知函預設為N
               Text7(21) = "N": Text7(21).Enabled = False
            
            Case Else:
               
         End Select
         'Add by Amy 2014/08/26 P台灣案 不可修改客戶通知函-for 電子化
         If pa(1) = "P" Then
            txtEditInf.Enabled = False
         End If
         'end 2014/08/26
         
'      End If 'Removed by Morgan 2018/4/27
      
   'Add by Morgan 2004/6/7
   Else
      
      'Added by Morgan 2016/6/22 非臺灣案電子化
      If 內專全面電子化啟用日 <= Val(strSrvDate(1)) And Left(Pub_StrUserSt03, 1) <> "F" Then
         txtEditInf.Enabled = False
      End If
      'end 2016/6/22
      
      'Add by Morgan 2005/5/17
      '指示信控制
      lblLetter(2).Visible = True: Text7(25).Visible = True: Text7(25).Enabled = False: Text7(25) = "N"
      lblLetter(3).Visible = True: Text7(26).Visible = True: Text7(26).Enabled = False: Text7(26) = ""
      
      'Add by Amy 2014/07/25 大陸案優先權存取碼發文時需列印指示信
      'Modified by Morgan 2025/5/16 +專利權評價報告423(順便補承辦人是程序的條件以防萬一)
      'If pa(9) = "020" And Text7(2) = "436" Then
      If pa(9) = "020" And PUB_GetST03(cp(14)) = "P12" And (Text7(2) = "436" Or Text7(2) = "423") Then
        lblLetter(2).Visible = True: Text7(25).Visible = True: Text7(25).Enabled = True: Text7(25) = "": Text7(26).Enabled = True
      End If
      'end 2014/07/24
      
      '申請書控制
      lblLetter(4).Visible = False: Text7(9).Visible = False: Text7(9) = "N"
      lblLetter(5).Visible = False: Text7(10).Visible = False: Text7(10) = ""
      '列印指示信
      'Modify by Morgan 2005/5/24 加控制承辦人81002,73017才要
      'If Me.Text7(2).Text = "416" Then
      'Modify by Morgan 2006/1/2 加405申請優先權證明
      'Modified by Morgan 2013/10/23 考慮程序新人
      'If (Text7(2).Text = "416" Or Text7(2).Text = "405") And (cp(14) = "81002" Or cp(14) = "73017") Then
      'Modified by Morgan 2015/6/9 +承辦人掛外專程序組人員，則預設出指示信
      'Modified by Morgan 2025/5/13 工作重分，品薇也算程序組人員
      'If (Text7(2).Text = "416" Or Text7(2).Text = "405") And (PUB_GetST05(cp(14)) = "75" Or PUB_GetST03(cp(14)) = "F22") Then
      If (Text7(2).Text = "416" Or Text7(2).Text = "405") And (PUB_GetST03(cp(14)) = "P12" Or PUB_GetST03(cp(14)) = "F22") Then
         'Modified by Morgan 2025/2/6 +內專改判段有申請案號才要出指示信(敏莉說寰華案維持原設定,因PCT進大陸有可能新案已提申但還沒來申請號時就要提實審)
         'Text7(25) = ""
         If pa(11) <> "" Or PUB_GetST03(cp(14)) = "F22" Then
            Text7(25) = ""
         End If
         'END 2025/2/6
      'end 2013/10/23
         Text7(25).Enabled = True
         Text7(26).Enabled = True
'Remove by Morgan 2006/7/10
'      'Modify by Morgan 2006/6/21 香港902回覆代理人
'      ElseIf pA(9) = "013" And Text7(2).Text = "902" Then
'         '相關總收文號案件性質為421申請檢索報告
'         If GetCP10(cp(43)) = "421" Then
'            Text7(25).Enabled = True: Text7(25) = ""
'            Text7(26).Enabled = True
'         End If
'      'end 2006/6/21
      End If
      '2005/5/17 end
      
'Removed by Morgan 2018/4/27 合併到上面
'      'Add by Morgan 2009/10/6
'      'C類來函發文不印通知函
'      If cp(9) > "C" Then
'         Text7(21) = "N": Text7(21).Enabled = False
'      '2010/4/8 ADD BY SONIA 大陸案B類收文預設不印通知函
'      'Modified by Morgan 2017/4/24 +PCT(056) --品薇
'      ElseIf cp(9) > "B" And (pa(9) = "020" Or pa(9) = "056") Then
'         Text7(21) = "N"
'      '2010/4/8 END
'      Else
'      'end 2009/10/6
'end 2018/4/27
      
         Select Case cp(10)
            'modify by sonia 2015/12/11 玲玲說+超頁費(938)超項費(939)
            Case "901", "938", "939"
               ' 是否列印通知函預設為N
               Text7(21) = "N": Text7(21).Enabled = False
            Case Else:
         End Select
         
'      End If 'Removed by Morgan 2018/4/27

   End If
   
   'Added by Morgan 2014/5/2
   'Modified by Morgan 2014/7/1 不限定台灣案,所有都適用;+942
   Select Case cp(10)
      '預設不出通知函但可改要出--玲玲
      'Modified by Morgan 2024/5/10 +912 諮詢／評估分析 Ex:P-133450 --茹曣
      Case "106", "121", "123", " 209", "210", "211", "225", "226", "232", "901", "902", "903", "904", "909", "911", "920", "927", "933", "941", "942", "912"
         Text7(21) = "N"
         'Added by Morgan 2015/3/4 --跟郭確認過
         '控制台灣分析不出定稿，要工程師出且跑掛號流程
         'Modified by Morgan 2016/7/20 非臺灣案電子化
         'If pa(9) = "000" And cp(10) = "941" Then
         If cp(10) = "941" Then
            Text7(21).Enabled = False
         End If
         'end 2015/3/4
      
      'Added by Morgan 2015/4/10
      Case Else
         'Added by Morgan 2016/11/1 國外部的”新案翻譯”201其實都不用出定稿 -- 品薇
         If Left(cp(12), 1) = "F" And cp(10) = "201" Then
            Text7(21) = "N"
         Else
         'end 2016/11/1
            SetCustLetter
         End If 'Added by Morgan 2016/11/1

      'end 2015/4/10
            
   End Select
   'end 2014/5/2
            
   'Add By Cheng 2002/06/24
   '若申請案號欄有資料時, 此欄設成Disable
   If Me.Text7(24).Text <> "" Then
      Me.Text7(24).Enabled = False
   End If
   
   'Add By Cheng 2002/07/12
   '顯示案件國家收費表的主管機關於畫面上
   StrSQLa = "Select CF10 FROM CASEFEE WHERE CF01='" & pa(1) & "' AND CF02='" & pa(9) & "' AND CF03='" & cp(10) & "'"
   If rsA.State <> adStateClosed Then rsA.Close
   Set rsA = Nothing
   rsA.CursorLocation = adUseClient
   rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
   If rsA.RecordCount > 0 Then
      Me.Text7(12).Text = "" & rsA.Fields(0).Value
   End If
   If rsA.State <> adStateClosed Then rsA.Close
   Set rsA = Nothing
   
'Removed by Morgan 2018/4/27 合併到上面
'    'Add By Cheng 2002/12/12
'    '若案件性質為回覆代理人(902), 補文件(202), 則是否列印通知函預設為"N"
'    'Modified by Morgan 2015/2/10 台灣鑑定報告改要出定稿
'    'moidfy by sonia 2017/2/7 玲玲說908代辦退費發文請預設為不出定稿
'    If cp(10) = 回覆代理人 Or cp(10) = 補文件 Or cp(10) = 退費 Or (pa(9) <> "000" And cp(10) = 鑑定報告) Then
'        Me.Text7(21).Text = "N"
'
'    'Add by Morgan 2008/10/28 B類的修正,申復,補正,陳述意見,退費預設不印通知函
'    'Modify by Morgan 2008/11/24 +主動修正203 --玲玲
'    'Modified by Morgan 2012/4/26 +電話聯絡單945--玲玲
'    ElseIf Left(cp(9), 1) = "B" And (cp(10) = "204" Or cp(10) = "205" Or cp(10) = "908" Or cp(10) = "203" Or cp(10) = "945") Then
'      'Modify by Morgan 2010/7/22 204修正的相關收文號為1225依職權電話通知修正時預設要印通知函
'      'Me.Text7(21).Text = "N"
'      If cp(10) = "204" And cp(43) <> "" Then
'         strExc(0) = "select 1 from caseprogress where cp09='" & cp(43) & "' and cp10='1225'"
'         intI = 1
'         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
'         If intI = 0 Then
'            Me.Text7(21).Text = "N"
'         End If
'      Else
'         Me.Text7(21).Text = "N"
'      End If
'      'end 2010/7/22
'    End If
'   '92.9.20 add by sonia
'   'Modify by Morgan 2006/4/11 開庭會從進度檔上發文日,避免又產生內部收文,故這裡發文的都要出通知函--玲玲
'   'If cp(9) > "B" And (cp(10) = 準備程序 Or cp(10) = 言詞辯論) Then
'   '    Me.Text7(21).Text = "N": Text7(21).Enabled = False
'   'End If
'   '2006/4/11 end
'   '92.9.20 end
'end 2018/4/27

   'Add by Morgan 2004/7/19
   For i = 1 To 5
      If Text7(i + 3).Text <> "" Then
         txtAppID(i).Text = GetAppID(Text7(i + 3).Text, m_CU15(i), m_CU10(i))
         If txtAppID(i).Text <> "" Then txtAppID(i).Locked = True
         txtAppID(i).Tag = txtAppID(i).Text
      Else
         txtAppID(i).Locked = True
      End If
   Next
   '2012/8/1 add by sonia 若有銷帳則要扣除銷帳規費
   If Val(cp(77)) > 0 Then
      If GetCP77Detail(cp(9), m_Fee, m_Official) = True Then
         'Modified by Morgan 2016/6/8 沒規費 cp(17) 是空的會型態錯誤
         'cp(17) = cp(17) - m_Official
         cp(17) = Val(cp(17)) - m_Official
      End If
   End If
   '2012/8/1 end
   
   'Added by Morgan 2013/1/10
   m_bol107NewFee = True
   m_bolDelay = False
   'end 2013/1/10
   
   'Add by Morgan 2004/9/8 檢查是否有延期，若有則規費預設0
   'Modified by Morgan 2013/1/10
   'If PUB_ChkDelay(strReceiveNo) = True Then
   If PUB_ChkDelay(strReceiveNo, m_strDelayCP09, strExc(1)) = True Then
      m_bolDelay = True
      If strExc(1) < "20130101" Then m_bol107NewFee = False
   'end 2013/1/10
   
      'modify by sonia 2014/4/8 改為不預設0,只扣除延期的發文規費(P-096463之再審發文,延期未繳規費)
      'cp(17) = "0"
      strExc(0) = "select cp84 from caseprogress where cp09='" & m_strDelayCP09 & "'"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         cp(17) = Val(cp(17)) - Val("" & RsTemp("cp84"))
      End If
      '2014/4/8 end
   End If
   
   txtCP84.Tag = cp(17) 'Add by Morgan 2004/8/11
   
   'Added by Lydia 2022/05/23 法律所案源：取得案源類別、發文規費、email加註
   m_LOS15 = cp(162)
   '限制B2類發文規費; 只需考慮B2類, A類不會有PT案,B1類PT案不會繳規費, C類已取消(有也是照原來規則不必改)
   'Memo by Lydia 2022/09/16 模組回傳m_LOS02
   m_LosCP84 = PUB_GetLosCP84(m_LOS15, pa(1), pa(2), pa(3), pa(4), "B2", m_LOS02, m_LosMemo)
   'end 2022/05/23
      
   'Added by Morgan 2012/4/24
   If cp(1) = "P" And cp(10) = "123" Then
     ' lblFavDt.Visible = True
      txtFavDt.Visible = True
      CmdFav.Visible = True 'Add by Lydia 2015/02/02
   Else
     ' lblFavDt.Visible = False
      txtFavDt.Visible = False
      CmdFav.Visible = False 'Add by Lydia 2015/02/02
   End If
   'end 2012/4/24
   
   'Added by Morgan 2012/11/14
   'Modified by Morgan 2020/2/3 +只限台灣案--陳玲玲 Ex:P119886
   If cp(10) = "413" And pa(9) = "000" Then
      'Modified by Morgan 2025/3/14 改用函數檢查
      'strExc(1) = PUB_GetFirstPriDate(cp)
      'If strExc(1) = "" Then strExc(1) = DBDATE(pa(10))
      'strExc(2) = CompDate(1, 15, strExc(1))
      'If strSrvDate(1) > strExc(2) Then
      '   MsgBox "已超過申請日(優先權日)起算15個月！", vbExclamation
      'End If
      PUB_ChkTW413 cp(43)
      'end 2025/3/14
   End If
   'end 2012/11/14
   
   'add by sonia 2016/5/3
   If pa(9) = "000" And cp(10) = "405" Then
      MsgBox "若是使用於法國，請務必於申請書上加註申請人英文姓名，並註明：此優先權證明書為申請法國專利之用，故申請人請加註英文姓名！", vbExclamation
   End If
   'end 2016/5/3
End Sub

'Add by Morgan 2004/7/23
Private Sub SetAD(ByVal i As Integer)
   Dim strAD10 As String, strCU15 As String
   txtAD(i).Enabled = False
   txtAD(i).Tag = ""
   txtAD(i).Text = ""
   If Text7(i + 3).Text <> "" And pa(9) = "000" Then
      txtAD(i).Text = PUB_GetAD03(Text7(i + 3).Text, pa(9), strAD10, strCU15)
      txtAD(i).Tag = txtAD(i).Text
      '個人只可設定自然人(1)
      If strCU15 = "0" Then
         txtAD(i).Text = "1"
      'Added by Morgan 2014/7/15 學校也預設--玲玲
      ElseIf strCU15 = "2" Then
         txtAD(i).Text = "2"
      'end 2014/7/15
      '公司
      Else
         If txtAD(i).Text = "Y" Then
            txtAD(i).Text = strAD10
            txtAD(i).Tag = txtAD(i).Text
         End If
         txtAD(i).Enabled = True
      End If
   End If
End Sub
'Add by Morgan 2004/7/19
Private Function GetAppID(ByVal stAppNo As String, ByRef stAppType As String, ByRef stAppNation As String) As String
   stAppNo = stAppNo & "0000"
On Error GoTo ErrHnd
   strSql = "SELECT CU10,CU11,CU15 FROM CUSTOMER WHERE CU01='" & Left(stAppNo, 8) & "' AND CU02='" & Mid(stAppNo, 9, 1) & "'"
      
   CheckOC
   adoRecordset.CursorLocation = adUseClient
   adoRecordset.Open strSql, cnnConnection, adOpenStatic, adLockReadOnly
   If adoRecordset.RecordCount > 0 Then
      stAppType = "" & adoRecordset.Fields("CU15")
      GetAppID = "" & adoRecordset.Fields("CU11")
      stAppNation = "" & adoRecordset.Fields("CU10")
   End If
   
ErrHnd:
   If Err.NUMBER <> 0 Then MsgBox Err.Description, vbCritical
   CheckOC

End Function

Private Sub ChkCp10()
 Dim bolChk As Boolean
   bolChk = False
   Select Case Text7(2)
      'Modify by Morgan 2005/11/15
      'Case "101", "102", "103", "104", "105"
      'Modified by Morgan 2012/7/2 +回復優先權主張124
      'Modify by Amy 2014/04/08 +補優先權存取碼237
      Case "106", "121", "124", "237"
         Command2(1).Enabled = True
         bolChk = True
         
      Case Else
         Command2(1).Enabled = False
         If Left(Text7(2), 1) = "3" Then bolChk = True
   End Select
   
   'Added by Lyda 2023/06/15 「414恢復權利-主張優先權106」需要輸入優先權
   If bolChk414for106 = True Then
      Command2(1).Enabled = True
      bolChk = True
   End If
   'end 2023/06/15
   
   If bolChk Then
      'Modify by Morgan 2005/7/19 不用控制
      'Text7(23).Enabled = True
      
      Text7(24).Enabled = True
   Else
      'Modify by Morgan 2005/7/19 不用控制
      'Text7(23).Enabled = False
      
      'Text7(23) = ""
      Text7(24).Enabled = False
      'Text7(24) = ""
   End If
End Sub

'Remove by Morgan 2009/8/4
'Private Sub GetCaseFee(ByVal CF01 As String, ByVal CF02 As String, ByVal CF03 As String)
'   strExc(0) = "SELECT CF05,CF11 FROM CASEFEE WHERE CF01='" & CF01 & "' AND " & _
'      "CF02='" & CF02 & "' AND CF03='" & CF03 & "'"
'   intI = 1
'   Set RsTemp = ClsLawReadRstMsg(intI, strExc(0)) 'edit by nickc 2007/02/05 不用 dll 了 objLawDll.ReadRstMsg(intI, strExc(0))
'   If intI = 1 Then
'      If RsTemp.Fields(0) > 0 Then
'         Text7(11) = TransDate(CompDate(2, Val(RsTemp.Fields(0)), TransDate(Text7(0), 2)), 1)
'      End If
'
''Remove by Morgan 2009/6/1
''原提申期限改為最終提申期限，帶指示信設定的日期，一般提申期限改存檔時自動產生(沒有指定提申日才要)
''      If Not IsNull(RsTemp.Fields(1)) Then
''         'Modify By Cheng 2002/07/11
'''         Text7(3) = TransDate(CompDate(2, Val(rsTemp.Fields(1)), TransDate(Text7(0), 2)), 1)
''         If Me.Text7(3).Enabled Then Text7(3) = TransDate(CompDate(2, Val(RsTemp.Fields(1)), TransDate(Text7(0), 2)), 1)
''      End If
'
'   End If
'End Sub

Private Function ChgType(i As Integer) As Boolean
 Dim strTempName As String, bolTmp As Boolean
   ChgType = False
   Select Case i
      Case 0
         'Modify by Morgan 2010/8/10 百年蟲
         'If Not ChkDate(Text7(i)) Or Text7(i) > strSrvDate(2) Then
         '2011/12/8 MODIFY BY SONIA 發文日可輸系統日的下一個工作日
         'If Not ChkDate(Text7(i)) Or Val(Text7(i)) > Val(strSrvDate(2)) Then
         '   MsgBox "發文日期不正確或發文日大於系統日，請重新輸入 !", vbCritical
         If Not ChkDate(Text7(i)) Or DBDATE(Val(Text7(i))) > DBDATE(PUB_GetWorkDayAfterSysDate(Val(strSrvDate(1)))) Then
            MsgBox "發文日期不正確或發文日大於系統日下一個工作日，請重新輸入 !", vbCritical
         '2011/12/8 END
         Else
            'Modify by Morgan 2009/8/4
            'If Text7(2) <> ""  Then
            '   GetCaseFee pa(1), pa(9), Text7(2)
            'Modify By Sindy 2019/7/23
            'If Text7(2).Tag <> Text7(2) Then
            If Text7(0).Tag <> Text7(0) And Text7(0) <> "" Then
            '2019/7/23 END
               PUB_SetChkResultDate pa(1), pa(9), Text7(2), Text7(0), Text7(11), cp, pa(8)
               Text7(2).Tag = Text7(2)
            End If
            ChgType = True
         End If
      Case 1
         'Added by Lydia 2023/06/20 寰華案:承辦人為外專程序時,改為操作人員
         If m_bolFMP2 = True Then
            Text7(i) = GetFCPUser(Text7(i))
         End If
         'end 2023/06/20
         Label3(4) = GetStaffName(Text7(i), True)
         ChgType = True
      Case 2
         If pa(9) = 台灣國家代號 Then
            bolTmp = False
         Else
            bolTmp = True
         End If
         'edit by nickc 2007/02/02 不用 dll 了
         'If objPublicData.GetCaseProperty(pA(1), Text7(i), strTempName, BolTmp) Then
         If ClsPDGetCaseProperty(pa(1), Text7(i), strTempName, bolTmp) Then
            Label3(5) = strTempName
            ChgType = True
         End If
         
      Case 12
         strExc(1) = Combo2.Text
         
         'Add by Morgan 2008/2/21 加判斷是否為聯絡人
         If InStr(strExc(1), "-") > 0 Then
            If ClsPDGetContact(strExc(1), strTempName) Then
               Combo2 = strExc(1)
               Label3(6) = strTempName
               ChgType = True
            End If
         
         '若系統種類對照檔的SK03=0, 則代理人名稱抓中-->英-->日, 否則抓英-->中-->日
         ElseIf PUB_GetAgentName(pa(1), strExc(1), strTempName) Then
            Combo2.Text = strExc(1)
            Label3(6) = strTempName
            ChgType = True
         Else
            Label3(6) = ""
         End If
         
      Case 26, 27, 28, 29, 30
         strExc(1) = Text7(i - 22).Text
         'edit by nickc 2007/02/02 不用 dll 了
         'If objPublicData.GETCUSTOMER(strExc(1), strTempName) Then
         If ClsPDGetCustomer(strExc(1), strTempName) Then
            Text7(i - 22).Text = strExc(1)
            Label3(i - 17) = strTempName
            ChgType = True
         Else
            Label3(i - 17) = ""
         End If
   End Select
End Function

Private Sub lblCaseFee_Click()
   If Text7(2) <> "" Then
      strExc(1) = Text7(2)
      
      'Modify by Morgan 2009/9/10 實審要抓申請程序的審查天數
      If Text7(2) = "416" Then
         strExc(0) = "SELECT cp10 FROM caseprogress" & _
            " WHERE cp01='" & cp(1) & "' and cp02='" & cp(2) & "'" & _
            " and cp03='" & cp(3) & "' and cp04='" & cp(4) & "'" & _
            " and cp10 in ('101','102','103','301','302','303','307')" & _
            " and cp27>19221111 order by cp27 desc"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            strExc(1) = RsTemp.Fields(0)
         Else
            MsgBox "無法讀取發文申請程序！"
            Exit Sub
         End If
      End If
      'end 2009/9/10
      
      frm12040102_2.txtCF(1) = cp(1)
      frm12040102_2.txtCF(2) = pa(9)
      frm12040102_2.txtCF(3) = strExc(1)
      frm12040102_2.Show vbModal
      If Val(Text7(0)) > 0 Then
         PUB_SetChkResultDate pa(1), pa(9), Text7(2), Text7(0), Text7(11), cp, pa(8)
      End If
   End If
End Sub

Private Sub lblCaseFee_MouseDown(Button As Integer, Shift As Integer, x As Single, y As Single)
   PUB_LabelMouseDown lblCaseFee, lblCaseFees
End Sub

Private Sub lblCaseFee_MouseUp(Button As Integer, Shift As Integer, x As Single, y As Single)
   PUB_LabelMouseUp lblCaseFee, lblCaseFees
End Sub

'Add by Morgan 2005/7/13
'檢查並設定cp110資料
Private Sub lstNameAgent_Validate(Cancel As Boolean)
   Dim ii As Integer, bolCheck As Boolean
   bolCheck = False
   cp(110) = ""
   For ii = 0 To lstNameAgent.ListCount - 1
      If lstNameAgent.Selected(ii) = True Then
         'modify by sonia 2016/10/7 員工編號已可非數字需做轉換
         'cp(110) = cp(110) & "," & lstNameAgent.ItemData(ii)
         'Modified by Morgan 2021/12/14f Forms2.0 改用模組
         'cp(110) = cp(110) & "," & PUB_Num2Id(lstNameAgent.ItemData(ii))
         cp(110) = cp(110) & "," & PUB_GetItemData(lstNameAgent.Tag, ii)
         bolCheck = True
      End If
   Next
   If Left(cp(110), 1) = "," Then cp(110) = Mid(cp(110), 2)
   If bolCheck = True Then
      Text7(20) = ""
   Else
      Text7(20) = "N"
      If MsgBox("未勾選代理人，確定不出名？", vbYesNo + vbDefaultButton2 + vbInformation) = vbNo Then
         Cancel = True
      End If
   End If
End Sub

Private Sub Text5_GotFocus(Index As Integer)
   'Add by Morgan 2008/10/27
   Select Case Index
      Case 5, 7, 8, 10
         OpenIme
      Case Else
         CloseIme
   End Select
   'end 2008/10/27
   TextInverse Text5(Index)
End Sub

Private Sub Text7_Change(Index As Integer)
    Select Case Index
    Case 23 '是否郵寄申請
        'Add By Cheng 2003/03/18
        If Me.Text7(Index).Text = "Y" Then
            '設定列印通知函
            Me.Text7(21).Text = ""
            '2005/9/13 ADD BY SONIA
            If InStr(1, Text7(17), ",郵寄申請", 1) = 0 Then
               Text7(17) = Text7(17) & ",郵寄申請"
            End If
            '2005/9/13 END
        Else
            '設定不列印通知函
            Me.Text7(21).Text = "N"
            '2005/9/13 ADD BY SONIA
            If InStr(1, Text7(17), ",郵寄申請", 1) > 0 Then
               Text7(17) = Replace(Text7(17), ",郵寄申請", "")
            End If
            '2005/9/13 END
        End If
    'Add by Morgan 2004/7/23
    Case 4, 5, 6, 7
      SetAD Index - 3
    End Select
End Sub

Private Sub Text7_GotFocus(Index As Integer)
   'Add by Morgan 2008/10/27
   Select Case Index
      Case 12, 14, 16, 17, 18
         OpenIme
      Case Else
         CloseIme
   End Select
   'end 2008/10/27
   TextInverse Text7(Index)
End Sub

Private Sub Text7_KeyPress(Index As Integer, KeyAscii As MSForms.ReturnInteger)
   Select Case Index
      Case 1, 4, 5, 6, 7, 8
         KeyAscii = UpperCase(KeyAscii)
      'Modify by Morgan 2005/5/17 加26
      'Modify by Morgan 2008/11/10 加27
      Case 10, 23, 26, 27
         KeyAscii = UpperCase(KeyAscii)
         If KeyAscii <> 89 And KeyAscii <> 8 Then
            KeyAscii = 0
            Beep
         End If
      
      Case 19
         KeyAscii = UpperCase(KeyAscii)
         If (KeyAscii > 50 Or KeyAscii < 49) And KeyAscii <> 8 Then
            KeyAscii = 0
            Beep
         End If
         
      'Add by Morgan 2007/12/31  證明文件
      Case 13
         KeyAscii = UpperCase(KeyAscii)
         If KeyAscii <> Asc("Y") And KeyAscii <> Asc("N") And KeyAscii <> 8 Then
            KeyAscii = 0
            Beep
         End If
      
      'Modify by Morgan 2005/5/17 加25
      Case 9, 20, 21, 25
         KeyAscii = UpperCase(KeyAscii)
         If KeyAscii <> 78 And KeyAscii <> 8 Then
            KeyAscii = 0
            Beep
         End If
   End Select
End Sub

Private Sub Text7_LostFocus(Index As Integer)
Select Case Index
Case 2 '案件性質
   'Add By Cheng 2002/06/24
   If GetCF15("" & pa(1), "" & pa(9), "" & Text7(2).Text) Then
      If Me.Text7(19).Text = "" Then
         MsgBox "預估准駁不可為空白!!!", vbExclamation + vbOKOnly
         If Me.Text7(19).Enabled Then
            Me.Text7(19).SetFocus
            TextInverse Me.Text7(19)
         End If
         Exit Sub
      End If
   End If
   
   '若案件性質不介於"101"及"105間"
   'Modified by Morgan 2012/12/19 +衍生設計
   If Me.Text7(2).Text < "101" And Me.Text7(2).Text > "105" And Me.Text7(2).Text <> "125" Then
      If Me.Text7(24).Text = "" Then
         MsgBox "申請案號不可為空白!!!", vbExclamation + vbOKOnly
         If Me.Text7(24).Enabled Then
            Me.Text7(24).SetFocus
            TextInverse Me.Text7(24)
         End If
         Exit Sub
      End If
   End If
End Select
End Sub

Private Sub Text7_Validate(Index As Integer, Cancel As Boolean)
 Dim i As Integer
 'Add by Amy 2018/10/30
 Dim bolShowAddr As Boolean '是否彈修改地址畫面
 Dim strData As String
 
   Select Case Index
      Case 0 '發文日
         If Text7(Index) <> "" Then
            If ChgType(Index) = False Then
               Cancel = True
            'Added by Morgan 2013/11/28
            '當發文日有改時,電子送件案要人工輸入是否當日扣款 Ex.P-106998
            ElseIf Text7(0).Tag <> Text7(0) Then
               Text7(0).Tag = Text7(0)
               If txtCP118 = "Y" And pa(9) = 台灣國家代號 Then
                  txtPayToday.Visible = True
                  txtPayToday.Text = ""
               End If
               SetCustLetter 'Added by Morgan 2015/6/29
            'end 2013/11/28
            End If
         Else
            MsgBox "發文日不可空白 !", vbCritical
            Cancel = True
         End If
      Case 1
         If Text7(Index) <> "" Then
            If ChgType(Index) = False Then Cancel = True
         End If
      Case 2 '案件性質
         If Text7(Index) <> "" Then
            If cp(10) <> Text7(Index) Then
               Select Case Text7(Index)
                  Case "301", "302", "303", "304", "305", "306", "307", "803"
                     If ChgType(Index) Then
                        Command2(1).Enabled = False
                     Else
                        Cancel = True
                     End If
                  Case Else
                     MsgBox "案件性質只可為改請程序之案件性質或舉發 !", vbCritical
                     Text7(Index) = cp(10)
                     Cancel = True
               End Select
               'Add By Cheng 2003/01/03
               If pa(9) = 台灣國家代號 And Me.Text7(Index).Text = 補換發證書 Then
                    Me.Frame1.Visible = True
               Else
                    Me.Frame1.Visible = False
               End If
            Else
               'Modify by Morgan 2009/8/4
               'If IsEmptyText(Text7(2)) = False Then
               '   GetCaseFee pa(1), pa(9), Text7(2)
               If Text7(2) <> Text7(2).Tag And Val(Text7(0)) > 0 Then
                  PUB_SetChkResultDate pa(1), pa(9), Text7(2), Text7(0), Text7(11), cp, pa(8)
                  Text7(2).Tag = Text7(2)
               End If
            End If
         Else
            MsgBox "案件性質不可空白 !", vbCritical
            Cancel = True
         End If
      'Modify by Morgan 2009/5/14 +指定提申
      '提申期限
      Case 3, 28
         If Text7(Index) <> "" Then
            If Not ChkDate(Text7(Index)) Then
               MsgBox "日期不正確，請重新輸入 !", vbCritical
               Cancel = True
            End If
         End If
      Case 4, 5, 6, 7, 8 '申請人
         If Text7(Index) <> "" Then
            '2008/10/22 add by Toni
            '2008/11/10 modify by sonia 重新組即可,不必判斷
            'If Mid(Text7(Index).Text, 8, 1) <> Mid(strInventor(1), 8, 1) Then
            '   strInventor(1) = Text7(Index)
            'End If
            strInventor(1) = ""
            For i = 1 To 5
               If Text7(i + 3) <> "" Then strInventor(1) = strInventor(1) & Text7(i + 3) & ","
            Next
            If Right(strInventor(1), 1) = "," Then strInventor(1) = Left(strInventor(1), Len(strInventor(1)) - 1)
            '2008/11/10 end
            'end 2008/10/22
            If Not ChgType(Index + 22) Then Cancel = True
         Else
            Label3(Index + 5) = ""
         End If
         'Add By Cheng 2002/08/22
         If Cancel = False Then
            'Modify by Amy 2018/10/30 有修改申請人show 修改申請人地址畫面(改別的再改回需再show,基本檔才會更新)
'            Select Case Index
'            Case 4
'               If Me.Text7(Index).Text <> m_strCust1 Then
'                  If Not PUB_EditCustOk(Me.Label3(0).Caption, pa(1), pa(2), pa(3), pa(4)) Then Cancel = True
'               End If
'            Case 5
'               If Me.Text7(Index).Text <> m_strCust2 Then
'                  If Not PUB_EditCustOk(Me.Label3(0).Caption, pa(1), pa(2), pa(3), pa(4)) Then Cancel = True
'               End If
'            Case 6
'               If Me.Text7(Index).Text <> m_strCust3 Then
'                  If Not PUB_EditCustOk(Me.Label3(0).Caption, pa(1), pa(2), pa(3), pa(4)) Then Cancel = True
'               End If
'            Case 7
'               If Me.Text7(Index).Text <> m_strCust4 Then
'                  If Not PUB_EditCustOk(Me.Label3(0).Caption, pa(1), pa(2), pa(3), pa(4)) Then Cancel = True
'               End If
'            Case 8
'               If Me.Text7(Index).Text <> m_strCust5 Then
'                  If Not PUB_EditCustOk(Me.Label3(0).Caption, pa(1), pa(2), pa(3), pa(4)) Then Cancel = True
'               End If
'            End Select
            If Me.Text7(Index).Tag <> Me.Text7(Index).Text Then
                If Not PUB_EditCustOk(Me.Label3(0).Caption, pa(1), pa(2), pa(3), pa(4)) Then
                    Cancel = True
                Else
                    bolShowAddr = True
                    strData = Index - 3 & ";" & Me.Text7(Index).Text
                End If
            End If
            'end 2018/10/30
         End If
         
         'Add by Morgan 2004/9/14 檢查客戶/代理人是否不再使用
         If Cancel = False Then
            If PUB_CheckStatus(Text7(Index).Text) = False Then
                Cancel = True
                'Add by Amy 2018/10/30 修改申請人是否彈修改地址畫面
                If Index >= 4 And Index <= 8 Then bolShowAddr = False
            End If
         End If
         
         'Add by Morgan 2004/7/19
         If m_bolCheck = False Then
            If Cancel = False Then
               txtAppID(Index - 3).Text = GetAppID(Text7(Index).Text, m_CU15(Index - 3), m_CU10(Index - 3))
               txtAppID(Index - 3).Locked = False 'Add by Morgan 2004/10/20
               If txtAppID(Index - 3).Text <> "" Then txtAppID(Index - 3).Locked = True
               txtAppID(Index - 3).Tag = txtAppID(Index - 3).Text
            End If
         End If
         
      Case 11
         '鑑定報告
         If Text7(2) = 鑑定報告 And Combo2 <> "" Then
            If Text7(Index) = "" Then
               MsgBox "案件性質為鑑定報告且有發文代理人時，此欄不可為空白 !", vbCritical
               Cancel = True
            Else
               If Not CheckIsDate(Text7(Index)) Then
                  MsgBox "日期不正確，請重新輸入 !", vbCritical
                  Cancel = True
               End If
            End If
         End If
      Case 16
         If Text7(14) = "" And Text7(15) = "" And Text7(16) = "" Then
            MsgBox "案件名稱不可同時空白 !", vbCritical
            Text7(14).SetFocus
         End If
      Case 24 '申請案號
         i = 2
         If pa(9) = 台灣國家代號 Then
            i = 0
         Else
            If pa(9) = 大陸國家代號 And pa(46) <> "Y" Then
               i = 1
            End If
         End If
         If Text7(Index) <> "" And (i = 0 Or i = 1) Then
            '2005/6/14 MODIFY BY SONIA
            'If Not ChkAppNo(Text7(Index), Val(pa(8)), i) Then Cancel = True
            If Not ChkAppNo(Text7(Index), Val(pa(8)), i, Val(pa(23))) Then Cancel = True
            '2005/6/14 END
         End If
   End Select
   If Cancel = True Then
      TextInverse Text7(Index)
      Text7(Index).SetFocus 'Added by Morgan 2021/12/14
   End If
   'Add by Amy 2018/10/30
   If bolShowAddr = True Then
        Text7(Index).Tag = Text7(Index) '記錄每次修改,改回仍需存基本檔
        frm020102_23.Hide
        Set frm020102_23.UpForm = Me
        frm020102_23.m_CP09 = cp(9)
        frm020102_23.stModApply = strData
        frm020102_23.QueryData
        frm020102_23.Show vbModal
   End If
End Sub

'Add By Cheng 2002/03/08
Private Function CheckDataIntegrity() As Boolean
Dim Cancel As Boolean
   'add by nickc 2008/05/01
   If IsDebt(pa(9), cp(9)) Then
        MsgBox "未收款且無 預定收款日 請轉告智權同仁！！", vbOKOnly, "警告！禁止發文！"
        GoTo IntegrityOrNot
   End If
Cancel = False

   
'檢查代理人欄位
Combo2_Validate Cancel
If Cancel = True Then
   Me.Combo2.SetFocus
   GoTo IntegrityOrNot
End If
'Add By Cheng 2003/01/03
If pa(9) = 台灣國家代號 And Me.Text7(2).Text = 補換發證書 Then
    If Me.Option1(0).Value = False And Me.Option1(1).Value = False Then
        MsgBox "請點選補發或換發選項!!!", vbExclamation + vbOKOnly
        GoTo IntegrityOrNot
    End If
End If

CheckDataIntegrity = True
Exit Function

IntegrityOrNot:
CheckDataIntegrity = False
End Function

'Add By Cheng 2002/05/22
Private Function TxtValidate() As Boolean
Dim objTxt As Object
Dim ii As Integer, i As Integer
Dim Cancel As Boolean
'Add by Morgan 2004/7/20
Dim stAppNo As String   '未設定減免身分客戶代碼
'Added by Morgan 2016/11/29
Dim stLp33 As String, stLp34 As String, bolMakePdf As Boolean
Dim oFileSys As New FileSystemObject
Dim oFile As File
Dim bolChkPA165IsY As Boolean 'Add By Sindy 2014/7/4 'Modified by Morgan 2021/2/4 自 FormSave 移來
Dim bolCppCheck As Boolean, strErrMsg As String, strDelFileName As String 'Added by Morgan 2023/1/4

TxtValidate = False

   'Added by Morgan 2021/12/14 檢查畫面輸入欄位是否含有Unicode文字
   If PUB_ChkUniText(Me, , True, "TextBox") = False Then
       Exit Function
   End If
   'end 2021/12/14
   
For Each objTxt In Text7
   If objTxt.Enabled = True Then
      Cancel = False
      Text7_Validate objTxt.Index, Cancel
      If Cancel = True Then
         Me.Text7(objTxt.Index).SetFocus
         Text7_GotFocus objTxt.Index
         Exit Function
      End If
   End If
Next

'Added by Morgan 2022/5/12 Ex:P-110285 --陳玲玲
If pa(9) = "000" And Text7(2).Text = "908" Then
   If MsgBox("請確認退費後繳費年度及下一程序的期限管制是否正確！" & vbCrLf & vbCrLf & "【 是:繼續存檔   否:回畫面 】", vbExclamation + vbYesNo + vbDefaultButton2) = vbNo Then
      Exit Function
   End If
End If
'end 2022/5/12

'Add by Morgan 2008/8/21
'外專收文之P案翻譯核稿人檢查
If Left(cp(12), 1) = "F" And Text7(2).Text = "201" Then
   strExc(0) = "select ep04 from engineerprogress where ep02='" & cp(9) & "'"
   intI = 1
   Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
   If intI = 1 Then
      If IsNull(RsTemp.Fields(0)) Then
         MsgBox "請通知外專 Angela 補核稿人資料！", vbExclamation
         Exit Function
      End If
   End If
End If

'Add By Cheng 2002/06/24
'若案件收費表的下一救濟程序有資料
If GetCF15("" & pa(1), "" & pa(9), "" & Text7(2).Text) Then
   If Me.Text7(19).Text = "" Then
      MsgBox "預估准駁不可為空白!!!", vbExclamation + vbOKOnly
      If Me.Text7(19).Enabled Then
         Me.Text7(19).SetFocus
         TextInverse Me.Text7(19)
      End If
      Exit Function
   End If
End If
'若案件性質不介於"101"及"105間"
'Modified by Morgan 2012/12/19 +衍生設計
If Me.Text7(2).Text < "101" And Me.Text7(2).Text > "105" And Me.Text7(2).Text <> "125" Then
   If Me.Text7(24).Text = "" Then
      MsgBox "申請案號不可為空白!!!", vbExclamation + vbOKOnly
      If Me.Text7(24).Enabled Then
         Me.Text7(24).SetFocus
         TextInverse Me.Text7(24)
         Exit Function
      End If
   End If
End If

   'Add by Morgan 2004/7/19
   If pa(9) = "000" Then
      For ii = 1 To 5
         'Modify by Morgan 2004/7/29
         'If Text7(ii + 3).Text <> "" And m_CU10(ii) <= "010" Then
         If Text7(ii + 3).Text <> "" And m_CU10(ii) <= "010" And txtAD(ii).Text <> "2" Then
            If txtAppID(ii).Text = "" Then
               'Add by Morgan 2004/10/28 加確認對話框
               'MsgBox "申請人" & ii & " ID不可空白！", vbCritical
               If MsgBox("申請人" & ii & " ID確定要空白？", vbQuestion + vbYesNo + vbDefaultButton2) = vbNo Then
               '2004/10/28 end
                  SSTab1.Tab = 2
                  txtAppID(ii).SetFocus
                  Exit Function
               End If
            End If
         End If
      Next
   End If

   'Add by Morgan 2005/7/13
   If lstNameAgent.Visible = True Then
      Cancel = False
      lstNameAgent_Validate Cancel
      If Cancel = True Then
         lstNameAgent.SetFocus
         Exit Function
      End If
   End If
   
   'Added by Morgan 2015/6/30
   If txtCP118 = "Y" And pa(9) = 台灣國家代號 And Text7(20) = "N" Then
      MsgBox "電子送件不可不出名！", vbCritical
      Exit Function
   End If
   'end 2015/6/30

   'Add by Morgan 2004/8/11
   If txtCP84.Enabled = True Then
      Cancel = False
      txtCP84_Validate Cancel
      If Cancel = True Then
         txtCP84.SetFocus
         txtCP84_GotFocus
         Exit Function
      End If
   End If
   
   m_bChk939 = False 'Added by Morgan 2023/8/24
   'Add by Morgan 2010/1/5
   m_lngOverPageFeeDiff = 0
   m_lngOverItemFeeDiff = 0
   m_FeeMemo = ""
   If m_bolChkFee Then
      SetOfficialFee
      If Not CheckOfficialFee Then
         Exit Function
      End If
   End If
   'end 2010/1/5
   
      'Add by Morgan 2004/7/22
      'Modified by Morgan 2024/10/11 +判斷P案,因PS案沒有減免問題 Ex:PS-000503
      If pa(9) = "000" And pa(1) = "P" Then
         m_DiscType = ""
         For i = 1 To 5
            m_DiscType = m_DiscType & txtAD(i).Text
            If txtAD(i).Enabled = True Then
               If txtAD(i).Text = "" Then
                  MsgBox "申請人【" & Text7(i + 3) & "-" & Label3(i + 8) & "】減免身分不可空白", vbInformation
                  txtAD(i).SetFocus
                  txtAD_GotFocus i
                  Exit Function
               '公司可減免
               'Modify by Morgan 2004/7/29
               '學校不需證明
               'ElseIf (txtAD(i).Text = "2" Or txtAD(i).Text = "3") Then
               '學校
               ElseIf (txtAD(i).Text = "2") Then
                  '變更
                  If (txtAD(i).Tag <> "2" And txtAD(i).Tag <> "") Then
                     If MsgBox("確定要變更申請人【" & Text7(i + 3) & "-" & Label3(i + 8) & "】減免身分為【學校】？", vbInformation + vbYesNo + vbDefaultButton1) = vbNo Then
                        txtAD(i).SetFocus
                        txtAD_GotFocus i
                        Exit Function
                     End If
                  End If
               '公司
               ElseIf (txtAD(i).Text = "3") Then
                  '新增或變更
                  If (txtAD(i).Tag <> "3") Then
                     If MsgBox("申請人【" & Text7(i + 3) & "-" & Label3(i + 8) & "】的減免身分將設定為【中小企業】，確定有【證明文件】存放於本卷？", vbInformation + vbYesNo + vbDefaultButton1) = vbNo Then
                        txtAD(i).SetFocus
                        txtAD_GotFocus i
                        Exit Function
                     End If
                  End If
               '不可減免
               ElseIf (txtAD(i).Text = "N") Then
                  '身分變更
                  If (txtAD(i).Tag <> "N" And txtAD(i).Tag <> "") Then
                     If MsgBox("確定要變更申請人【" & Text7(i + 3) & "-" & Label3(i + 8) & "】減免身分為【不可減免】？", vbInformation + vbYesNo + vbDefaultButton1) = vbNo Then
                        txtAD(i).SetFocus
                        txtAD_GotFocus i
                        Exit Function
                     End If
                  End If
               End If
            End If
         Next
         If InStr(m_DiscType, "N") > 0 Then
            cp(81) = "N"
         Else
            cp(81) = "Y"
         End If
         'Added by Morgan 2012/10/26
         If Text7(2) = "921" And cp(81) = "Y" Then
            MsgBox "補繳減免年費發文，案件減免狀態必須為不可減免，請重新檢查申請人減免身分是否正確！", vbExclamation
            Exit Function
         End If
         'end 2012/10/26
      End If

   
   'Add by Morgan 2009/6/1
   If pa(9) <> "000" Then
      '檢查是否已有一般提申期限
      'Modify by Morgan 2009/11/11 +收達
      If PUB_ChkFileNP(cp(9), "'997','998'") Then
         MsgBox "下一程序已有一般提申或收達期限，不可作業！"
         Exit Function
      End If
      
      'Add by Morgan 2009/12/17 回覆委任代理人發文要檢查相關收文號是否有掛一般提申期限
      If Text7(2) = "936" And cp(43) <> "" And cp(43) < "C" Then
         'Modify By Sindy 2014/7/24
         If str950CP43 <> "" Then
            If PUB_ChkFileNP(str950CP43, "'998'") Then
               MsgBox "相關收文號下一程序已有一般提申期限，不可作業！"
               Exit Function
            End If
         Else
         '2014/7/24 END
            If PUB_ChkFileNP(cp(43), "'998'") Then
               MsgBox "相關收文號下一程序已有一般提申期限，不可作業！"
               Exit Function
            End If
         End If
      End If
   
      If Text7(28) <> "" And Text7(3) <> "" Then
         MsgBox "已有最終提申期限不可再輸入指定提申日！"
         If Text7(3).Enabled = True Then
            Text7(3).SetFocus
         End If
         Exit Function
      End If
      If cp(7) <> "" Then
         If Text7(3) <> "" Then
            If Val(DBDATE(Text7(3))) > Val(DBDATE(cp(7))) Then
               MsgBox "最終提申期限不可晚於法定期限！"
               If Text7(3).Enabled = True Then
                  Text7(3).SetFocus
               End If
               Exit Function
            End If
         End If
         If Text7(28) <> "" Then
            If Val(DBDATE(Text7(28))) > Val(DBDATE(cp(7))) Then
               MsgBox "指定提申日不可晚於法定期限！"
               If Text7(28).Enabled = True Then
                  Text7(28).SetFocus
               End If
               Exit Function
            End If
         End If
      End If
   End If
   'end 2009/6/1
   
   'Add by Morgan 2009/11/11
   '非台灣新案有補件期限一定要檢核並更新期限
   If pa(9) <> "000" And InStr(CaseMapIn, Text7(2)) > 0 And m_si880017 <> 1 Then
      strExc(0) = "select 1 from dual where exists(select * from caseprogress where cp43='" & cp(9) & "' and cp10='202' and cp57 is null and cp27 is null)" & _
           " or exists(select * from nextprogress where np01='" & cp(9) & "' and np07||np06='202')"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         MsgBox "本收文號有補件期限，必須點選【補件期限】按鈕並確定！"
         Exit Function
      End If
   End If
   '若勾選要順稿則一定要輸順稿期限
   If Check1.Value = 1 Then
      If txtDate = "" Then
         MsgBox "若有勾選要順稿則一定要輸順稿期限！"
         txtDate.SetFocus
         Exit Function
      Else
         txtDate_Validate Cancel
         If Cancel = True Then
            txtDate.SetFocus
            Exit Function
         End If
      End If
   End If
   'end 2009/11/11
   
   'Add by Morgan 2010/5/3 若有選過發明人且申請人有變更時清除
   'Modify by Morgan 2010/6/24 申請案才要
   If InStr(NewCasePtyList, Text7(2)) > 0 Then
      If PUB_ChkInventor(strInventor(2), strInventor(1), True) = False Then
      End If
   End If
   'end 2010/5/3
   
   'Add by Morgan 2010/5/24
   '檢查相關案是否有保密審查未准
   If PUB_Exists430NotPassed(cp) Then
      Exit Function
   End If
   
   'Add by Morgan 2011/2/23
   '檢查申請人順序
   If Text7(4).Enabled = True Then
      If (Text7(5) <> "" And Text7(4) = "") Or _
         (Text7(6) <> "" And Text7(5) = "") Or _
         (Text7(7) <> "" And Text7(6) = "") Or _
         (Text7(8) <> "" And Text7(7) = "") Then
         MsgBox "請依順序輸入申請人！"
         If Text7(4) = "" Then Text7(4).SetFocus: Exit Function
         If Text7(5) = "" Then Text7(5).SetFocus: Exit Function
         If Text7(6) = "" Then Text7(6).SetFocus: Exit Function
         If Text7(7) = "" Then Text7(7).SetFocus: Exit Function
         Exit Function
      End If
   End If
   'Added by Morgan 2012/4/11
   If Text7(2) = "401" And Me.Tag <> "True" Then
      MsgBox "案件性質為[ " & Label3(5) & " ]，需先點變更事項並按確定！"
      cmdOK_Click 4
      Exit Function
   End If
   
   'Added by Morgan 2012/4/24
   If txtFavDt.Visible = True Then
      If txtFavDt = "" Then
         MsgBox "請輸入優惠期日期！", vbExclamation
         txtFavDt.SetFocus
         Exit Function
      ElseIf DBDATE(txtFavDt) <> DBDATE(pa(140)) Then
         MsgBox "優惠期日期與分案不同！", vbExclamation
         txtFavDt.SetFocus
         Exit Function
      End If
   End If
   'end 2012/4/24
   
   'Added by Morgan 2012/9/14
   m_bolUpdatePA161 = False
   'Removed by Morgan 2020/3/10 取消--郭
   'If cp(31) = "Y" And pa(161) = "" And (cp(110) = "94007" Or cp(110) = "94007,81040" Or cp(110) = "81040,94007") Then
   '   If MsgBox("本案是否確定以專利商標出名？", vbYesNo + vbDefaultButton2) = vbYes Then
   '      m_bolUpdatePA161 = True
   '   Else
   '      lstNameAgent.SetFocus
   '      Exit Function
   '   End If
   'End If
   'end 2020/3/10
   'end 2012/9/14
   
   'Added by Morgan 2012/12/21
   '台灣申請寄存催審期限不可小於系統日+10個日曆天
   If Text7(11) <> "" And pa(1) = "P" And pa(9) = "000" And Text7(2) = "108" Then
      strExc(1) = CompDate(2, 10, strSrvDate(1))
      If DBDATE(Text7(11)) < DBDATE(strExc(1)) Then
         MsgBox "台灣申請寄存催審期限不可小於系統日+10個日曆天,請修正!!!", vbExclamation
         Text7(11).SetFocus
         Exit Function
      End If
   End If
   'end 2012/12/21
   
   'Added by Morgan 2013/5/14
   If txtCP118 = "Y" And pa(9) = 台灣國家代號 And Val(txtCP84) > 0 Then
      If txtPayToday.Visible = True And txtPayToday = "" Then
         MsgBox "電子送件請輸入是否當日扣款(Y/N)！", vbExclamation
         txtPayToday.SetFocus
         Exit Function
      End If
   End If
   'end 2013/5/14
   
   'Add By Sindy 2014/7/9
   If Combo1.Enabled = True Then '台灣設計案且卷宗性質為1.申請時,才顯示案件屬性
      '申請日為空白或大於等於20140701時,必須輸入案件屬性
      If (Val(pa(10)) = 0 Or Val(DBDATE(pa(10))) >= 20140701) And Trim(Combo1.Text) = "" Then
         MsgBox "台灣設計案件屬性不可空白！", vbExclamation
         SSTab1.Tab = 2
         Combo1.SetFocus
         Exit Function
      Else
         If Combo1.Enabled = True Then
            Cancel = False
            Combo1_Validate Cancel
            If Cancel = True Then
               Exit Function
            End If
         End If
      End If
   End If
   '2014/7/9 END
      
   'Added by Lydia 2021/05/25 ACS智財顧問專業分配比例管制：有相關卷號(CaseRelation1)為ACS且曾有收文智財顧問112
   If Pub_ChkACS112isNull(pa(1), pa(2), pa(3), pa(4), txtCP113) = True Then
         SSTab1.Tab = 2
         txtCP113.SetFocus
         txtCP113_GotFocus
         Exit Function
   End If
   'end 2021/05/25
   'Added by Lydia 2023/11/17 針對PS及CPS之智財協作967，請一定要輸入工作時數才可過
   If pa(1) = "PS" And cp(10) = "967" And Val(Trim(txtCP113)) <= 0 Then
      MsgBox "智財協作，請一定要輸入工作時數"
      SSTab1.Tab = 2
      txtCP113.SetFocus
      txtCP113_GotFocus
      Exit Function
   End If
   'end 2023/11/17
   
   'Added by Morgan 2014/12/15
   bolAuto941Case = False
   strAuto941RefFileName = ""
   strOldFileName = "" 'Added by Morgan 2015/3/17
   strNewFileName = "" 'Added by Morgan 2015/3/17
   'bolNoPost = False 'Added by Morgan 2015/7/8 Removed by Morgan 2018/12/10
   'P台灣案舉發及舉發答辯審定書之內部收文分析發文時要將定稿歸到相關收文號並上發文日,且改為要通知定稿
   'Modified by Morgan 2016/7/15 非臺灣案電子化
   'Modified by Morgan 2018/11/7 +956報告客戶
   'If pa(9) = "000" And cp(10) = "941" Then
   'Modified by Morgan 2018/12/10 改規則與CFP相同(AB類都詢問1.是否寄通知函 2.通知函是否掛號)
   bolPost = False
   bolRegMail = False
   'Modified by Morgan 2019/4/8 FMP案除外--郭
   'If Left(Pub_StrUserSt03, 1) <> "F" And Text7(21) = "N" And (cp(9) > "C" Or InStr("941,903,956,927", cp(10)) > 0) And Text7(0) <> "111111" Then
   'Modified by Morgan 2024/5/10 +912 諮詢／評估分析 Ex:P-133450 --茹曣
   If m_bolFMP = False And Text7(21) = "N" And (cp(9) > "C" Or InStr("941,903,956,927,912", cp(10)) > 0) And Text7(0) <> "111111" Then
      'Added by Morgan 2018/12/10
      'C類都要報告(掛號,有例外-存檔控制)
      If cp(9) > "C" Then
         bolPost = True
         bolRegMail = True
         
      'AB類
      Else
'Modified by Morgan 2022/9/2 改一律不掛號並由智權同仁自行決定寄送給客戶的方式--郭
'         'Modified by Morgan 2022/5/20 判斷是否全E化調整訊息
'         strExc(1) = "是否寄通知函給客戶?"
'         strExc(2) = "通知函是否掛號直寄?"
'         'Modified by Morgan 2022/6/17 改用個案函數判斷
'         'If PUB_ChkECust(pa(26), pa(1), , intI) = True Then
'         '   If intI = 1 Then
'         If PUB_ChkECustCase(cp(1), cp(2), cp(3), cp(4)) = True Then
'            strExc(1) = "是否要 EMail 通知函給客戶?" & vbCrLf & vbCrLf & "※本案為全E化客戶案件!!"
'            strExc(2) = "通知函是否要確收?" & vbCrLf & vbCrLf & "※原紙本掛號直寄則為要確收!!"
'            'End If
'         End If
'         'end 2022/6/17
'         If MsgBox(strExc(1), vbYesNo + vbQuestion + vbDefaultButton1) = vbYes Then
'            bolPost = True
'            If MsgBox(strExc(2), vbYesNo + vbQuestion + vbDefaultButton1) = vbYes Then
'               bolRegMail = True
'            End If
'         End If
'         'end 2022/5/20
         bolPost = True
'end 2022/9/2
      End If
      
      If bolPost Then
      'end 2018/12/10
         strExc(1) = pa(1) & Val(pa(2)) & IIf(pa(3) & pa(4) = "000", "", "-" & pa(3) & "-" & pa(4))
         'Modified by Morgan 2017/8/29
         'strNewFileName = strExc(1) & ".941.CUS.PDF" 'Added by Morgan 2015/3/17
         strNewFileName = strExc(1) & "." & cp(10) & ".CUS.PDF"
         'end 2017/8/29
         
         strErrMsg = ""
         If cp(10) = "941" Then
         'end 2016/7/15
            If cp(9) > "B" And cp(43) > "C" Then
               'Modified by Morgan 2015/3/17
               'strExc(0) = "select b.cp10,cpp02 from caseprogress a,caseprogress b,caseprogress c,casepaperpdf where a.cp09='" & cp(9) & "' and b.cp09(+)=a.cp43 and b.cp10 in ('1001','1002','1503') and b.cp27 is null and c.cp09(+)=b.cp43 and c.cp10 in ('803','804') and cpp01(+)=a.cp09 and upper(cpp02(+))='" & strExc(1) & ".941.RJN.PDF'"
               'Modified by Morgan 2015/6/25 +501訴願,505參加訴願
               strExc(0) = "select b.cp10 from caseprogress a,caseprogress b,caseprogress c where a.cp09='" & cp(9) & "' and b.cp09(+)=a.cp43 and b.cp10 in ('1001','1002','1503') and b.cp27 is null and c.cp09(+)=b.cp43 and c.cp10 in ('803','804','501','505')"
               'end 2015/3/17
               intI = 1
               Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
               If intI = 1 Then
                  bolAuto941Case = True
                  strAuto941RefFileName = strExc(1) & "." & RsTemp(0) & ".CUS.PDF"
                  'Removed by Morgan 2015/3/17 併到下面檢查
                  'If IsNull(RsTemp(1)) Then
                  '   MsgBox "卷宗區無" & strExc(1) & ".941.RJN.PDF 檔，分析不可發文！", vbCritical
                  '   Exit Function
                  'End If
                  'end 2015/3/17
               End If

            End If
'Modified by Mogan 2023/6/26 分析(941)改檢查 .cus --郭
'            'Added by Morgan 2015/3/17 分析都要檢查卷宗區有 .941.RJN# 的PDF檔
'            strExc(0) = "select cpp02 from casepaperpdf where cpp01='" & cp(9) & "' and instr(upper(cpp02),'.941.RJN')>0 and instr(upper(cpp02),'.PDF')>0 and cpp10<>'D'"
'            intI = 1
'            Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
'            If intI = 1 Then
'               strOldFileName = RsTemp(0)
'            Else
'               strErrMsg = "卷宗區無檔名含 "".941.RJN"" 的PDF檔，分析不可發文！"
'               'Removed by Morgan 2023/1/4 移到下面
'               'MsgBox strErrMsg, vbCritical
'               'Exit Function
'               'end 2023/1/4
'            End If
'            'end 2015/3/17
'
'         'Added by Morgan 2016/8/1
'         '+903專利調查,927其他翻譯--玲玲 ExP-115116
'         ElseIf cp(10) = "903" Then
         End If
         If cp(10) = "903" Then
'end 2023/6/26
            strExc(0) = "select cpp02 from casepaperpdf where cpp01='" & cp(9) & "' and instr(upper(cpp02),'.903.SER')>0  and instr(upper(cpp02),'.PDF')>0 and cpp10<>'D'"
            intI = 1
            Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
            If intI = 1 Then
               strOldFileName = RsTemp(0)
            Else
               strErrMsg = "卷宗區無檔名含 "".903.SER"" 的PDF檔，專利調查不可發文！"
               'Removed by Morgan 2023/1/4 移到下面
               'MsgBox "卷宗區無檔名含 "".903.SER"" 的PDF檔，專利調查不可發文！", vbCritical
               'Exit Function
               'end 2023/1/4
            End If

         Else
            strExc(0) = "select cpp02 from casepaperpdf where cpp01='" & cp(9) & "' and instr(upper(cpp02),'.CUS.PDF')>0 and cpp10<>'D'"
            intI = 1
            Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
            If intI = 1 Then
               strOldFileName = RsTemp(0)
            Else
               strErrMsg = "卷宗區無 "".CUS.PDF"" 的檔案，不可發文！"
               'Removed by Morgan 2023/1/4 移到下面
               'MsgBox "卷宗區無 "".CUS.PDF"" 的檔案，不可發文！", vbCritical
               'Exit Function
               'end 2023/1/4
            End If
            
         End If

         'Added by Morgan 2022/2/21
         '全E化客戶案件要用原始檔(.CUS.DOC or .CUS.DOCX)轉有發文日的PDF檔上傳到卷宗區
         'Modified by Morgan 2023/1/4 增加刪除原卷宗區客戶函控制
         'Modified by Morgan 2025/11/11 +半E化客戶
         If PUB_ChkECustCase(cp(1), cp(2), cp(3), cp(4), True) = True Then
            strExc(1) = "" 'Added by Morgan 2022/4/6
            If PUB_MakeCusPdf(cp(9), strExc(1)) = True Then
               'Modified by Morgan 2024/11/6 若沒有轉檔成功不要刪除卷宗區的客戶函 Ex:P-131857
               'If strOldFileName <> strExc(1) Then
               If UCase(strOldFileName) <> UCase(strExc(1)) And strExc(1) <> "" Then
               'end 2024/11/6
                  If MsgBox("系統已產生新的客戶函，【" & strOldFileName & "】將被刪除，是否要繼續？", vbYesNo + vbQuestion + vbDefaultButton2, "全/半E化客戶案件提醒") = vbNo Then
                     Exit Function
                  End If
                  strDelFileName = strOldFileName
                  strOldFileName = strExc(1)
                  DelAttFile_PDF cp(1) & cp(2) & cp(3) & cp(4), cp(9), strDelFileName
               End If
               strErrMsg = ""
            Else
               Exit Function
            End If
         End If
         'end 2022/2/21
         If strErrMsg <> "" Then
            MsgBox strErrMsg, vbCritical
            Exit Function
         End If
      End If
      'end 2014/12/15
      m_990CP09 = ""
      'Added by Morgan 2016/11/25
      '工程師撰寫的信函(C類,941分析903專利調查927)若有副本收受人時抓原始檔的信函內容貼到空的副本信函來產生pdf檔
      If PUB_GetCC(cp(1), cp(2), cp(3), cp(4), stLp33, stLp34) = True Then
         bolMakePdf = True
         
         strExc(0) = "select cp09 from caseprogress where cp43='" & cp(9) & "' and cp10='990' and cp27 is null"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            m_990CP09 = RsTemp(0)
            strExc(0) = "select cpp02 from casepaperpdf where cpp01='" & m_990CP09 & "' and substr(upper(cpp02),-8)='.CUS.PDF' and cpp10<>'D'"
            intI = 1
            Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
            If intI = 1 Then
               bolMakePdf = False
            End If
         ElseIf intI = 0 Then
            If PUB_Add990CP(cp(1), cp(2), cp(3), cp(4), cp(9), m_990CP09, stLp33, stLp34, True) = False Then
               Exit Function
            End If
         Else
            Exit Function
         End If
         
         If bolMakePdf Then
            'Modified by Morgan 2021/3/16 +.DOCX
            strExc(1) = " and (substr(upper(cpf02),-8)='.CUS.DOC' or substr(upper(cpf02),-9)='.CUS.DOCX'"
            
            If cp(10) = "941" Then
               strExc(1) = strExc(1) & " or substr(upper(cpf02),-8)='.RJN.DOC' or substr(upper(cpf02),-9)='.RJN.DOCX'"
            ElseIf cp(10) = "903" Then
               strExc(1) = strExc(1) & " or instr(upper(cpf02),'.903.SER')>0 and (substr(UPPER(cpf02),-4)='.DOC' or substr(UPPER(cpf02),-5)='.DOCX'"
            End If
            strExc(1) = strExc(1) & ")"
            
            strExc(0) = "select cpf13 from casepaperfile where cpf01='" & cp(9) & "'" & strExc(1)
            intI = 1
            Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
            If intI = 1 Then
               strExc(2) = PUB_CaseNo2FileName(cp(1), cp(2), cp(3), cp(4)) & ".990.CUS.PDF"
               If PUB_Make990Pdf(cp(1), m_990CP09, RsTemp(0), strExc(2), IIf(cp(9) > "C", True, False)) = False Then
                  Exit Function
               End If
            Else
               MsgBox "信函副本產生失敗，無法讀取信函原始檔！", vbCritical
               Exit Function
            End If
            
         End If
      End If
   End If
   'end 2016/11/25
   
   'Added by Morgan 2021/2/4 自 FormSave 移來並加變更401
   bolSetPA165 = False
   If pa(9) = "000" And (InStr(NewCasePtyList, Text7(2)) > 0 Or (Text7(2) = "401")) Then
      bolChkPA165IsY = False
      '檢查有變更代理人
      If Text7(2) = "401" Then
         strExc(0) = "select * from CHANGEEVENT where ce01='" & cp(9) & "' and ce55 is not null"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            bolChkPA165IsY = True
         End If
      Else
         bolChkPA165IsY = True
      End If
      
      If bolChkPA165IsY = True Then
         If Trim(Text7(4)) <> "" Then
            If PUB_ChkPA165IsY(Text7(4)) = True Then
               If Trim(Text7(5)) <> "" Then
                  If PUB_ChkPA165IsY(Text7(5)) = True Then
                     If Trim(Text7(6)) <> "" Then
                        If PUB_ChkPA165IsY(Text7(6)) = True Then
                           If Trim(Text7(7)) <> "" Then
                              If PUB_ChkPA165IsY(Text7(7)) = True Then
                                 If Trim(Text7(8)) <> "" Then
                                    If PUB_ChkPA165IsY(Text7(8)) = False Then
                                       bolChkPA165IsY = False
                                    End If
                                 End If
                              Else
                                 bolChkPA165IsY = False
                              End If
                           End If
                        Else
                           bolChkPA165IsY = False
                        End If
                     End If
                  Else
                     bolChkPA165IsY = False
                  End If
               End If
            Else
               bolChkPA165IsY = False
            End If
         End If
         If bolChkPA165IsY = False Then
            If MsgBox("是否要設定為總委任書案件？", vbYesNo + vbDefaultButton2 + vbInformation) = vbYes Then
               bolSetPA165 = True
            End If
         End If
      End If
   End If
   'end 2021/2/4
   
   'Added by Morgan 2024/1/19
   'Modified by Morgan 2024/5/24 +判斷AB類才要(因C類來函可能會由工程師承辦)
   If pa(9) = "020" And txtCP118 = "" And cp(9) < "C" Then
      If MsgBox("請確認本案是否為紙本送件？", vbQuestion + vbYesNo + vbDefaultButton2) = vbNo Then
         txtCP118.SetFocus
         Exit Function
      End If
   End If
   'end 2024/1/19
   
   'Added by Lydia 2025/02/12
   If pa(1) = "P" And cp(10) = "245" Then
      If Trim(txtCP71) = "" Then
         MsgBox "延緩審查日期不可空白！", vbCritical
         txtCP71.SetFocus
         txtCP71_GotFocus
         Exit Function
      Else
         txtCP71_Validate Cancel
         If Cancel = True Then
            Exit Function
         End If
      End If
   End If
   'end 2025/02/03
   
   TxtValidate = True
End Function

'Add By Cheng 2002/06/24
Private Function GetCF15(strCF01 As String, strCF02 As String, strCF03 As String) As Boolean
Dim rsA As New ADODB.Recordset
Dim StrSQLa As String

GetCF15 = False
If rsA.State <> adStateClosed Then rsA.Close
Set rsA = Nothing
StrSQLa = "Select CF15 From CaseFee Where CF01='" & strCF01 & "' AND CF02='" & strCF02 & "' AND CF03='" & strCF03 & "'"
rsA.CursorLocation = adUseClient
rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
If rsA.RecordCount > 0 Then
   If IsNull(rsA.Fields(0).Value) = False Then
      GetCF15 = False
   End If
End If
If rsA.State <> adStateClosed Then rsA.Close
Set rsA = Nothing

End Function

Private Sub txtAppID_KeyPress(Index As Integer, KeyAscii As Integer)
   KeyAscii = UpperCase(KeyAscii)
End Sub

Private Sub txtAppID_Validate(Index As Integer, Cancel As Boolean)
   If txtAppID(Index).Locked = False Then
      If m_CU15(Index) <> "" Then
      If CheckID(m_CU15(Index), txtAppID(Index).Text) = False Then
         Dim strTmp As String
         If m_CU15(Index) = "0" Then
            strTmp = "身分證字號錯誤，是否確定 ?"
         Else
            strTmp = "統一編號錯誤，是否確定 ?"
         End If
         If MsgBox(strTmp, vbYesNo + vbCritical) = vbNo Then
            Cancel = True
         End If
      End If
      End If
   End If
End Sub

'Added by Lydia 2021/05/25
Private Sub txtCP113_GotFocus()
   TextInverse txtCP113
End Sub

'Added by Lydia 2021/05/25
Private Sub txtCP113_Validate(Cancel As Boolean)
   If txtCP113 <> "" Then
      If Not IsNumeric(txtCP113) Then
         MsgBox "請輸入數字！", vbExclamation
         txtCP113.SetFocus
         txtCP113_GotFocus
         Cancel = True
         Exit Sub
      End If
   End If
End Sub

'Added by Morgan 2019/4/8
Private Sub txtCP118_Change()
   If txtCP118 <> "" And pa(9) = "000" Then 'Modified by Morgan 2024/1/23 +台灣案才要(因增加大陸案也可設電子送件)
      Text7(27) = "Y"
      Text7(27).Enabled = True
   Else
      Text7(27) = ""
      Text7(27).Enabled = False
   End If
End Sub

Private Sub txtCP118_GotFocus()
   TextInverse txtCP118
   CloseIme
End Sub

Private Sub txtCP118_KeyPress(KeyAscii As Integer)
   KeyAscii = UpperCase(KeyAscii)
   If KeyAscii <> 8 And KeyAscii <> Asc("Y") Then
      Beep
      KeyAscii = 0
   End If
End Sub

Private Sub txtCP135_GotFocus()
   TextInverse txtCP135
   CloseIme
End Sub

Private Sub txtCP135_KeyPress(KeyAscii As Integer)
   '只能輸倒退及數字鍵
   If KeyAscii <> 8 And (KeyAscii < 48 Or KeyAscii > 57) Then
      Beep
      KeyAscii = 0
   End If
End Sub

Private Sub txtCP135_Validate(Cancel As Boolean)
   SetOfficialFee
End Sub

Private Sub txtCP136_GotFocus()
   TextInverse txtCP136
   CloseIme
End Sub

Private Sub txtCP136_KeyPress(KeyAscii As Integer)
   '只能輸倒退及數字鍵
   If KeyAscii <> 8 And (KeyAscii < 48 Or KeyAscii > 57) Then
      Beep
      KeyAscii = 0
   End If
End Sub

Private Sub txtCP136_Validate(Cancel As Boolean)
   SetOfficialFee
End Sub

Private Sub txtCP137_GotFocus()
   TextInverse txtCP137
   CloseIme
End Sub

Private Sub txtCP137_KeyPress(KeyAscii As Integer)
   '只能輸倒退及數字鍵
   If KeyAscii <> 8 And (KeyAscii < 48 Or KeyAscii > 57) Then
      Beep
      KeyAscii = 0
   End If
End Sub

Private Sub txtCP137_Validate(Cancel As Boolean)
   SetOfficialFee
End Sub

Private Sub txtCP138_GotFocus()
   TextInverse txtCP138
   CloseIme
End Sub

Private Sub txtCP138_KeyPress(KeyAscii As Integer)
   '只能輸倒退及數字鍵
   If KeyAscii <> 8 And (KeyAscii < 48 Or KeyAscii > 57) Then
      Beep
      KeyAscii = 0
   End If
End Sub

'Added by Lydia 2025/02/12
Private Sub txtCP71_GotFocus()
   TextInverse txtCP71
End Sub
'Added by Lydia 2025/02/12
Private Sub txtCP71_KeyPress(KeyAscii As Integer)
   '只能輸倒退及數字鍵
   If KeyAscii <> 8 And (KeyAscii < 48 Or KeyAscii > 57) Then
      Beep
      KeyAscii = 0
   End If
End Sub

'Added by Lydia 2025/02/12
Private Sub txtCP71_Validate(Cancel As Boolean)
   If txtCP71 <> "" Then
      If pa(9) = 台灣國家代號 Then
         '臺灣：可指定日期，但最晚不能晚於原本提實審之法定期限
         If CheckIsTaiwanDate(txtCP71) = False Then
            GoTo EXITSUB
         Else
            If DBDATE(txtCP71) > m_CP416forCP07 And m_CP416forCP07 <> "" Then
               MsgBox "台灣案申請延緩審查可指定日期，但最晚不能晚於原本提實審之法定期限" & ChangeWStringToTDateString(m_CP416forCP07), vbCritical
               GoTo EXITSUB
            End If
         End If
      Else
         '大陸：以年度計，只可延緩1或2或3年
         If txtCP71 <> "1" And txtCP71 <> "2" And txtCP71 <> "3" Then
            MsgBox "大陸案申請延緩審查以年度計，只可延緩1或2或3年", vbCritical
            GoTo EXITSUB
         End If
      End If
   End If
   Exit Sub
   
EXITSUB:
   Cancel = True
   txtCP71.SetFocus
   txtCP71_GotFocus
End Sub

'Add by Morgan 2004/8/11
Private Sub txtCP84_GotFocus()
   CloseIme 'Add by Morgan 2008/10/27
   TextInverse txtCP84
End Sub
'Add by Morgan 2004/8/11
Private Sub txtCP84_KeyPress(KeyAscii As Integer)
   '只能輸倒退及數字鍵
   If KeyAscii <> 8 And (KeyAscii < 48 Or KeyAscii > 57) Then
      Beep
      KeyAscii = 0
   End If
End Sub

'Add by Morgan 2004/8/11
Private Sub txtCP84_Validate(Cancel As Boolean)
Dim Check_cp84 As Boolean     '2012/7/19 add by sonia

   '台灣
   If pa(9) = "000" Then
      '2012/7/19 add by sonia 電子送件檢查發文規費
      'Modified by Morgan 2014/1/15 分割不可減免 P-107432 --敏惠
      'If txtCP118 = "Y" And InStr(NewCasePtyList, Text7(2)) > 0 Then
      'Modified by Morgan 2014/1/20 +125 也不可減免
      'Modified by Morgan 2014/1/23 +衍生設計125又改可減免--莊敏惠
      If txtCP118 = "Y" And InStr(NewCasePtyList, Text7(2)) > 0 And Text7(2) <> "307" Then
         Check_cp84 = False
         Select Case pa(8)
            Case "1"
               If Val(txtCP84.Text) <> 2900 And Val(txtCP84.Text) <> 2100 Then Check_cp84 = True
            Case Else
               If Val(txtCP84.Text) <> 2400 Then Check_cp84 = True
         End Select
         If Check_cp84 Then
            MsgBox "電子送件案件, 發文規費不符！"
            txtCP84_GotFocus
            Cancel = True
            Exit Sub
         End If
      End If
      '2012/7/19 end
      'Added by Lydia 2022/05/23 PT案(傳入收文號)取得法律案源之發文規費，並且有輸入發文規費才做檢查
      If m_LosCP84 <> "0" Then
         If Val(m_LosCP84) <> Val(Trim(txtCP84.Text)) Then
             If MsgBox("法律所收文規費[" & Trim(Val(m_LosCP84)) & "] 與實際發文規費[" & Trim(Val(txtCP84.Text)) & "]不同", vbOKCancel) = vbCancel Then
                 txtCP84_GotFocus
                 Cancel = True
             End If
         End If
      Else
      'end 2022/05/23
         If Val(txtCP84.Text) <> Val(cp(17)) And Val(txtCP84.Text) <> Val(txtCP84.Tag) Then
            If MsgBox("發文規費【" & txtCP84.Text & "】與收文規費【" & cp(17) & "】不同，確定要繼續？", vbInformation + vbYesNo + vbDefaultButton2) = vbYes Then
               txtCP84.Tag = txtCP84.Text
            Else
               txtCP84_GotFocus
               Cancel = True
            End If
         End If
      End If 'Added by Lydia 2022/05/23
   End If
End Sub

Private Sub txtDate_GotFocus()
   TextInverse txtDate
   CloseIme
End Sub

Private Sub txtDate_Validate(Cancel As Boolean)
   Dim strTmp As String
   If txtDate <> "" Then
      If CheckIsTaiwanDate(txtDate) = False Then
         Cancel = True
      Else
         If Text7(28) <> "" And Val(txtDate) > Val(Text7(28)) Then
            MsgBox "順稿期限不可大於指定提申期限！"
            Cancel = True
         ElseIf Text7(3) <> "" And Val(txtDate) > Val(Text7(3)) Then
            MsgBox "順稿期限不可大於最終提申期限！"
            Cancel = True
         Else
            If ClsPDGetCaseDelayDay(cp(1), pa(9), cp(10), , , strTmp) Then
               If strTmp <> "" Then
                  '一般提申
                  strExc(1) = CompDate(2, Val(strTmp), DBDATE(Text7(0)))
                  strExc(2) = PUB_GetWorkDay1(strExc(1), True)
                  If Text7(3) <> "" And Val(txtDate) > Val(Text7(3)) Then
                     MsgBox "順稿期限不可大於一般提申期限！"
                     Cancel = True
                  End If
               End If
            End If
         End If
      End If
   End If
End Sub

Private Sub txtEditInf_KeyPress(KeyAscii As Integer)
'Add By Cheng 2002/07/11
KeyAscii = UpperCase(KeyAscii)
If KeyAscii <> 89 And KeyAscii <> 8 Then
   KeyAscii = 0
End If
End Sub

'2010/1/21 CANCEL BY SONIA
''Add By Cheng 2003/09/12
''發E-Mail給承辦人
'Private Sub MailToPromoter(strMailCP09 As String)
'Dim StrSQLa As String
'Dim rsA As New ADODB.Recordset
'Dim arrMailCP09
'Dim ii As Integer
'Dim strOfficeKind As String '所別
'
'If strMailCP09 <> "" Then
''Remove by Morgan 2006/7/31
''    strOfficeKind = PUB_GetST06(strUserNum)
'    arrMailCP09 = Split(strMailCP09, ",")
'    For ii = LBound(arrMailCP09) To UBound(arrMailCP09)
'        If arrMailCP09(ii) <> "" Then
'            StrSQLa = "Select * From CaseProgress Where CP09='" & arrMailCP09(ii) & "' And CP14 Is Not Null "
'            rsA.CursorLocation = adUseClient
'            rsA.Open StrSQLa, cnnConnection, adOpenStatic, adLockReadOnly
'            If rsA.RecordCount > 0 Then
'
''Modify by Morgan 2006/7/31 統一呼叫共用函數
''                Load frm880005
'''Modify by Morgan 2006/6/5 外翻都寄給郭79075
'''                Select Case "" & rsA("CP14").Value
'''                Case "F5416"
'''                    '若使用者為北所人員, 則E-Mail後面不加@taie.com.tw
'''                    If strOfficeKind = "1" Then
'''                        '林新晞改發職務代理人張偉城
'''                        frm880005.txtEmail(0).Text = "89026"
'''                    '若使用者非北所人員, 則E-Mail後面加@taie.com.tw
'''                    Else
'''                        '林新晞改發職務代理人張偉城
'''                        frm880005.txtEmail(0).Text = "89026@taie.com.tw"
'''                    End If
'''                Case "F5479"
'''                    '若使用者為北所人員, 則E-Mail後面不加@taie.com.tw
'''                    If strOfficeKind = "1" Then
'''                        '洪磊改發職務代理人 93.9.30 91028 --> 79075  2005/6/22  79075--> 94003  2006/4/3 ->95008
'''                        frm880005.txtEmail(0).Text = "79075"
'''                    '若使用者非北所人員, 則E-Mail後面加@taie.com.tw
'''                    Else
'''                        '洪磊改發職務代理人
'''                        frm880005.txtEmail(0).Text = "79075@taie.com.tw"
'''                    End If
'''                Case "F5484"
'''                    '若使用者為北所人員, 則E-Mail後面不加@taie.com.tw
'''                    If strOfficeKind = "1" Then
'''                        '李皇　改發職務代理人粘竺儒
'''                        frm880005.txtEmail(0).Text = "84012"
'''                    '若使用者非北所人員, 則E-Mail後面加@taie.com.tw
'''                    Else
'''                        '李皇　改發職務代理人粘竺儒
'''                        frm880005.txtEmail(0).Text = "84012@taie.com.tw"
'''                    End If
'''                Case Else
''                    If "" & rsA("CP14").Value <> "" Then
''                        'Add by Morgan 2006/6/2 其他外翻則寄給郭,Mail程式已改,分所也不用加@
''                        If Left(rsA("CP14").Value, 1) = "F" Then
''                           frm880005.txtEmail(0).Text = "79075"
''                        'end 2006/6/2
''                        Else
''                           '若使用者為北所人員, 則E-Mail後面不加@taie.com.tw
''                           If strOfficeKind = "1" Then
''                               frm880005.txtEmail(0).Text = "" & rsA("CP14").Value
''                           '若使用者非北所人員, 則E-Mail後面加@taie.com.tw
''                           Else
''                               frm880005.txtEmail(0).Text = "" & rsA("CP14").Value & "@taie.com.tw"
''                           End If
''                        End If
''                    End If
'''                End Select
'''end 2006/6/5
''                frm880005.txtEmail(1).Text = rsA("CP01").Value & "-" & rsA("CP02").Value & "-" & rsA("CP03").Value & "-" & rsA("CP04").Value & "已上文件齊備日及承辦期限!(因為" & Me.Text1.Text & "-" & Me.Text2.Text & "-" & Me.Text3.Text & "-" & Me.Text4.Text & "已送件)"
''                frm880005.txtEmail(2).Text = ""
''                frm880005.Form_Activate: DoEvents
''                frm880005.cmdok_Click 0: DoEvents
'               If "" & rsA("CP14").Value <> "" Then
'                  PUB_SendMail strUserNum, rsA("CP14").Value, "", rsA("CP01").Value & "-" & rsA("CP02").Value & "-" & rsA("CP03").Value & "-" & rsA("CP04").Value & "已上文件齊備日及承辦期限!(因為" & Me.Text1.Text & "-" & Me.Text2.Text & "-" & Me.Text3.Text & "-" & Me.Text4.Text & "已送件)", " "
'               End If
''end 2006/7/31
'            End If
'            If rsA.State <> adStateClosed Then rsA.Close
'            Set rsA = Nothing
'        End If
'    Next ii
'End If
'End Sub
'2010/1/21 END

'Add by Morgan 2003/3/30
'檢查母案是否存在
Private Function GetDivInfo(ByRef stDivInfo() As String, ByRef stPA() As String) As Boolean

On Error GoTo flgErr

   Dim stSQL As String, rsQuery As New ADODB.Recordset
   
   stSQL = "select pa01,pa02,pa03,pa04,pa09 from patent, divisioncase where pa01=dc05 and pa02=dc06 and pa03=dc07 and pa04=dc08" & _
      " and dc01='" & stPA(1) & "' and dc02='" & stPA(2) & "' and  dc03='" & stPA(3) & "' and dc04='" & stPA(4) & "'"
   
   rsQuery.CursorLocation = adUseClient
   rsQuery.Open stSQL, cnnConnection, adOpenStatic, adLockReadOnly
   If rsQuery.RecordCount > 0 Then
      stDivInfo(1) = "" & rsQuery("pa01").Value
      stDivInfo(2) = "" & rsQuery("pa02").Value
      stDivInfo(3) = "" & rsQuery("pa03").Value
      stDivInfo(4) = "" & rsQuery("pa04").Value
      stDivInfo(5) = "" & rsQuery("pa09").Value
      GetDivInfo = True
   Else
      MsgBox "分割母案本所案號不存在！", vbExclamation
   End If
   
flgErr:
   Set rsQuery = Nothing
   If Err.NUMBER <> 0 Then MsgBox Err.Description, vbCritical
    
End Function
'Add by Morgan 2004/7/22
Private Sub txtAD_GotFocus(Index As Integer)
   'edit by nickc 2007/07/11 切換輸入法改用API
   'txtAD(Index).IMEMode = 2
   CloseIme
   TextInverse txtAD(Index)
End Sub
'Add by Morgan 2004/7/22
'只有公司可輸入 2,3,N
Private Sub txtAD_KeyPress(Index As Integer, KeyAscii As Integer)
   KeyAscii = UpperCase(KeyAscii)
   'Modified by Morgan 2014/7/15 學校改預設且不可改
   'If Not (KeyAscii = 8 Or KeyAscii = 50 Or KeyAscii = 51 Or KeyAscii = 78) Then
   If Not (KeyAscii = 8 Or KeyAscii = 51 Or KeyAscii = 78) Then
      KeyAscii = 0
   End If
End Sub
'Add by Morgan 2010/1/4
'計算實審,修正規費
Private Sub SetOfficialFee()
   Dim iItems As Integer, iItemsOld As Integer, iItemsAdd As Integer
   Dim dblOfficialFee As Double
   m_lngOverPageFee = 0
   m_lngOverItemFee = 0
   
   'Added by Morgan 2013/1/8
   If cp(10) = "107" Then
      dblOfficialFee = Val(GetPatentOfficialFee(cp(1), cp(10), DBDATE(cp(7)), pa(8), pa(9), pa(16)))
      If dblOfficialFee = 0 Then
         strExc(0) = "select cf08 from casefee where cf01='" & pa(1) & "' and cf02='" & pa(9) & "' and cf03='" & cp(10) & "'"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            '原始規費
            dblOfficialFee = Val("" & RsTemp.Fields(0))
         End If
      End If
      
      '有延期過則須扣除延期的發文規費
      If m_bolDelay = True Then
         strExc(0) = "select cp84 from caseprogress where cp09='" & m_strDelayCP09 & "'"
         intI = 1
         Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
         If intI = 1 Then
            dblOfficialFee = dblOfficialFee - Val("" & RsTemp("cp84"))
         End If
      End If
   Else
   'end 2013/1/8
   
      strExc(0) = "select cf08 from casefee where cf01='" & pa(1) & "' and cf02='" & pa(9) & "' and cf03='" & cp(10) & "'"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         '原始規費
         dblOfficialFee = Val("" & RsTemp.Fields(0))
      End If
      
   End If 'Added by Morgan 2013/1/8
   
   '超頁費
   If Val(txtCP135) > 50 Then
      m_lngOverPageFee = 500# * ((Val(txtCP135) - 1) \ 50)
   End If
   
   '超項費
   'Modified by Morgan 2013/1/8 +再審107
   'If cp(10) = "416" Then
   If cp(10) = "416" Or cp(10) = "107" Then
      iItems = Val(txtCP136)
      If iItems > 10 Then
         m_lngOverItemFee = 800# * (iItems - 10)
      End If
      
   Else
      iItemsAdd = Val(txtCP136) - Val(txtCP137)
      strExc(0) = "select sum(cp136),sum(cp137),sum(cp138) from caseprogress a where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp27>0 and cp57 is null"
      intI = 1
      
      'Added by Morgan 2013/1/10
      '若為再審後修正時只能抓再審以後發文的程序加總
      If m_strReExamCP27 <> "" Then
         strExc(0) = strExc(0) & " and cp27>=" & m_strReExamCP27
      End If
      'end 2013/1/10
         
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         iItemsOld = Val("" & RsTemp.Fields(0)) - Val("" & RsTemp.Fields(1))
      End If
      iItems = iItemsOld + iItemsAdd
      '項數增加
      If iItemsAdd > 0 Then
         '超過10項
         If iItemsOld >= 10 Then
            m_lngOverItemFee = 800# * iItemsAdd
         ElseIf iItems >= 10 Then
            m_lngOverItemFee = 800# * (iItems - 10)
         End If
      '項數減少
      ElseIf iItemsAdd < 0 Then
         '超過10項
         If iItems >= 10 Then
            m_lngOverItemFee = 800# * iItemsAdd
            
         '刪減後少於10項,但原來總項數>10,則可退原繳超項費=800*(原來總項數-10)
         ElseIf iItemsOld > 10 Then
            m_lngOverItemFee = -1 * 800# * (iItemsOld - 10)
         End If
      End If
   End If
   '發文規費
   txtCP84 = dblOfficialFee + m_lngOverPageFee + m_lngOverItemFee
   
End Sub
'Add by Morgan 2010/1/5
'檢查規費
Private Function CheckOfficialFee() As Boolean
   Dim lngRecFee As Long, lngFeeDif As Long
   
   CheckOfficialFee = True
   m_lngRecOverPageFee = 0
   m_lngRecOverItemFee = 0
   
   'Add by Morgan 2010/1/7
   If m_bolChkPageItem Then
      If txtCP135 = "" Then
         MsgBox "頁數不可空白！", vbExclamation
         If txtCP135.Enabled Then txtCP135.SetFocus
         CheckOfficialFee = False
         Exit Function
      ElseIf txtCP136 = "" Then
         MsgBox "項數不可空白！", vbExclamation
         If txtCP136.Enabled Then txtCP136.SetFocus
         CheckOfficialFee = False
         Exit Function
      End If
   End If
   
   'Add by Morgan 2010/10/11
   If m_bolChkItem Then
      If txtCP136 = "" And txtCP137 = "" And txtCP138 = "" Then
         If MsgBox("增加項數及刪除項數皆為空白，是否要繼續？", vbYesNo + vbDefaultButton2) = vbNo Then
            If txtCP136.Enabled Then txtCP136.SetFocus
            CheckOfficialFee = False
            Exit Function
         End If
      End If
   End If
   'end 2010/10/11
   
   '退規費
   If Val(txtCP84) < 0 Then
      m_FeeMemo = "退規費 " & Format(-1 * Val(txtCP84), DAmount) & " 元;"
      MsgBox "本次發文可退規費【" & Format(-1 * Val(txtCP84), DAmount) & "】元！", vbInformation
      txtCP84 = 0
  
   Else
   
   'Added by Morgan 2021/2/26 +檢查是否有超頁/超項費未分案 Ex:P126586
      strExc(0) = "select * from caseprogress where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10 in ('938','939') and cp27 is null and cp57 is null and cp14 is null"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         MsgBox "本案有超頁費或超項費尚未分案，不可發文！", vbCritical
         CheckOfficialFee = False
         Exit Function
      End If
   'end 2021/2/26
   
   'Remove by Morgan 2010/1/8 秀玲資料已改無須用程式控制
   '   'Modify by Morgan 2010/1/6 實審原來收 8000 的來不及銷帳一律用7000
   '   If cp(10) = "416" Then
   '      lngRecFee = 7000
   '   Else
   '   'end 2010/1/6
         'Modified by Morgan 2013/6/5 cp(17) 已改為扣除銷帳金額,此處不需再減
         'lngRecFee = Val("" & cp(17)) - Val("" & cp(77)) '需減銷帳金額(只有規費項目的案件性質適用)
         lngRecFee = Val("" & cp(17))
         'end 2013/6/5
   '   End If
   'end 2010/1/8
      strExc(0) = "select cp10,sum(nvl(cp17,0)-nvl(cp77,0)) Fee from caseprogress where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10='938' and cp27 is null and cp57 is null group by cp10" & _
         " union select cp10,sum(nvl(cp17,0)-nvl(cp77,0)) from caseprogress where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp10='939' and cp27 is null and cp57 is null group by cp10"
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         Do While Not RsTemp.EOF
            '已收超頁費
            If RsTemp.Fields("cp10") = "938" Then m_lngRecOverPageFee = m_lngRecOverPageFee + Val("" & RsTemp.Fields("Fee"))
            '已收超項費
            If RsTemp.Fields("cp10") = "939" Then m_lngRecOverItemFee = m_lngRecOverItemFee + Val("" & RsTemp.Fields("Fee"))
            RsTemp.MoveNext
         Loop
      End If
      '已收規費
      lngRecFee = lngRecFee + m_lngRecOverPageFee + m_lngRecOverItemFee
      '不足規費
      lngFeeDif = Val(txtCP84) - lngRecFee
      
      If lngFeeDif > 0 Then
         '有超頁費不足
         If m_lngOverPageFee > m_lngRecOverPageFee Then
         
            m_lngOverPageFeeDiff = m_lngOverPageFee - m_lngRecOverPageFee
            '未足超頁費大於不足總額(本程序有多收規費)時
            If m_lngOverPageFeeDiff > lngFeeDif Then
                m_lngOverPageFeeDiff = lngFeeDif
                m_lngOverItemFeeDiff = 0
            '剩餘不足額給超項費
            Else
               m_lngOverItemFeeDiff = lngFeeDif - m_lngOverPageFeeDiff
            End If
         '只有超項費不足
         Else
            m_lngOverItemFeeDiff = lngFeeDif
            m_lngOverPageFeeDiff = 0
         End If
         If MsgBox("已收文規費(含未發文超頁及超項費)共【" & Format(lngRecFee, DAmount) & "】元，尚缺【" & Format(lngFeeDif, DAmount) & "】元，存檔時會自動內部收文超頁或超項費補足差額，是否確定要繼續？", vbInformation + vbYesNo + vbDefaultButton2) = vbNo Then
            CheckOfficialFee = False
         End If
      ElseIf lngFeeDif < 0 Then
         MsgBox "已收文規費(含未發文超頁及超項費)共【" & Format(lngRecFee, DAmount) & "】元，超收【" & Format(-1 * lngFeeDif, DAmount) & "】元！", vbExclamation
         m_bChk939 = True 'Added by Morgan 2023/8/24
      End If
   End If
   
   'Added by Morgan 2012/3/20 收文案件性質不符合要提醒(不考慮金額)--秀玲
   strExc(0) = ""
   If m_lngOverPageFee > 0 And m_lngRecOverPageFee = 0 And m_lngOverPageFeeDiff = 0 Then
      If m_lngOverItemFee = 0 And m_lngRecOverItemFee > 0 Then
         strExc(0) = "請注意，本案應收文超頁費但錯收為超項費！" & vbCrLf
      Else
         strExc(0) = "請注意，本案有超頁費但未收文！" & vbCrLf
      End If
   End If
   If m_lngOverItemFee > 0 And m_lngRecOverItemFee = 0 And m_lngOverItemFeeDiff = 0 Then
      If m_lngOverPageFee = 0 And m_lngRecOverPageFee > 0 Then
         strExc(0) = "請注意，本案應收文超項費但錯收為超頁費！" & vbCrLf
      Else
         strExc(0) = strExc(0) & "請注意，本案有超項費但未收文！" & vbCrLf
      End If
   End If
   If strExc(0) <> "" Then MsgBox strExc(0), vbExclamation, "收文案件性質不符提醒"
   'End 2012/3/20
   
End Function

'2010/1/21 ADD BY SONIA 批次發Mail
Private Sub BatchMail()
   Dim i As Integer
   For i = 1 To UBound(skMail)
        PUB_SendMail skMail(i).fiSender, skMail(i).fiReceiver, skMail(i).fiRecriverNo, skMail(i).fiSubject, skMail(i).fiContent
   Next i
   ReDim skMail(0) As SeekMails
End Sub

Private Sub txtFavDt_GotFocus()
   TextInverse txtFavDt
   CloseIme
End Sub

Private Sub txtFavDt_Validate(Cancel As Boolean)
   If txtFavDt <> "" Then
      Cancel = Not ChkDate(txtFavDt)
   End If
End Sub

Private Sub txtPayToday_GotFocus()
   TextInverse txtPayToday
   CloseIme
End Sub

Private Sub txtPayToday_KeyPress(KeyAscii As Integer)
   KeyAscii = UpperCase(KeyAscii)
   If KeyAscii <> 8 And KeyAscii <> Asc("Y") And KeyAscii <> Asc("N") Then
      KeyAscii = 0
      Beep
   End If
End Sub

'Add by Amy 2014/04/08 因應台日優先權證明文件管控
'確認畫面上「優先權國家」為日本且「專利種類」為發明或新型的「優先權存取碼」是否為空值(可能由frm880002傳回的優先權資料,未寫入DB的資料)
Private Function ChkFramePD09Null() As Boolean
    Dim varPriorityTemp1, varPriorityTemp2, varPriorityTemp3
    Dim p As Integer
    
    If strPriority(5) = "" Then
        ChkFramePD09Null = True
        Exit Function
    End If
    
    varPriorityTemp1 = Split(strPriority(1), "，") '優先權國家
    varPriorityTemp2 = Split(strPriority(4), "，") '專利種類
    varPriorityTemp3 = Split(strPriority(5), "，") '存取碼
    For p = LBound(varPriorityTemp1) To UBound(varPriorityTemp1)
        If varPriorityTemp1(p) = "011" And InStr("1,2", varPriorityTemp2(p)) > 0 Then
            If varPriorityTemp3(p) = "" Then
                ChkFramePD09Null = True
                Exit For
            Else
                ChkFramePD09Null = False
                Exit For
            End If
        ElseIf p = UBound(varPriorityTemp1) Then
            ChkFramePD09Null = True
        End If
    Next p
End Function
'end 2014/04/08

'Add by Amy 2014/07/25 優先權存取碼指示信例外欄位
Private Sub StartLetter1(ByVal ET01 As String, ByVal ET03 As String)
 Dim strTxt(1 To 5) As String, intStep As Integer
 Dim RsQ As New ADODB.Recordset, strSqlq As String, intQ As Integer
 
   EndLetter ET01, strReceiveNo, ET03, strUserNum
   intStep = 1
  
   If ET01 = "02" And pa(9) = "020" And Me.Text7(2).Text = "436" Then
      '抓取新申請案發文日
      strSqlq = "Select cp27 From CaseProgress Where cp10 In (" & NewCasePtyList & ") " & _
                    "And cp01='" & Text1 & "' And cp02='" & Text2 & "' And cp03='" & Text3 & "' and cp04='" & Text4 & "' "
      intQ = 1
      Set RsQ = ClsLawReadRstMsg(intQ, strSqlq)
      If intQ = 1 Then
         strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
                                "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
                                "','申請案發文日','" & RsQ.Fields("cp27") & "')"
'                                "','申請案發文日','" & Left(RsQ.Fields("cp27"), 4) & "年" & _
'                                 Mid(RsQ.Fields("cp27"), 5, 2) & "月" & Mid(RsQ.Fields("cp27"), 7, 2) & "')"
         intStep = intStep + 1
      End If
      If RsQ.State <> adStateClosed Then RsQ.Close
      Set RsQ = Nothing
   End If
   
   'Added by Morgan 2016/8/1
   If strCopies <> "" Then
      strTxt(intStep) = "INSERT INTO EXCEPTCONDITION (ET01,ET02,ET03,ET04,ET05,ET06) " & _
         "VALUES ('" & ET01 & "','" & strReceiveNo & "','" & ET03 & "','" & strUserNum & _
         "','份數','" & strCopies & "')"
      intStep = intStep + 1
   End If
   'end 2016/8/1

   If Not ClsLawExecSQL(intStep - 1, strTxt) Then
      MsgBox "儲存例外欄位失敗，請洽系統管理員 !", vbCritical
   End If
End Sub
'end 2014/07/24

'Add by Lydia 2015/02/02 輸入新穎性優惠期公開事實 (多筆)
Private Sub CmdFav_Click()
If cp(10) = "123" Then
   Set frm880020.m_PrevF = Me
   frm880020.m_dbCheck = True 'Modified by Lydia 2015/02/25  發文DoubleCheck
   frm880020.strFPD01 = pa(1):   frm880020.strFPD02 = pa(2)
   frm880020.strFPD03 = pa(3):   frm880020.strFPD04 = pa(4)
   frm880020.strNation = pa(9)
   frm880020.strPA140 = IIf(txtFavDt.Text = "", IIf(pa(140) <> "", Val(pa(140)) - 19110000, ""), txtFavDt.Text)
   frm880020.Show
End If
End Sub

'Added by Morgan 2015/6/29
'從ReadPatent抽出
Private Sub SetCustLetter()
   If Text7(0) <> "" And (Text7(2) = "416" Or Text7(2) = "417") Then
      '若當日已有新案發文時設不出定稿
      strExc(0) = "select cp09 from caseprogress where cp01='" & cp(1) & "' and cp02='" & cp(2) & "' and cp03='" & cp(3) & "' and cp04='" & cp(4) & "' and cp27=" & DBDATE(Text7(0))
      '提早公開檢查當日有431,434發文時也要設不出定稿
      If Text7(2) = "417" Then
         strExc(0) = strExc(0) & "  and cp10 in ('101','301','307','431','434')"
      Else
         strExc(0) = strExc(0) & "  and cp10 in ('101','301','307')"
      End If
      intI = 1
      Set RsTemp = ClsLawReadRstMsg(intI, strExc(0))
      If intI = 1 Then
         Text7(21) = "N": Text7(21).Enabled = False
      End If
   End If
End Sub

'Added by Lydia 2016/09/29 檢查一案兩請的新型案,放棄專利權(429)發文系統自動上閉卷
Private Sub ChkDualCase429(ByVal DualNo As String, Optional ByVal bMsg As Boolean = True)
    If Val(pa(10)) >= 950701 And Val(pa(10)) < 981001 Then
       If pa(57) = "" Then
          m_DualCase429Memo = ";與發明案(" & DualNo & ")為一案兩請,放棄專利權(429)發文系統自動上閉卷"
          m_DualCase429 = True
          If bMsg = True Then MsgBox "與發明案(" & DualNo & ")為一案兩請，本案將自動上閉卷！", vbInformation
       End If
    End If
End Sub
